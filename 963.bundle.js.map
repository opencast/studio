{"version":3,"file":"963.bundle.js","mappings":"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","sources":["webpack://opencast-studio/./src/icons/step-current.svg","webpack://opencast-studio/./src/icons/step-done.svg","webpack://opencast-studio/./src/capturer.tsx","webpack://opencast-studio/./src/ui/VideoBox.tsx","webpack://opencast-studio/./src/ui/ErrorBox.tsx","webpack://opencast-studio/./src/ui/Select.tsx","webpack://opencast-studio/./src/steps/video-setup/prefs.tsx","webpack://opencast-studio/./src/steps/video-setup/preview.tsx","webpack://opencast-studio/./src/shortcuts.tsx","webpack://opencast-studio/./src/steps/elements.tsx","webpack://opencast-studio/./src/ui/SourceOptionButton.tsx","webpack://opencast-studio/./src/steps/video-setup/source-select.tsx","webpack://opencast-studio/./src/steps/video-setup/index.tsx","webpack://opencast-studio/./src/steps/audio-setup/source-select.tsx","webpack://opencast-studio/./src/steps/audio-setup/mic-preview.tsx","webpack://opencast-studio/./src/steps/audio-setup/index.tsx","webpack://opencast-studio/./src/steps/recording/controls.tsx","webpack://opencast-studio/./src/steps/recording/recorder.tsx","webpack://opencast-studio/./src/steps/recording/index.tsx","webpack://opencast-studio/./src/steps/review/cut-here-icon.svg","webpack://opencast-studio/./src/steps/review/cut-marker.svg","webpack://opencast-studio/./src/steps/review/control-box.tsx","webpack://opencast-studio/./src/steps/review/cut-out-icon.svg","webpack://opencast-studio/./src/steps/review/preview.tsx","webpack://opencast-studio/./src/steps/review/index.tsx","webpack://opencast-studio/./src/steps/finish/save-locally.tsx","webpack://opencast-studio/./src/steps/finish/upload.tsx","webpack://opencast-studio/./src/steps/finish/index.tsx","webpack://opencast-studio/./src/steps/index.tsx","webpack://opencast-studio/./src/icons/keyboard.svg","webpack://opencast-studio/./src/i18n/languages.tsx","webpack://opencast-studio/./src/layout/header.tsx","webpack://opencast-studio/./src/about.tsx","webpack://opencast-studio/./src/layout/index.tsx","webpack://opencast-studio/./src/ui/global-style.tsx","webpack://opencast-studio/./src/App.tsx"],"sourcesContent":["var _circle, _circle2;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nconst SvgStepCurrent = props => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: \"1em\",\n  height: \"1em\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\",\n  strokeWidth: 2,\n  className: \"step-current_svg__feather step-current_svg__feather-circle\",\n  viewBox: \"0 0 24 24\"\n}, props), _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n  cx: 12,\n  cy: 12,\n  r: 10\n})), _circle2 || (_circle2 = /*#__PURE__*/React.createElement(\"circle\", {\n  cx: 12,\n  cy: 12,\n  r: 3,\n  fill: \"currentColor\"\n})));\nexport default SvgStepCurrent;","var _path;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nconst SvgStepDone = props => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: \"1em\",\n  height: \"1em\",\n  fill: \"currentColor\",\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\",\n  className: \"step-done_svg__feather step-done_svg__feather-circle\",\n  viewBox: \"0 0 24 24\"\n}, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M12 1A11 11 0 0 0 1 12a11 11 0 0 0 11 11 11 11 0 0 0 11-11A11 11 0 0 0 12 1m5 7a1 1 0 0 1 .707.293 1 1 0 0 1 0 1.414l-7 7a1 1 0 0 1-1.414 0l-3-3a1 1 0 0 1 0-1.414 1 1 0 0 1 1.414 0L10 14.586l6.293-6.293A1 1 0 0 1 17 8\"\n})));\nexport default SvgStepDone;","import { Settings } from \"./settings\";\nimport { Dispatcher } from \"./studio-state\";\n\n\nconst mergeHeightConstraint = (\n  maxHeight: number | undefined,\n  videoConstraints: MediaTrackConstraints,\n  fallbackIdeal?: number,\n) => {\n  const maxField = maxHeight && { max: maxHeight };\n  const constraintIdeal = typeof videoConstraints?.height === \"number\"\n    ? videoConstraints.height\n    : videoConstraints.height?.ideal;\n  const ideal = constraintIdeal ?? fallbackIdeal;\n  const idealField = ideal && (maxHeight ? { ideal: Math.min(ideal, maxHeight) } : { ideal });\n\n  return { height: { ...maxField, ...idealField } };\n};\n\nexport async function startAudioCapture(dispatch: Dispatcher, deviceId?: ConstrainDOMString) {\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      audio: deviceId ? { deviceId } : true,\n      video: false,\n    });\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: \"AUDIO_UNEXPECTED_END\" });\n      };\n    });\n\n    dispatch({ type: \"SHARE_AUDIO\", stream });\n  } catch (err) {\n    // TODO: there several types of exceptions; certainly we should differentiate here one day\n    console.error(\"Error: \", err);\n\n    dispatch({ type: \"BLOCK_AUDIO\" });\n  }\n}\n\nexport async function startDisplayCapture(\n  dispatch: Dispatcher,\n  settings: Settings,\n  videoConstraints: MediaTrackConstraints = {},\n) {\n  const maxFps = settings.display?.maxFps\n    ? { frameRate: { max: settings.display.maxFps } }\n    : {};\n  const height = mergeHeightConstraint(settings.display?.maxHeight, videoConstraints);\n\n  const constraints = {\n    video: {\n      cursor: \"always\",\n      ...maxFps,\n      ...videoConstraints,\n      ...height,\n    },\n    audio: true,\n  };\n\n  try {\n    const stream = await navigator.mediaDevices.getDisplayMedia(constraints);\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: \"DISPLAY_UNEXPECTED_END\" });\n      };\n    });\n\n    dispatch({ type: \"SHARE_DISPLAY\", stream });\n  } catch (err) {\n    // TODO: there 7 types of exceptions; certainly we should differentiate here one day\n    console.error(\"Error: \", err);\n\n    dispatch({ type: \"BLOCK_DISPLAY\" });\n  }\n}\n\nexport async function startUserCapture(\n  dispatch: Dispatcher,\n  settings: Settings,\n  videoConstraints: MediaTrackConstraints,\n) {\n  const maxFps = settings.camera?.maxFps\n    ? { frameRate: { max: settings.camera.maxFps } }\n    : {};\n  const height = mergeHeightConstraint(settings.camera?.maxHeight, videoConstraints, 1080);\n\n  const constraints = {\n    video: {\n      facingMode: \"user\",\n      ...videoConstraints,\n      ...maxFps,\n      ...height,\n    },\n    audio: false,\n  };\n\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia(constraints);\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: \"USER_UNEXPECTED_END\" });\n      };\n    });\n    dispatch({ type: \"SHARE_USER\", stream });\n  } catch (err) {\n    // TODO: there 7 types of exceptions; certainly we should differentiate here one day\n    console.error(\"Error: \", err);\n\n    dispatch({ type: \"BLOCK_USER\" });\n  }\n}\n\n// ----------------------------------------------------------------------------\n\nexport function stopCapture(\n  { audioStream, displayStream, userStream }: {\n    audioStream: MediaStream | null;\n    displayStream: MediaStream | null;\n    userStream: MediaStream | null;\n  },\n  dispatch: Dispatcher,\n) {\n  stopAudioCapture(audioStream, dispatch);\n  stopDisplayCapture(displayStream, dispatch);\n  stopUserCapture(userStream, dispatch);\n}\n\nexport function stopAudioCapture(stream: MediaStream | null, dispatch: Dispatcher) {\n  stream?.getTracks().forEach(track => track.stop());\n  dispatch({ type: \"UNSHARE_AUDIO\" });\n}\n\nexport function stopDisplayCapture(stream: MediaStream | null, dispatch: Dispatcher) {\n  stream?.getTracks().forEach(track => track.stop());\n  dispatch({ type: \"UNSHARE_DISPLAY\" });\n}\n\nexport function stopUserCapture(stream: MediaStream | null, dispatch: Dispatcher) {\n  stream?.getTracks().forEach(track => track.stop());\n  dispatch({ type: \"UNSHARE_USER\" });\n}\n","import useResizeObserver from \"use-resize-observer/polyfilled\";\nimport React, { useRef, useState } from \"react\";\nimport equal from \"fast-deep-equal\";\n\nimport { usePresentContext } from \"../util\";\nimport { bug } from \"@opencast/appkit\";\n\n\nconst VideoBoxResizeContext = React.createContext<(() => void) | null>(null);\n\nexport const useVideoBoxResize = () =>\n  usePresentContext(VideoBoxResizeContext, \"useVideoBoxResize\");\n\nexport type VideoBoxProps = {\n  gap?: number;\n  minWidth?: number;\n  minHeight?: number;\n  children: VideoBoxChild[];\n};\n\nexport type VideoBoxChild = {\n  body: JSX.Element;\n  dimensions: () => [number, number] | null;\n  /**\n   * If `false` (default), the calculated size is used for the divs. Otherwise,\n   * `width` and `height` are unset, which means the div takes the size of its\n   * child. Used for error messages.\n   */\n  autoSize?: boolean;\n};\n\n// Manages one or two children with given aspect ratio.\n//\n// Each child is given an aspect ratio. The child will be rendered within a\n// `<div>` that maintains this exact aspect ratio. In the one child case, that\n// `<div>` also perfectly fits within the parent container. In the case of two\n// children, those children are laid out in such a way that the utilized screen\n// space is maximized while both children have the same width or height.\n//\n// `children` has to be the length 1 or 2! The parameter `gap` specifies the\n// width of the empty space between the two children in the case that two\n// children are given.\n//\n// Each child in `children` needs to be an object with the following fields:\n//\n// - `body`: the rendered DOM.\n// - `dimensions`: a function returning `[width, height]` of the child (also\n//   defining the aspect ratio). We require the dimensions instead of only the\n//   aspect ratio to better detect changes in the video stream.\nexport const VideoBox: React.FC<VideoBoxProps> = ({\n  gap = 0,\n  minWidth = 180,\n  minHeight = 140,\n  children,\n}) => {\n  const { ref, width = 1, height = 1 } = useResizeObserver();\n\n  // This is a dummy state to force a rerender.\n  const [, setForceCounter] = useState(0);\n  const forceRender = () => setForceCounter(v => v + 1);\n\n  // We try to remember the last valid dimension. Otherwise, changing video\n  // preferences for a non-16:9 strean leads to visual noise: the box always\n  // changes between its aspect ratio and the fallback 16:9 ratio.\n  const lastDimensions = useRef<([number, number] | null)[]>(children.map(() => null));\n  const updateLastDimensions = (newDimensions: ([number, number] | null)[]) => {\n    newDimensions.forEach((dimension, i) => {\n      if (dimension) {\n        lastDimensions.current[i] = dimension;\n      }\n    });\n  };\n\n  // Setup the handler for when a video stream is resized.\n  let dimensions = children.map(c => c.dimensions());\n  updateLastDimensions(dimensions);\n  const resizeVideoBox = () => {\n    const newDimensions = children.map(c => c.dimensions());\n    if (!equal(newDimensions, dimensions)) {\n      dimensions = newDimensions;\n      updateLastDimensions(dimensions);\n      forceRender();\n    }\n  };\n\n  const ar = (dimensions: [number, number] | null): number =>\n    dimensions == null ? 16 / 9 : dimensions[0] / dimensions[1];\n\n\n  switch (children.length) {\n    case 1: {\n      const child = children[0];\n      const aspectRatio = ar(lastDimensions.current[0]);\n\n      // Calculate size of child\n      let childWidth: number;\n      let childHeight: number;\n\n      if (width > height * aspectRatio) {\n        // Child height perfectly matches container, extra space left and right\n        childHeight = height;\n        childWidth = height * aspectRatio;\n      } else {\n        // Child width perfectly matches container, extra space top and bottom\n        childWidth = width;\n        childHeight = (width / aspectRatio);\n      }\n\n      return (\n        <VideoBoxResizeContext.Provider value={resizeVideoBox}>\n          <div ref={ref} css={{ flex: \"1 0 0\", minHeight, display: \"flex\" }}>\n            <div css={{\n              ...!child.autoSize && {\n                height: childHeight,\n                width: childWidth,\n              },\n              minWidth: `${minWidth}px`,\n              margin: \"auto\",\n            }}>\n              { child.body }\n            </div>\n          </div>\n        </VideoBoxResizeContext.Provider>\n      );\n    }\n    case 2: {\n      // We need to decide whether the two videos are side by side or if one\n      // should be below the other. We calculate the utilized space for each\n      // option and then take the option that utilizes more space.\n      //\n      // Below we need to figure out the aspect ratios of the combined videos\n      // either in row or column layout. Consider this table:\n      //\n      // |             | a      | b      | row    | column |\n      // | ----------- | ------ | ------ | ------ | ------ |\n      // | aspect      | 16:9   | 4:3    | 28:9   | 16:21  |\n      // | normalized  | 1.77:1 | 1.33:1 | 3.11:1 | 0.76:1 |\n      //\n      // It shows the two aspect ratios a and b combined in both ways. In the\n      // \"row\" case, the combined aspect ratio is simple: just add both children\n      // aspect ratios. The column case is more difficult. First we have to\n      // normalize both with respect to the width. This results in 1:0.56 and\n      // 1:0.75 respectively. We can now add those, resulting in 1:1.31.\n      // Finally, we normalize with respect to height again: 0.76:1\n\n      const aspectRatios = lastDimensions.current.map(d => ar(d));\n\n      // Videos side by side (row).\n      const { rowWidths, rowHeights } = (() => {\n        const availableWidth = width - gap;\n        const combinedAspectRatio = aspectRatios[0] + aspectRatios[1];\n        if (availableWidth > height * combinedAspectRatio) {\n          // Children height perfectly matches container, extra space left and\n          // right.\n          return {\n            rowHeights: Array(2).fill(height),\n            rowWidths: aspectRatios.map(ar => height * ar),\n          };\n        } else {\n          // Children width perfectly matches container, extra space top and\n          // bottom.\n          const baseHeight = availableWidth / combinedAspectRatio;\n          return {\n            rowHeights: children.map(() => baseHeight),\n            rowWidths: aspectRatios.map(ar => baseHeight * ar),\n          };\n        }\n      })();\n\n      // One video below the other (col/column).\n      const { colWidths, colHeights } = (() => {\n        const availableHeight = height - gap;\n        const combinedAspectRatio =\n          1 / ((1 / aspectRatios[0]) + (1 / aspectRatios[1]));\n\n        if (width > availableHeight * combinedAspectRatio) {\n          // Children height perfectly matches container, extra space left and\n          // right.\n          const width = availableHeight * combinedAspectRatio;\n          return {\n            colHeights: children.map((_c, i) => (width / aspectRatios[i])),\n            colWidths: Array(2).fill(width),\n          };\n        } else {\n          // Children width perfectly matches container, extra space top and\n          // bottom.\n          return {\n            colHeights: children.map((_c, i) => (width / aspectRatios[i])),\n            colWidths: Array(2).fill(width),\n          };\n        }\n      })();\n\n      // Finally, we compare the areas the two layouts would use. The one with\n      // the larger area utilized wins.\n      const rowArea = rowWidths[0] * rowHeights[0] + rowWidths[1] * rowHeights[1];\n      const colArea = colWidths[0] * colHeights[0] + colWidths[1] * colHeights[1];\n      let widths: number[];\n      let heights: number[];\n      let flexDirection: \"row\" | \"column\";\n      if (rowArea > colArea) {\n        flexDirection = \"row\";\n        widths = rowWidths;\n        heights = rowHeights;\n      } else {\n        flexDirection = \"column\";\n        widths = colWidths;\n        heights = colHeights;\n      }\n\n      return (\n        <VideoBoxResizeContext.Provider value={resizeVideoBox}>\n          <div\n            ref={ref}\n            css={{\n              flex: \"1 0 0\",\n              display: \"flex\",\n              gap: gap,\n              flexDirection,\n              justifyContent: \"space-between\",\n              minHeight,\n            }}\n          >\n            <div css={{\n              ...!children[0].autoSize && {\n                height: heights[0],\n                width: widths[0],\n              },\n              minWidth: `${minWidth}px`,\n              margin: \"auto\",\n            }}>\n              { children[0].body }\n            </div>\n            <div css={{\n              ...!children[1].autoSize && {\n                height: heights[1],\n                width: widths[1],\n              },\n              minWidth: `${minWidth}px`,\n              margin: \"auto\",\n            }}>\n              { children[1].body }\n            </div>\n          </div>\n        </VideoBoxResizeContext.Provider>\n      );\n    }\n    default:\n      return bug(\"Internal error: too few or too many video streams\");\n  }\n};\n","import { COLORS } from \"../util\";\n\n\ntype ErrorBoxProps = {\n  title?: string;\n  body: string;\n  extraBody?: string;\n  className?: string;\n};\n\nexport const ErrorBox: React.FC<ErrorBoxProps> = ({ title, body, extraBody, ...rest }) => (\n  <div\n    aria-live=\"polite\"\n    css={{\n      padding: \"16px 22px\",\n      margin: 12,\n      borderRadius: 8,\n      backgroundColor: COLORS.danger1,\n      color: COLORS.danger5,\n    }}\n    {...rest}\n  >\n    {title && <strong css={{ display: \"block\", fontSize: 17, marginBottom: 8 }}>{title}</strong>}\n    <div css={{ fontSize: 15, maxWidth: \"100ch\" }}>{body}</div>\n    {extraBody && <div css={{ fontSize: 15, maxWidth: \"100ch\", marginTop: 8 }}>{extraBody}</div>}\n  </div>\n);\n","import React from \"react\";\n\nimport { COLORS, focusStyle } from \"../util\";\nimport { useColorScheme } from \"@opencast/appkit\";\n\n\ntype Props = JSX.IntrinsicElements[\"select\"];\n\n/** Styled `<select>` */\nexport const Select = React.forwardRef<HTMLSelectElement, Props>((props, ref) => (\n  <select ref={ref} {...props} css={{\n    position: \"relative\",\n    borderRadius: 6,\n    padding: \"6px 12px\",\n    paddingRight: 32,\n    backgroundColor: \"transparent\",\n    border: `1px solid ${COLORS.neutral25}`,\n\n    // Remove any browser styles and re-add custom arrow\n    appearance: \"none\",\n    background: 'url(\"data:image/svg+xml;utf8,'\n      + \"<svg xmlns='http://www.w3.org/2000/svg' width='2' height='1' \"\n      + `fill='${useColorScheme().scheme === \"light\" ? \"%23555\" : \"%23aaa\"}'>`\n      + \"<polygon points='0,0 2,0 1,1'/>\"\n      + '</svg>\") no-repeat',\n    backgroundSize: 12,\n    backgroundPosition: \"calc(100% - 12px) center\",\n\n    option: {\n      backgroundColor: COLORS.neutral05,\n      color: COLORS.neutral90,\n    },\n    ...focusStyle({ offset: -1 }),\n  }}>{props.children}</select>\n));\n","// Everything related to video stream preferences that the user can modify.\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { useTranslation, Trans } from \"react-i18next\";\nimport {\n  Floating, FloatingContainer, FloatingHandle, FloatingTrigger, ProtoButton,\n  WithTooltip, screenWidthAtMost, useColorScheme,\n} from \"@opencast/appkit\";\nimport { FiSettings, FiX } from \"react-icons/fi\";\n\nimport { Settings, useSettings } from \"../../settings\";\nimport { COLORS, getUniqueDevices } from \"../../util\";\nimport { useDispatch, useStudioState } from \"../../studio-state\";\nimport {\n  startDisplayCapture,\n  startUserCapture,\n  stopDisplayCapture,\n  stopUserCapture,\n} from \"../../capturer\";\nimport { Select } from \"../../ui/Select\";\nimport { OVERLAY_STYLE } from \"./preview\";\n\n\n/**\n * Creates a valid constraints object from the given preferences. The mapping\n * is as follows:\n *\n * - deviceId: falsy values are ignored, any other value is passed on, either as\n *   `ideal` (if `exactDevice` is `false`) or `exact` (if `exactDevice` is\n *   `true`).\n * - aspectRatio: values in `ASPECT_RATIOS` are passed as `ideal`, everything\n *   else is ignored.\n * - quality: valid quality labels are passed on as `ideal` height, invalid ones\n *   are ignored.\n */\nexport const prefsToConstraints = (\n  prefs: CameraPrefs | DisplayPrefs,\n  exactDevice = false,\n): MediaTrackConstraints => {\n  const deviceConstraint = \"deviceId\" in prefs\n    && { deviceId: { [exactDevice ? \"exact\" : \"ideal\"]: prefs.deviceId } };\n\n  const aspectRatioConstraint = \"aspectRatio\" in prefs && {\n    aspectRatio: { ideal: prefs.aspectRatio ? parseAspectRatio(prefs.aspectRatio) : undefined },\n  };\n\n  const heightConstraint = \"quality\" in prefs && {\n    height: { ideal: prefs.quality ? parseQuality(prefs.quality) : undefined },\n  };\n\n  return {\n    ...deviceConstraint,\n    ...aspectRatioConstraint,\n    ...heightConstraint,\n  };\n};\n\n// All aspect ratios the user can choose from.\nconst ASPECT_RATIOS = [\"4:3\", \"16:9\"];\n\n// All quality options given to the user respecting the `maxHeight` from the\n// settings.\nconst qualityOptions = (maxHeight: number | undefined) => {\n  const defaults = [360, 480, 720, 1080, 1440, 2160];\n  const out = defaults.filter(q => !maxHeight || q <= maxHeight);\n  if (maxHeight && (out.length === 0 || out[out.length - 1] !== maxHeight)) {\n    out.push(maxHeight);\n  }\n\n  return out.map(n => `${n}p`);\n};\n\n// Converts the given aspect ratio label (one of the elements in\n// `ASPECT_RATIOS`) into the numerical ratio, e.g. 4/3 = 1.333. If the argument\n// is not a valid label, `null` is returned.\nconst parseAspectRatio = (label: string) => {\n  const mapping = {\n    \"4:3\": 4 / 3,\n    \"16:9\": 16 / 9,\n  };\n\n  return (mapping as Record<string, number>)[label] ?? undefined;\n};\n\n// Converts the given quality label to the actual height as number. If the\n// argument is not a valid quality label (e.g. '720p'), `null` is returned.\nconst parseQuality = (label: string) => {\n  if (!/^[0-9]+p$/.test(label)) {\n    return undefined;\n  }\n\n  return parseInt(label);\n};\n\n// Local storage keys\nconst LAST_VIDEO_DEVICE_KEY = \"ocStudioLastVideoDevice\";\nconst CAMERA_ASPECT_RATIO_KEY = \"ocStudioCameraAspectRatio\";\nconst CAMERA_QUALITY_KEY = \"ocStudioCameraQuality\";\nconst DISPLAY_QUALITY_KEY = \"ocStudioDisplayQuality\";\n\ntype CameraPrefs = {\n  deviceId?: string;\n  aspectRatio?: string;\n  quality?: string;\n};\n\ntype DisplayPrefs = {\n  quality?: string;\n};\n\n// Loads the initial camera preferences from local storage.\nexport const loadCameraPrefs = (): CameraPrefs => ({\n  deviceId: window.localStorage.getItem(LAST_VIDEO_DEVICE_KEY) ?? undefined,\n  aspectRatio: window.localStorage.getItem(CAMERA_ASPECT_RATIO_KEY) || \"auto\",\n  quality: window.localStorage.getItem(CAMERA_QUALITY_KEY) || \"auto\",\n});\n\n// Loads the initial display preferences from local storage.\nexport const loadDisplayPrefs = (): DisplayPrefs => ({\n  quality: window.localStorage.getItem(DISPLAY_QUALITY_KEY) || \"auto\",\n});\n\ntype StreamSettingsProps = {\n  isDesktop: boolean;\n  stream: MediaStream | null;\n}\n\nexport const StreamSettings: React.FC<StreamSettingsProps> = ({ isDesktop, stream }) => {\n  const dispatch = useDispatch();\n  const settings = useSettings();\n  const floatRef = useRef<FloatingHandle>(null);\n  const { t } = useTranslation();\n  const isLight = useColorScheme().scheme === \"light\";\n  const { isHighContrast } = useColorScheme();\n\n  // The current preferences and the callback to update them.\n  const prefs = isDesktop ? loadDisplayPrefs() : loadCameraPrefs();\n  const updatePrefs = (newPrefs: CameraPrefs | DisplayPrefs) => {\n    // Merge and update preferences.\n    const merged = { ...prefs, ...newPrefs };\n    const constraints = prefsToConstraints(merged, true);\n\n    const setOpt = (key: string, v: string | undefined) => {\n      if (v != null) {\n        window.localStorage.setItem(key, v);\n      }\n    };\n\n    // Update preferences in local storage and re-request stream. The latter\n    // will cause the rerender.\n    if (isDesktop) {\n      setOpt(DISPLAY_QUALITY_KEY, merged.quality);\n\n      stopDisplayCapture(stream, dispatch);\n      startDisplayCapture(dispatch, settings, constraints);\n    } else {\n      setOpt(LAST_VIDEO_DEVICE_KEY, (merged as Record<string, string>)[\"deviceId\"]);\n      setOpt(CAMERA_ASPECT_RATIO_KEY, (merged as Record<string, string>)[\"aspectRatio\"]);\n      setOpt(CAMERA_QUALITY_KEY, merged.quality);\n\n      stopUserCapture(stream, dispatch);\n      startUserCapture(dispatch, settings, constraints);\n    }\n  };\n\n  // Store the camera device ID in local storage. We also do this here, as we\n  // also want to remember the device the user initially selected in the browser\n  // popup.\n  useEffect(() => {\n    const cameraDeviceId = deviceIdOf(stream);\n    if (!isDesktop && cameraDeviceId) {\n      window.localStorage.setItem(LAST_VIDEO_DEVICE_KEY, cameraDeviceId);\n    }\n  });\n\n  // State about expanding and hiding the settings.\n  const [isExpanded, setIsExpanded] = useState(false);\n  const label = t(`steps.video.video-settings-${isExpanded ? \"close\" : \"open\"}` as const);\n\n  return <>\n    {/* Stream info at the top */}\n    <div css={{\n      display: isExpanded ? \"initial\" : \"none\",\n      position: \"absolute\",\n      top: 12,\n      left: 0,\n      right: 0,\n      textAlign: \"center\",\n    }}>\n      <span css={{\n        color: isLight ? COLORS.neutral70 : COLORS.neutral90,\n        backgroundColor: COLORS.neutral05,\n        borderRadius: \"10px\",\n        padding: \"4px 8px\",\n        boxShadow: isHighContrast ? \"none\" : \"0 0 12px rgba(0, 0, 0, 30%)\",\n      }}>\n        {streamInfo(stream)}\n      </span>\n    </div>\n\n    {/* The settings button and the popover dialog */}\n    <FloatingContainer\n      ref={floatRef}\n      placement=\"top-end\"\n      ariaRole=\"dialog\"\n      open={isExpanded}\n      onClose={() => setIsExpanded(false)}\n      borderRadius={8}\n      viewPortMargin={8}\n      css={{\n        position: \"absolute\",\n        right: 8,\n        bottom: 8,\n      }}\n    >\n      <FloatingTrigger>\n        <WithTooltip placement=\"bottom\" tooltip={label}>\n          <ProtoButton\n            onClick={() => setIsExpanded(old => !old)}\n            aria-label={label}\n            css={{\n              ...OVERLAY_STYLE,\n              fontSize: 26,\n              \"> svg\": {\n                transition: \"transform 0.2s\",\n              },\n              \"&:hover > svg, &:focus > svg\": {\n                transform: isExpanded ? \"none\" : \"rotate(45deg)\",\n              },\n            }}\n          >\n            {isExpanded ? <FiX /> : <FiSettings />}\n          </ProtoButton>\n        </WithTooltip>\n      </FloatingTrigger>\n      <Floating\n        css={{ maxWidth: \"min(670px, 100vw - 16px)\" }}\n        borderWidth={isLight ? 0 : 1}\n        shadowBlur={16}\n        padding={18}\n      >\n        <div css={{\n          display: \"grid\",\n          width: \"100%\",\n          gridTemplateColumns: \"auto 1fr\",\n          gridGap: \"14px 32px\",\n          paddingLeft: 4,\n          [screenWidthAtMost(450)]: {\n            columnGap: 8,\n          },\n          [screenWidthAtMost(360)]: {\n            gridTemplateColumns: \"1fr\",\n            rowGap: 0,\n          },\n          fontSize: 14,\n          \"@media (min-width: 420px) and (min-height: 440px)\": {\n            fontSize: 16,\n          },\n        }}>\n          {!isDesktop && <UserSettings {...{ updatePrefs, prefs, isExpanded }} />}\n          <UniveralSettings {...{ isDesktop, updatePrefs, prefs, stream, settings, isExpanded }} />\n        </div>\n\n        <div css={{\n          backgroundColor: COLORS.neutral15,\n          marginTop: 8,\n          padding: \"8px 12px\",\n          fontSize: 12,\n          lineHeight: 1.25,\n          borderRadius: 6,\n          \"@media (min-width: 420px) and (min-height: 440px)\": {\n            fontSize: 14,\n          },\n        }}>\n          <Trans i18nKey=\"steps.video.preferences-note\">\n            <strong>Note:</strong> Explanation.\n          </Trans>\n        </div>\n      </Floating>\n    </FloatingContainer>\n  </>;\n};\n\nconst streamInfo = (stream: MediaStream | null) => {\n  const s = stream?.getVideoTracks()?.[0]?.getSettings();\n  const sizeInfo = (s && s.width && s.height) ? `${s.width}×${s.height}` : \"\";\n  const fpsInfo = (s && s.frameRate) ? `${s.frameRate} fps` : \"\";\n\n  return s ? [sizeInfo, fpsInfo].join(\", \") : \"...\";\n};\n\n/** Div for the name of a value, e.g. quality, aspect ratio, .. */\nconst PrefKey: React.FC<React.PropsWithChildren> = ({ children }) => (\n  <div css={{\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n    [screenWidthAtMost(360)]: {\n      marginTop: 4,\n    },\n  }}>\n    { children }\n  </div>\n);\n\n/** Container for the value selection of an option, e.g. all available qualities. */\nconst PrefValue: React.FC<React.PropsWithChildren> = ({ children }) => (\n  <div css={{\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    gap: 6,\n  }}>\n    { children }\n  </div>\n);\n\ntype UniveralSettingsProps = {\n  isDesktop: boolean;\n  updatePrefs: (p: CameraPrefs | DisplayPrefs) => void;\n  prefs: CameraPrefs | DisplayPrefs;\n  settings: Settings;\n};\n\nconst UniveralSettings: React.FC<UniveralSettingsProps> = (\n  { isDesktop, updatePrefs, prefs, settings },\n) => {\n  const { t } = useTranslation();\n\n  const changeQuality = (quality: string) => updatePrefs({ quality });\n  const maxHeight = isDesktop ? settings.display?.maxHeight : settings.camera?.maxHeight;\n  const qualities = qualityOptions(maxHeight);\n  const kind = isDesktop ? \"desktop\" : \"user\";\n\n  return <>\n    <PrefKey>{t(\"steps.video.quality\")}</PrefKey>\n    <PrefValue>\n      <RadioButton\n        id={`quality-auto-${kind}`}\n        value=\"auto\"\n        name={`quality-${kind}`}\n        label={t(\"steps.video.quality-auto\")}\n        onChange={changeQuality}\n        checked={qualities.every(q => prefs.quality !== q)}\n      />\n      {\n        qualities.map(q => (\n          <RadioButton\n            key={`${q}-${kind}`}\n            id={`quality-${q}-${kind}`}\n            value={q}\n            name={`quality-${kind}`}\n            onChange={changeQuality}\n            checked={prefs.quality === q}\n          />\n        ))\n      }\n    </PrefValue>\n  </>;\n};\n\ntype UserSettingsProps = {\n  updatePrefs: (p: CameraPrefs | DisplayPrefs) => void;\n  prefs: CameraPrefs;\n};\n\n\nconst UserSettings: React.FC<UserSettingsProps> = ({ updatePrefs, prefs }) => {\n  const { t } = useTranslation();\n  const state = useStudioState();\n\n  const currentDeviceId = deviceIdOf(state.userStream);\n  const devices = getUniqueDevices(state.mediaDevices, \"videoinput\");\n\n  const changeDevice = (id: string) => updatePrefs({ deviceId: id });\n  const changeAspectRatio = (ratio: string) => updatePrefs({ aspectRatio: ratio });\n\n  return <>\n    <PrefKey>\n      <label htmlFor=\"sources-video-device\">{t(\"steps.video.device\")}</label>\n    </PrefKey>\n    <PrefValue>\n      <Select\n        id=\"sources-video-device\"\n        value={currentDeviceId}\n        onChange={e => changeDevice(e.target.value)}\n        css={{ width: \"100%\" }}\n      >\n        {devices.map(d => <option key={d.deviceId} value={d.deviceId}>{d.label}</option>)}\n      </Select>\n    </PrefValue>\n\n    <PrefKey>{t(\"steps.video.aspect-ratio\")}</PrefKey>\n    <PrefValue>\n      <RadioButton\n        id=\"ar-auto\"\n        value=\"auto\"\n        name=\"aspectRatio\"\n        label={t(\"steps.video.aspect-ratio-auto\")}\n        onChange={changeAspectRatio}\n        checked={ASPECT_RATIOS.every(x => prefs.aspectRatio !== x)}\n      />\n      {ASPECT_RATIOS.map(ar => (\n        <RadioButton\n          key={ar}\n          id={`ar-${ar}`}\n          value={ar}\n          name=\"aspectRatio\"\n          onChange={changeAspectRatio}\n          checked={prefs.aspectRatio === ar}\n        />\n      ))}\n    </PrefValue>\n  </>;\n};\n\ntype RadioButtonProps = {\n  id: string;\n  name: string;\n  value: string;\n  checked: boolean;\n  label?: string;\n  onChange: (v: string) => void;\n};\n\n// A styled radio input which looks like a button.\nconst RadioButton: React.FC<RadioButtonProps> = ({\n  id, value, checked, name, onChange, label,\n}) => {\n  const { isHighContrast } = useColorScheme();\n\n  return <div>\n    <input\n      type=\"radio\"\n      onChange={e => onChange(e.target.value)}\n      {...{ id, value, checked, name }}\n      css={{\n        display: \"none\",\n        \"&+label\": {\n          display: \"block\",\n          border: `1px solid ${COLORS.neutral25}`,\n          lineHeight: 1.2,\n          padding: \"4px 10px\",\n          borderRadius: 6,\n          fontWeight: 500,\n          cursor: \"pointer\",\n          \":hover\": {\n            backgroundColor: COLORS.neutral10,\n            borderColor: COLORS.neutral40,\n            ...isHighContrast && {\n              outline: `2px solid ${COLORS.accent4}`,\n              borderColor: \"transparent\",\n            },\n          },\n        },\n        \"&:checked+label\": {\n          backgroundColor: COLORS.accent6,\n          borderColor: COLORS.accent6,\n          color: COLORS.neutral05,\n          cursor: \"default\",\n        },\n      }}\n    />\n    <label\n      tabIndex={0}\n      onKeyDown={e => (e.key === \"Enter\" || e.key === \" \") && onChange(value)}\n      htmlFor={id}\n    >{label ?? value}</label>\n  </div>;\n};\n\n// Returns the devide ID of the video track of the given stream.\nexport const deviceIdOf = (stream: MediaStream | null) =>\n  stream?.getVideoTracks()?.[0]?.getSettings()?.deviceId;\n","import { useEffect, useRef } from \"react\";\nimport { Spinner, WithTooltip, match, unreachable, useColorScheme } from \"@opencast/appkit\";\nimport { Trans, useTranslation } from \"react-i18next\";\nimport { LuInfo, LuVolume2, LuVolumeX } from \"react-icons/lu\";\n\nimport { COLORS, dimensionsOf } from \"../../util\";\nimport { VideoBox, useVideoBoxResize } from \"../../ui/VideoBox\";\nimport { ErrorBox } from \"../../ui/ErrorBox\";\nimport { StreamSettings } from \"./prefs\";\nimport { Input } from \".\";\n\n\n\nexport type SourcePreviewProps = {\n  inputs: Input[];\n}\n\n/**\n * Shows the preview for one or two input streams. The previews also show\n * preferences allowing the user to change the webcam and the like.\n */\nexport const SourcePreview: React.FC<SourcePreviewProps> = ({ inputs }) => {\n  const children = match(inputs.length, {\n    1: () => [{\n      body: <StreamPreview input={inputs[0]} />,\n      dimensions: () => dimensionsOf(inputs[0].stream),\n      autoSize: inputHasError(inputs[0]),\n    }],\n    2: () => [\n      {\n        body: <StreamPreview input={inputs[0]} />,\n        dimensions: () => dimensionsOf(inputs[0].stream),\n        autoSize: inputHasError(inputs[0]),\n      },\n      {\n        body: <StreamPreview input={inputs[1]} />,\n        dimensions: () => dimensionsOf(inputs[1].stream),\n        autoSize: inputHasError(inputs[1]),\n      },\n    ],\n  }) ?? unreachable();\n\n  return <VideoBox gap={20}>{children}</VideoBox>;\n};\n\nconst inputHasError = (input: Input): boolean =>\n  input.allowed === false || !!input.unexpectedEnd;\n\n/** Shows a single stream as preview, deals with potential errors and shows preferences UI */\nconst StreamPreview: React.FC<{ input: Input }> = ({ input }) => {\n  const { isHighContrast } = useColorScheme();\n\n  return (\n    <div css={{\n      height: \"100%\",\n      backgroundColor: COLORS.neutral05,\n      borderRadius: 12,\n      position: \"relative\",\n      ...!inputHasError(input) && {\n        boxShadow: isHighContrast ? \"none\" : \"0 6px 16px rgba(0, 0, 0, 0.2)\",\n      },\n      ...isHighContrast && {\n        outline: `1px solid ${COLORS.neutral90}`,\n      },\n    }}>\n      <PreviewVideo input={input} />\n      {input.stream && <>\n        {input.isDesktop && <DisplayAudioInfo stream={input.stream} />}\n        <StreamSettings isDesktop={input.isDesktop} stream={input.stream} />\n      </>}\n    </div>\n  );\n};\n\nconst PreviewVideo: React.FC<{ input: Input }> = ({ input }) => {\n  const { t } = useTranslation();\n  const { allowed, stream, unexpectedEnd } = input;\n  const resizeVideoBox = useVideoBoxResize();\n\n  const videoRef = useRef<HTMLVideoElement>(null);\n  useEffect(() => {\n    const v = videoRef.current;\n    if (v) {\n      if (!v.srcObject) {\n        v.srcObject = stream;\n      }\n      v.addEventListener(\"resize\", resizeVideoBox);\n    }\n\n    return () => {\n      if (v) {\n        v.removeEventListener(\"resize\", resizeVideoBox);\n      }\n    };\n  }, [stream, resizeVideoBox]);\n\n  if (!stream) {\n    let inner: JSX.Element;\n    if (allowed === false || unexpectedEnd) {\n      inner = <div>\n        {allowed === false && <ErrorBox\n          css={{ margin: 0 }}\n          title={t(`steps.video.${input.isDesktop ? \"display\" : \"user\"}-not-allowed-title`)}\n          body={t(`steps.video.${input.isDesktop ? \"display\" : \"user\"}-not-allowed-text`)}\n        />}\n        {/* TODO: differentiate between desktop and camera for better error */}\n        {unexpectedEnd && <ErrorBox css={{ margin: 0 }} body={t(\"error-lost-video-stream\")} />}\n      </div>;\n    } else {\n      inner = <Spinner size={75} css={{ color: COLORS.neutral60 }} />;\n    }\n\n    return (\n      <div css={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        width: \"100%\",\n        height: \"100%\",\n      }}>\n        <div css={{\n          flex: \"1\",\n          display: \"flex\",\n          justifyContent: \"center\",\n          alignItems: \"center\",\n        }}>\n          {inner}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div css={{\n      position: \"relative\",\n    }}>\n      <video\n        ref={videoRef}\n        autoPlay\n        muted\n        playsInline\n        css={{\n          minHeight: 0,\n          display: \"block\",\n          width: \"100%\",\n          height: \"100%\",\n          borderRadius: 12,\n        }}\n      />\n    </div>\n  );\n};\n\nexport const DisplayAudioInfo: React.FC<{ stream: MediaStream }> = ({ stream }) => {\n  const hasAudio = stream.getAudioTracks().length;\n\n  return (\n    <div css={{\n      position: \"absolute\",\n      top: 8,\n      right: 8,\n    }}>\n      <WithTooltip\n        placement=\"top\"\n        tooltip={\n          <Trans i18nKey={\n            `steps.video.${hasAudio ? \"display-audio-shared\" : \"display-audio-not-shared\"}`\n          }>\n            <strong>Note:</strong> Explanation.\n          </Trans>\n        }\n      >\n        <div css={{ ...OVERLAY_STYLE, fontSize: 15 }}>\n          <LuInfo /> {hasAudio ? <LuVolume2 /> : <LuVolumeX />}\n        </div>\n      </WithTooltip>\n    </div>\n  );\n};\n\nexport const OVERLAY_STYLE = {\n  border: \"none\",\n  display: \"inline-block\",\n  backgroundColor: \"rgba(0, 0, 0, 0.3)\",\n  color: \"white\",\n  padding: 8,\n  backdropFilter: \"invert(0.3) blur(4px)\",\n  lineHeight: 0,\n  borderRadius: 10,\n  cursor: \"pointer\",\n  \"&:hover, &:focus-visible\": {\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n  },\n  \"&:focus-visible\": {\n    outline: \"5px dashed white\",\n    outlineOffset: -2.5,\n  },\n};\n","import React, { useEffect, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { match, screenWidthAtMost, useColorScheme } from \"@opencast/appkit\";\nimport { LuArrowBigUp, LuOption } from \"react-icons/lu\";\nimport { FiArrowLeft, FiArrowRight, FiCommand } from \"react-icons/fi\";\nimport { Options, useHotkeys } from \"react-hotkeys-hook\";\n\nimport { COLORS } from \"./util\";\nimport { OverlayBox } from \"./layout\";\n\n\nconst onMac = () => navigator.userAgent.includes(\"Mac\");\n\nexport const SHORTCUTS = {\n  general: {\n    showAvailableShortcuts: \"Alt; s\",\n    showOverview: \"?\",\n    closeOverlay: \"Escape\",\n    tab: \"Tab\",\n    prev: onMac() ? \"Shift+Mod+left\" : \"Mod+left\",\n    next: onMac() ? \"Shift+Mod+right\" : \"Mod+right\",\n  },\n  videoSetup: {\n    selectScreen: \"1\",\n    selectBoth: \"2\",\n    selectUser: \"3\",\n  },\n  audioSetup: {\n    withAudio: \"1\",\n    withoutAudio: \"2\",\n  },\n  recording: {\n    startPauseResume: \"k; Space\",\n  },\n  review: {\n    playPause: \"k; Space\",\n    forwards5secs: \"l; right\",\n    backwards5secs: \"j; left\",\n    forwardsFrame: \".\",\n    backwardsFrame: \",\",\n    cutLeft: \"n\",\n    cutRight: \"m\",\n    removeCutLeft: \"Shift+n\",\n    removeCutRight: \"Shift+m\",\n  },\n  finish: {\n    startNewRecording: \"Shift+n\",\n    download: \"d\",\n  },\n} as const;\n\nconst SHORTCUT_TRANSLATIONS = {\n  general: {\n    showAvailableShortcuts: \"shortcuts.general.show-available-shortcuts\",\n    showOverview: \"shortcuts.general.show-overview\",\n    closeOverlay: \"shortcuts.general.close-overlay\",\n    tab: \"shortcuts.general.tab-elements\",\n    prev: \"shortcuts.general.back-button\",\n    next: \"shortcuts.general.next-button\",\n  },\n  videoSetup: {\n    selectScreen: \"shortcuts.select-video.select-display\",\n    selectBoth: \"shortcuts.select-video.select-both\",\n    selectUser: \"shortcuts.select-video.select-camera\",\n  },\n  audioSetup: {\n    withAudio: \"shortcuts.select-audio.select-microphone\",\n    withoutAudio: \"shortcuts.select-audio.select-no-audio\",\n  },\n  recording: {\n    startPauseResume: \"shortcuts.record.start-pause-resume-recording\",\n  },\n  review: {\n    playPause: \"shortcuts.review.play-pause\",\n    forwards5secs: \"shortcuts.review.skip-five\",\n    backwards5secs: \"shortcuts.review.back-five\",\n    forwardsFrame: \"shortcuts.review.frame-forward\",\n    backwardsFrame: \"shortcuts.review.frame-back\",\n    cutLeft: \"shortcuts.review.cut-left\",\n    cutRight: \"shortcuts.review.cut-right\",\n    removeCutLeft: \"shortcuts.review.delete-left\",\n    removeCutRight: \"shortcuts.review.delete-right\",\n  },\n  finish: {\n    startNewRecording: \"shortcuts.finish.new-recording\",\n    download: \"steps.finish.save-locally.label\",\n  },\n} as const;\n\nconst KEY_TRANSLATIONS = {\n  \"Escape\": \"escape\",\n  \"Space\": \"space\",\n  \"Shift\": \"shift\",\n  \"Alt\": onMac() ? \"option\" : \"alt\",\n  \"Mod\": onMac() ? \"command\" : \"control\",\n} as const;\n\n\n/** Like `useHotkeys` but with pre-set options. */\nexport const useShortcut = (\n  keys: string,\n  callback: () => void,\n  options: Omit<Options, \"delimiter\"> = {},\n  deps: unknown[] = [],\n) => {\n  return useHotkeys(keys, callback, { delimiter: \";\", ...options }, deps);\n};\n\n/**\n * Helper to show an overlay of active shortcuts when Alt is pressed. Returns\n * `true` if the overlay should be shown.\n */\nexport const useShowAvailableShortcuts = () => {\n  const [active, setActive] = useState(false);\n  const enable = (event: KeyboardEvent) => {\n    const correctKeyPressed = SHORTCUTS.general.showAvailableShortcuts.split(\";\")\n      .some(s => s.trim().toLowerCase() == event.key.toLowerCase());\n    if (correctKeyPressed) {\n      setActive(true);\n    }\n  };\n  const disable = () => setActive(false);\n\n  useEffect(() => {\n    document.addEventListener(\"keydown\", enable);\n    document.addEventListener(\"keyup\", disable);\n    document.addEventListener(\"mousedown\", disable);\n    window.addEventListener(\"blur\", disable);\n    return () => {\n      document.removeEventListener(\"keydown\", enable);\n      document.removeEventListener(\"keyup\", disable);\n      document.removeEventListener(\"mousedown\", disable);\n      window.removeEventListener(\"blur\", disable);\n    };\n  });\n\n  return active;\n};\n\ntype ShortcutKeysProps = {\n  shortcut: string;\n  large?: boolean;\n};\n\nexport const ShortcutKeys: React.FC<ShortcutKeysProps> = ({ shortcut, large = false }) => {\n  const { t } = useTranslation();\n  return <div css={{ display: \"flex\", alignItems: \"center\", gap: 4, color: COLORS.neutral70 }}>\n    {shortcut.split(\"+\").map((key, i) => {\n      let s = key;\n      if (key in KEY_TRANSLATIONS) {\n        const translationKey = KEY_TRANSLATIONS[key as keyof typeof KEY_TRANSLATIONS];\n        s = t(`shortcuts.keys.${translationKey}`);\n      }\n      const child = match(key, {\n        \"left\": () => <FiArrowLeft title={s} />,\n        \"right\": () => <FiArrowRight title={s} />,\n        \"Mod\": () => onMac() ? <FiCommand title={s} /> : <>{s}</>,\n        \"Alt\": () => onMac() ? <LuOption title={s} /> : <>{s}</>,\n        \"Shift\": () => <LuArrowBigUp size={20} title={s} />,\n      }) ?? <>{s}</>;\n      return (\n        <React.Fragment key={i}>\n          {i !== 0 && \"+\"}\n          <SingleKey large={large} monofont={key === \"l\"}>{child}</SingleKey>\n        </React.Fragment>\n      );\n    })}\n  </div>;\n};\n\ntype SingleKeyProps = React.PropsWithChildren<{\n  large: boolean;\n  /** Whether to use `monospace` font for this one. Basically only useful for lowercase l. */\n  monofont: boolean;\n}>;\n\nconst SingleKey: React.FC<SingleKeyProps> = ({ large, monofont, children }) => {\n  const isLight = useColorScheme().scheme === \"light\";\n  const { scheme, isHighContrast } = useColorScheme();\n\n  const bg = match(scheme, {\n    \"light\": () => COLORS.neutral05,\n    \"dark\": () => COLORS.neutral15,\n    \"light-high-contrast\": () => COLORS.neutral05,\n    \"dark-high-contrast\": () => COLORS.neutral15,\n  });\n\n  return (\n    <div css={{\n      border: `1px solid ${COLORS.neutral50}`,\n      borderRadius: 4,\n      padding: \"2px 6px\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      height: large ? 36 : 30,\n      minWidth: large ? 36 : 30,\n      fontSize: 16,\n      boxShadow: isHighContrast ? \"none\" : \"0 0 6px var(--shadow-color)\",\n      backgroundColor: large ? bg : COLORS.neutral10,\n      color: isHighContrast\n        ? COLORS.neutral80\n        : ((isLight || !large) ? COLORS.neutral80 : COLORS.neutral90),\n      cursor: \"default\",\n      ...monofont && { fontFamily: \"monospace\" },\n    }}>\n      {children}\n    </div>\n  );\n};\n\ntype ShortCutOverviewProps = {\n  close: () => void;\n};\n\nexport const ShortcutOverview: React.FC<ShortCutOverviewProps> = ({ close }) => {\n  const { t } = useTranslation();\n\n  return <OverlayBox maxWidth={1000} close={close} title={t(\"shortcuts.label\")}>\n    {Object.entries(SHORTCUTS).map(([groupId, group]) => (\n      <ShortcutGroupOverview\n        key={groupId}\n        groupId={groupId as keyof typeof SHORTCUTS}\n        group={group}\n      />\n    ))}\n  </OverlayBox>;\n};\n\n\nconst GROUP_ID_TRANSLATIONS = {\n  general: \"shortcuts.general.title\",\n  videoSetup: \"steps.video.label\",\n  audioSetup: \"steps.audio.label\",\n  recording: \"steps.record.label\",\n  review: \"steps.review.label\",\n  finish: \"steps.finish.label\",\n} as const satisfies Record<keyof typeof SHORTCUTS, string>;\n\ntype ShortcutGroupOverviewProps = {\n  groupId: keyof typeof SHORTCUTS;\n  group: typeof SHORTCUTS[keyof typeof SHORTCUTS];\n};\n\nconst ShortcutGroupOverview: React.FC<ShortcutGroupOverviewProps> = ({ groupId, group }) => {\n  const { t } = useTranslation();\n\n  return (\n    <section css={{\n      margin: \"32px 0\",\n      \":first-of-type\": {\n        marginTop: 16,\n      },\n    }}>\n      <h2 css={{ fontSize: 18, marginBottom: 8 }}>{t(GROUP_ID_TRANSLATIONS[groupId])}</h2>\n      <div css={{\n        display: \"flex\",\n        flexWrap: \"wrap\",\n        gap: 12,\n      }}>\n        {Object.entries(group).map(([name, keys], i) => (\n          <div\n            key={i}\n            css={{\n              width: \"calc(33.33% - 24px / 3)\",\n              [screenWidthAtMost(1080)]: {\n                width: \"calc(50% - 12px / 2)\",\n              },\n              [screenWidthAtMost(720)]: {\n                width: \"100%\",\n              },\n              backgroundColor: COLORS.neutral10,\n              borderRadius: 4,\n              padding: \"10px 16px\",\n              display: \"inline-flex\",\n              flexDirection: \"column\",\n              alignItems: \"start\",\n              gap: 8,\n            }}\n          >\n            <div css={{ overflowWrap: \"anywhere\" }}>\n              {/* eslint-disable-next-line @typescript-eslint/no-explicit-any */}\n              {t((SHORTCUT_TRANSLATIONS[groupId] as any)[name])}\n            </div>\n            <div css={{\n              display: \"flex\",\n              gap: 8,\n              alignItems: \"center\",\n            }}>\n              {keys.split(\";\").map((combination, i) => <React.Fragment key={i}>\n                {i > 0 && t(\"shortcuts.sequence-seperator\")}\n                <ShortcutKeys shortcut={combination.trim()} large />\n              </React.Fragment>)}\n            </div>\n          </div>\n        ))}\n      </div>\n    </section>\n  );\n};\n","import { Floating, FloatingContainer, FloatingTrigger, ProtoButton, match, useColorScheme } from \"@opencast/appkit\";\nimport { useTranslation } from \"react-i18next\";\nimport { FiChevronLeft, FiChevronRight } from \"react-icons/fi\";\nimport { CSSObject } from \"@emotion/react\";\nimport { useState } from \"react\";\n\nimport { COLORS, focusStyle } from \"../util\";\nimport { SHORTCUTS, ShortcutKeys, useShortcut, useShowAvailableShortcuts } from \"../shortcuts\";\n\n\ntype StepButtonProps = {\n  kind: \"next\" | \"prev\";\n  label?: string;\n  danger?: boolean;\n  icon?: JSX.Element;\n  disabled?: boolean;\n  onClick?: () => void;\n  popoverEntries?: ({\n    icon: JSX.Element;\n    label: string;\n  } & ({ onClick: () => void } | { href: string }))[];\n};\n\nconst StepButton: React.FC<StepButtonProps> = ({\n  kind, label, icon, disabled, danger, onClick, popoverEntries,\n}) => {\n  const { t } = useTranslation();\n  const showShortcut = useShowAvailableShortcuts();\n  const isDark = useColorScheme().scheme === \"dark\";\n  const { isHighContrast } = useColorScheme();\n  const shortcut = match(kind, {\n    prev: () => SHORTCUTS.general.prev,\n    next: () => SHORTCUTS.general.next,\n  });\n  const [open, setOpen] = useState(false);\n  const click = popoverEntries ? () => setOpen(old => !old) : () => onClick?.();\n  useShortcut(shortcut, click, { enabled: !disabled }, [click, shortcut, disabled]);\n\n  const button = (\n    <ProtoButton\n      disabled={disabled}\n      onClick={click}\n      css={{\n        position: \"relative\",\n        display: \"flex\",\n        gap: 8,\n        alignItems: \"center\",\n        lineHeight: 1,\n        ...focusStyle({ offset: -1 }),\n        ...danger && { \"--color-focus\": COLORS.danger4 },\n        borderRadius: 8,\n        border: `1px solid ${danger ? COLORS.danger4 : COLORS.neutral50}`,\n        color: danger ? COLORS.danger4 : COLORS.neutral80,\n        backgroundColor: danger ? COLORS.danger0 : COLORS.neutral05,\n        padding: \"12px 24px\",\n        ...match(kind, {\n          \"next\": () => ({ paddingRight: 16 }) as CSSObject,\n          \"prev\": () => ({ paddingLeft: 16 }) as CSSObject,\n        }),\n\n        '&[data-floating-state=\"open\"] svg': {\n          transform: \"rotate(-90deg)\",\n        },\n        \"svg\": {\n          transition: \"transform 0.15s\",\n          flexShrink: 0,\n        },\n\n        \"&[disabled]\": {\n          color: COLORS.neutral60,\n          borderColor: COLORS.neutral15,\n          backgroundColor: COLORS.neutral15,\n        },\n\n        \"&:not([disabled]):hover, &:not([disabled]):focus-visible\": {\n          borderColor: danger ? COLORS.danger5 : COLORS.neutral70,\n          color: danger ? COLORS.danger5 : COLORS.neutral90,\n          boxShadow: isHighContrast ? \"none\" : \"0 0 8px var(--shadow-color)\",\n          ...danger && { backgroundColor: COLORS.danger1 },\n          ...isHighContrast && {\n            outline: `2px solid ${danger ? COLORS.danger5 : COLORS.accent4}`,\n            borderColor: \"transparent\",\n          },\n        },\n      }}\n    >\n      {kind === \"prev\" && (icon ?? <FiChevronLeft />)}\n      {label ?? t(`steps.${kind === \"next\" ? \"next\" : \"back\"}-button-label`)}\n      {kind === \"next\" && (icon ?? <FiChevronRight css={{\n      }}/>)}\n      {showShortcut && !disabled && (\n        <div css={{\n          position: \"absolute\",\n          top: -24,\n          left: -6,\n          padding: 2,\n          borderRadius: 4,\n          backgroundColor: COLORS.neutral05,\n        }}><ShortcutKeys shortcut={shortcut} /></div>\n      )}\n    </ProtoButton>\n  );\n\n  // One would think we can just always return a `FloatingContainer`, which just\n  // sometimes does nothing. But no: this confuses screenreaders as they would\n  // always announce that this button opens a menu.\n  if (!popoverEntries) {\n    return button;\n  }\n\n  return (\n    <FloatingContainer\n      placement=\"top-end\"\n      open={open}\n      onClose={() => setOpen(false)}\n      ariaRole=\"menu\"\n      arrowSize={8}\n      viewPortMargin={12}\n      borderRadius={8}\n      distance={6}\n    >\n      <FloatingTrigger>{button}</FloatingTrigger>\n      <Floating\n        backgroundColor={isDark ? COLORS.neutral15 : COLORS.neutral05}\n        borderWidth={isDark ? 1 : 0}\n        padding={0}\n        shadowBlur={8}\n      >\n        <ul css={{\n          borderRadius: 8,\n          margin: 0,\n          paddingLeft: 0,\n          overflow: \"hidden\",\n          listStyle: \"none\",\n        }}>\n          {popoverEntries?.map((entry, i) => {\n            const style = {\n              display: \"flex\",\n              gap: 16,\n              alignItems: \"center\",\n              width: \"100%\",\n              minWidth: 160,\n              padding: 12,\n              color: COLORS.neutral80,\n              cursor: \"pointer\",\n              textDecoration: \"none\",\n              ...focusStyle({ inset: true }),\n              \"& > svg\": {\n                maxHeight: 23,\n                fontSize: 23,\n                color: COLORS.neutral60,\n                width: 24,\n                strokeWidth: 2,\n                \"& > path\": { strokeWidth: \"inherit\" },\n              },\n              \":hover, :focus\": {\n                backgroundColor: COLORS.neutral10,\n                color: \"inherit\",\n              },\n            };\n\n            return (\n              <li key={i} css={{\n                \":first-of-type > *\": { borderRadius: \"8px 8px 0 0\" },\n                \":last-of-type> *\": { borderRadius: \"0 0 8px 8px\" },\n                \":not(:first-of-type)\": {\n                  borderTop: `1px solid ${COLORS.neutral30}`,\n                },\n              }}>\n                {\"href\" in entry\n                  ? <a\n                    role=\"button\"\n                    href={entry.href}\n                    css={style}\n                    onKeyDown={e => {\n                      if (e.key === \" \") {\n                        e.preventDefault();\n                        window.location.href = entry.href;\n                      }\n                    }}\n                  >\n                    {entry.icon}\n                    {entry.label}\n                  </a>\n                  : <ProtoButton onClick={entry.onClick} css={style}>\n                    {entry.icon}\n                    {entry.label}\n                  </ProtoButton>\n                }\n              </li>\n            );\n          })}\n        </ul>\n      </Floating>\n    </FloatingContainer>\n  );\n};\n\ntype StepContainerProps = React.PropsWithChildren<{\n  title: string;\n  note?: string;\n  nextButton?: Omit<StepButtonProps, \"kind\">;\n  prevButton?: Omit<StepButtonProps, \"kind\">;\n}>;\n\nexport const StepContainer: React.FC<StepContainerProps> = ({\n  title,\n  note,\n  nextButton,\n  prevButton,\n  children,\n}) => {\n  return (\n    <div css={{\n      flex: \"1\",\n      minWidth: \"var(--min-page-width)\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      gap: 12,\n      padding: 12,\n      \"@media (min-width: 500px) and (min-height: 500px)\": {\n        gap: 16,\n        padding: 24,\n      },\n    }}>\n      <div>\n        <h1 aria-live=\"polite\" css={{\n          textAlign: \"center\",\n          fontSize: 32,\n          fontWeight: 700,\n          color: COLORS.neutral70,\n          \"@media screen and (max-width: 600px), screen and (max-height: 400px)\": {\n            fontSize: 26,\n          },\n        }}>{title}</h1>\n        {note && (\n          <div css={{\n            fontSize: 14,\n            color: COLORS.neutral60,\n            textAlign: \"center\",\n            lineHeight: 1.3,\n            maxWidth: \"100ch\",\n            margin: \"0 auto\",\n          }}>\n            {note}\n          </div>\n        )}\n      </div>\n      <div css={{\n        flex: \"1\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        justifyContent: \"center\",\n        position: \"relative\",\n      }}>\n        {children}\n      </div>\n      <div css={{\n        display: \"flex\",\n        justifyContent: \"end\",\n        alignItems: \"end\",\n        gap: 8,\n        minHeight: 42,\n      }}>\n        {prevButton && <StepButton kind=\"prev\" {...prevButton} />}\n        {nextButton && <StepButton kind=\"next\" {...nextButton} />}\n      </div>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { ProtoButton, useColorScheme } from \"@opencast/appkit\";\n\nimport { COLORS, focusStyle } from \"../util\";\nimport { ShortcutKeys } from \"../shortcuts\";\n\n\n\nexport type SourceOptionButtonProps = {\n  icon: JSX.Element;\n  label: string;\n  onClick: () => void;\n  disabledText?: false | string;\n  shortcut?: string;\n  ariaLabel?: string;\n};\n\nexport const SourceOptionButton: React.FC<SourceOptionButtonProps> = (\n  { icon, label, onClick, shortcut, disabledText, ariaLabel },\n) => {\n  const { isHighContrast } = useColorScheme();\n\n  return (\n    <ProtoButton\n      onClick={onClick}\n      disabled={!!disabledText}\n      aria-label={ariaLabel}\n      css={{\n        position: \"relative\",\n        display: \"inline-flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        width: \"100%\",\n        height: \"100%\",\n        maxHeight: 250,\n        maxWidth: 420,\n        padding: 12,\n        flex: \"1\",\n\n        backgroundColor: COLORS.neutral05,\n        color: COLORS.accent7,\n        borderRadius: 8,\n        border: `1px solid ${COLORS.neutral20}`,\n\n        \"&[disabled]\": {\n          backgroundColor: COLORS.neutral10,\n          color: COLORS.neutral50,\n          borderColor: COLORS.neutral15,\n        },\n\n        \"&:not([disabled]):hover, &:not([disabled]):focus-visible\": {\n          color: COLORS.accent8,\n          borderColor: COLORS.neutral30,\n          boxShadow: \"0 0 16px var(--shadow-color)\",\n          ...isHighContrast && {\n            outline: `2px solid ${COLORS.accent4}`,\n            borderColor: \"transparent\",\n            boxShadow: \"none\",\n          },\n        },\n        ...focusStyle({ offset: -1 }),\n      }}\n    >\n      <div css={{\n        borderRadius: \"50%\",\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        fontSize: 40,\n        width: 80,\n        height: 80,\n        backgroundColor: COLORS.neutral10,\n        marginBottom: 8,\n      }}>\n        {icon}\n      </div>\n      <div css={{ fontSize: 18, fontWeight: 700 }}>{label}</div>\n      <div css={{ height: \"1lh\", fontSize: 14, marginTop: 4 }}>{disabledText}</div>\n      {shortcut && <div css={{\n        position: \"absolute\",\n        right: 8,\n        bottom: 8,\n      }}><ShortcutKeys shortcut={shortcut} /></div>}\n    </ProtoButton>\n  );\n};\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { screenWidthAtMost } from \"@opencast/appkit\";\nimport { FiMonitor, FiUser } from \"react-icons/fi\";\n\nimport { useDispatch, useStudioState, VideoSource } from \"../../studio-state\";\nimport { useSettings } from \"../../settings\";\nimport { queryMediaDevices, onMobileDevice, BREAKPOINTS, onSafari } from \"../../util\";\nimport { startDisplayCapture, startUserCapture } from \"../../capturer\";\nimport { ErrorBox } from \"../../ui/ErrorBox\";\nimport { SHORTCUTS, useShortcut, useShowAvailableShortcuts } from \"../../shortcuts\";\nimport { SourceOptionButton } from \"../../ui/SourceOptionButton\";\n\n\n\ntype SourceSelectionProps = {\n  setActiveSource: (s: VideoSource) => void;\n  userConstraints: MediaTrackConstraints;\n  displayConstraints: MediaTrackConstraints;\n};\n\nexport const SourceSelection: React.FC<SourceSelectionProps> = ({\n  setActiveSource,\n  userConstraints,\n  displayConstraints,\n}) => {\n  const { t } = useTranslation();\n\n  const settings = useSettings();\n  const dispatch = useDispatch();\n  const state = useStudioState();\n  const { displaySupported, userSupported } = state;\n\n  const clickUser = async () => {\n    setActiveSource(\"user\");\n    await startUserCapture(dispatch, settings, userConstraints);\n    await queryMediaDevices(dispatch);\n  };\n\n  const clickDisplay = async () => {\n    setActiveSource(\"display\");\n    await startDisplayCapture(dispatch, settings, displayConstraints);\n  };\n\n  const clickBoth = async () => {\n    setActiveSource(\"both\");\n    // Safari needs the display capture to be called first as otherwise\n    // it thinks `getDisplayMedia` is called without user gesture and\n    // throws an error.\n    if (onSafari()) {\n      await startDisplayCapture(dispatch, settings, displayConstraints);\n      await startUserCapture(dispatch, settings, userConstraints);\n      await queryMediaDevices(dispatch);\n    } else {\n      await startUserCapture(dispatch, settings, userConstraints);\n      await Promise.all([\n        queryMediaDevices(dispatch),\n        startDisplayCapture(dispatch, settings, displayConstraints),\n      ]);\n    }\n  };\n\n  useShortcut(SHORTCUTS.videoSetup.selectScreen, clickDisplay);\n  useShortcut(SHORTCUTS.videoSetup.selectBoth, clickBoth);\n  useShortcut(SHORTCUTS.videoSetup.selectUser, clickUser);\n  const showShortcuts = useShowAvailableShortcuts();\n\n  if (!displaySupported && !userSupported) {\n    return <ErrorBox body={t(\"steps.video.none-available\")} />;\n  }\n\n  return (\n    <div\n      css={{\n        display: \"flex\",\n        gap: 24,\n        padding: 8,\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        flex: \"1\",\n        [screenWidthAtMost(BREAKPOINTS.medium)]: {\n          flexDirection: \"column\",\n        },\n      }}\n    >\n      {(displaySupported || !onMobileDevice()) && <SourceOptionButton\n        label={t(\"sources-scenario-display\")}\n        ariaLabel={t(\"steps.video.share-display\")}\n        icon={<FiMonitor />}\n        onClick={clickDisplay}\n        disabledText={displaySupported ? false : t(\"steps.video.display-not-supported\")}\n        shortcut={showShortcuts ? SHORTCUTS.videoSetup.selectScreen : undefined}\n      />}\n      {(displaySupported || !onMobileDevice()) && userSupported && <SourceOptionButton\n        label={t(\"sources-scenario-display-and-user\")}\n        ariaLabel={t(\"steps.video.share-display-and-user\")}\n        icon={(\n          <div css={{\n            lineHeight: 0,\n            // The two icons are a bit smaller, but we make sure that they have\n            // the same absolute stroke width.\n            fontSize: \"0.8em\",\n            svg: { strokeWidth: 2 / 0.8 },\n          }}>\n            <FiMonitor />\n            <FiUser />\n          </div>\n        )}\n        onClick={clickBoth}\n        disabledText={\n          displaySupported\n            ? (state.hasWebcam ? false : t(\"steps.video.no-cam-detected\"))\n            : t(\"steps.video.display-not-supported\")\n        }\n        shortcut={showShortcuts ? SHORTCUTS.videoSetup.selectBoth : undefined}\n      />}\n      {userSupported && <SourceOptionButton\n        label={t(\"sources-scenario-user\")}\n        ariaLabel={t(\"steps.video.share-user\")}\n        icon={<FiUser />}\n        onClick={clickUser}\n        disabledText={state.hasWebcam ? false : t(\"steps.video.no-cam-detected\")}\n        shortcut={showShortcuts ? SHORTCUTS.videoSetup.selectUser : undefined}\n      />}\n    </div>\n  );\n};\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { match } from \"@opencast/appkit\";\n\nimport { useDispatch, useStudioState, VideoSource } from \"../../studio-state\";\nimport { stopDisplayCapture, stopUserCapture } from \"../../capturer\";\nimport { SourcePreview } from \"./preview\";\nimport { loadCameraPrefs, loadDisplayPrefs, prefsToConstraints } from \"./prefs\";\nimport { StepProps } from \"..\";\nimport { StepContainer } from \"../elements\";\nimport { SourceSelection } from \"./source-select\";\nimport { ErrorBox } from \"../../ui/ErrorBox\";\nimport { isRecordingSupported, onSafari } from \"../../util\";\n\n\nexport type Input = {\n  isDesktop: boolean;\n  stream: MediaStream | null;\n  allowed: boolean | null;\n  unexpectedEnd: boolean | null;\n};\n\nexport const VideoSetup: React.FC<StepProps> = ({ goToNextStep }) => {\n  const { t } = useTranslation();\n\n  const dispatch = useDispatch();\n  const state = useStudioState();\n  const { displayStream, userStream, videoChoice: activeSource } = state;\n  const hasStreams = !!displayStream || !!userStream;\n\n  const setActiveSource = (s: VideoSource) => dispatch({ type: \"CHOOSE_VIDEO\", choice: s });\n  const reselectSource = () => {\n    setActiveSource(\"none\");\n    stopUserCapture(userStream, dispatch);\n    stopDisplayCapture(displayStream, dispatch);\n  };\n\n\n  const userInput = {\n    isDesktop: false,\n    stream: userStream,\n    allowed: state.userAllowed,\n    unexpectedEnd: state.userUnexpectedEnd,\n  };\n  const displayInput = {\n    isDesktop: true,\n    stream: displayStream,\n    allowed: state.displayAllowed,\n    unexpectedEnd: state.displayUnexpectedEnd,\n  };\n\n  const buttons = {\n    prevButton: {\n      onClick: reselectSource,\n      disabled: false,\n      label: t(\"steps.video.reselect-source\"),\n    },\n    nextButton: {\n      onClick: () => goToNextStep(),\n      disabled: activeSource === \"both\" ? (!displayStream || !userStream) : !hasStreams,\n    },\n  };\n\n  const someProblem = state.userAllowed === false || state.userUnexpectedEnd\n    || state.displayAllowed === false || state.displayUnexpectedEnd;\n\n  return match(activeSource, {\n    \"none\": () => {\n      return (\n        <StepContainer title={t(\"steps.video.question\")}>\n          <Warnings />\n          <SourceSelection\n            displayConstraints={prefsToConstraints(loadDisplayPrefs())}\n            userConstraints={prefsToConstraints(loadCameraPrefs())}\n            setActiveSource={setActiveSource}\n          />\n        </StepContainer>\n      );\n    },\n\n    \"user\": () => {\n      const showButtons = userStream || someProblem;\n      return (\n        <StepContainer\n          title={t(\"steps.video.user-selected\")}\n          {...showButtons && buttons}\n        >\n          <SourcePreview inputs={[userInput]} />\n        </StepContainer>\n      );\n    },\n\n    \"display\": () => {\n      const showButtons = displayStream || someProblem;\n      return (\n        <StepContainer\n          title={t(\"steps.video.display-selected\")}\n          {...showButtons && buttons}\n        >\n          <SourcePreview inputs={[displayInput]} />\n        </StepContainer>\n      );\n    },\n\n    \"both\": () => {\n      const showButtons = (userStream && displayStream) || someProblem;\n      return (\n        <StepContainer\n          title={t(\"steps.video.display-and-user-selected\")}\n          {...showButtons && buttons}\n        >\n          <SourcePreview inputs={[displayInput, userInput]} />\n        </StepContainer>\n      );\n    },\n  });\n};\n\n\n\n/** Conditionally shows a number of warnings to help the user identify problems. */\nconst Warnings = () => {\n  const { t } = useTranslation();\n\n  const warnings: JSX.Element[] = [];\n\n  // We allow HTTP connections to localhost, as most browsers also seem to allow\n  // video capture in those cases.\n  const usingUnsecureConnection = window.location.protocol !== \"https:\" &&\n    window.location.hostname !== \"localhost\" &&\n    window.location.hostname !== \"127.0.0.1\";\n  if (usingUnsecureConnection) {\n    warnings.push(\n      <ErrorBox body={t(\"warning-https\")} />,\n    );\n  }\n\n  // Warning about missing `MediaRecorder` support\n  if (!isRecordingSupported()) {\n    let msg = t(\"warning-recorder-not-supported\");\n    if (onSafari()) {\n      msg += \" \" + t(\"warning-recorder-safari-hint\");\n    }\n    warnings.push(<ErrorBox body={msg} />);\n  }\n\n\n  return warnings.length > 0\n    ? <div>{ warnings }</div>\n    : null;\n};\n","import { useTranslation } from \"react-i18next\";\nimport { FiMic, FiMicOff } from \"react-icons/fi\";\nimport { screenWidthAtMost } from \"@opencast/appkit\";\n\nimport { SourceOptionButton } from \"../../ui/SourceOptionButton\";\nimport { SHORTCUTS, useShortcut, useShowAvailableShortcuts } from \"../../shortcuts\";\nimport { BREAKPOINTS } from \"../../util\";\n\n\ntype Props = {\n  selectNoAudio: () => void;\n  selectMicrophone: () => void;\n};\n\n/** The two large option buttons for \"no audio\" and \"Microphone\". */\nexport const SourceSelection: React.FC<Props> = ({ selectNoAudio, selectMicrophone }) => {\n  const { t } = useTranslation();\n  const showShortcuts = useShowAvailableShortcuts();\n  useShortcut(SHORTCUTS.audioSetup.withAudio, selectMicrophone);\n  useShortcut(SHORTCUTS.audioSetup.withoutAudio, selectNoAudio);\n\n  return (\n    <div\n      css={{\n        display: \"flex\",\n        gap: 24,\n        padding: 8,\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        flex: \"1\",\n        [screenWidthAtMost(BREAKPOINTS.medium)]: {\n          flexDirection: \"column\",\n        },\n      }}\n    >\n      <SourceOptionButton\n        icon={<FiMic />}\n        label={t(\"steps.audio.microphone\")}\n        onClick={selectMicrophone}\n        shortcut={showShortcuts ? SHORTCUTS.audioSetup.withAudio : undefined}\n      />\n      <SourceOptionButton\n        icon={<FiMicOff />}\n        label={t(\"steps.audio.without-audio\")}\n        onClick={selectNoAudio}\n        shortcut={showShortcuts ? SHORTCUTS.audioSetup.withoutAudio : undefined}\n      />\n    </div>\n  );\n};\n","import { useEffect, useId, useRef } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport Oscilloscope from \"oscilloscope\";\nimport { Spinner, useColorScheme } from \"@opencast/appkit\";\n\nimport { useDispatch, useStudioState } from \"../../studio-state\";\nimport { startAudioCapture, stopAudioCapture } from \"../../capturer\";\nimport { getUniqueDevices, COLORS } from \"../../util\";\nimport { LAST_AUDIO_DEVICE_KEY } from \".\";\nimport { ErrorBox } from \"../../ui/ErrorBox\";\nimport { Select } from \"../../ui/Select\";\n\n\n// Once the microphone is selected, this is shown. Renders an\n// audio-visualization and a device-selector.\nexport const MicrophonePreview: React.FC = () => {\n  const { t } = useTranslation();\n  const { isHighContrast } = useColorScheme();\n  const dispatch = useDispatch();\n  const state = useStudioState();\n  const { audioStream, audioAllowed, audioUnexpectedEnd } = state;\n\n  // Get current device ID and all possible audio input devices.\n  const currentDeviceId = audioStream?.getAudioTracks()?.[0]?.getSettings()?.deviceId;\n  const devices = getUniqueDevices(state.mediaDevices, \"audioinput\");\n\n  // We write the currently used device ID to local storage to remember it\n  // between visits of Studio.\n  useEffect(() => {\n    if (currentDeviceId) {\n      window.localStorage.setItem(LAST_AUDIO_DEVICE_KEY, currentDeviceId);\n    }\n  });\n\n  const changeDevice = async (deviceId: string) => {\n    // The stream is only falsy if it unexpectedly ended.\n    if (audioStream) {\n      stopAudioCapture(audioStream, dispatch);\n    }\n\n    await startAudioCapture(dispatch, { exact: deviceId });\n  };\n\n  const selectId = useId();\n  let body: JSX.Element = <></>;\n  if (audioStream) {\n    body = <>\n      <AudioVisualziation stream={audioStream} />\n      <div css={{\n        display: \"flex\",\n        width: \"80%\",\n        minWidth: \"240px\",\n        alignItems: \"center\",\n      }}>\n        <label htmlFor={selectId} css={{\n          marginRight: 16,\n          display: \"flex\",\n          flexDirection: \"column\",\n          alignItems: \"center\",\n          fontWeight: 700,\n          color: COLORS.neutral70,\n        }}>{t(\"steps.audio.device\")}</label>\n        <Select\n          id={selectId}\n          value={currentDeviceId}\n          onChange={e => changeDevice(e.target.value)}\n          css={{\n            flex: \"1 1\",\n            minWidth: 50,\n\n          }}\n        >\n          {devices.map((d, i) => (\n            <option key={i} value={d.deviceId}>{d.label ?? \"unlabeled microphone\"}</option>\n          ))}\n        </Select>\n      </div>\n    </>;\n  } else if (audioAllowed === false) {\n    body = <ErrorBox\n      title={t(\"steps.audio.not-allowed-title\")}\n      body={t(\"steps.audio.not-allowed-text\")}\n    />;\n  } else if (audioUnexpectedEnd === true) {\n    body = <ErrorBox body={t(\"error-lost-audio-stream\")} />;\n  } else {\n    body = <Spinner size={75} />;\n  }\n\n  return (\n    <div css={{\n      maxWidth: 850,\n      backgroundColor: COLORS.neutral05,\n      borderRadius: 16,\n      boxShadow: isHighContrast ? \"none\" : \"0 4px 16px var(--shadow-color)\",\n      width: \"100%\",\n      margin: \"0 auto\",\n      padding: 24,\n      display: \"flex\",\n      flexDirection: \"column\",\n      alignItems: \"center\",\n      maxHeight: \"400px\",\n      gap: 16,\n    }}>\n      {body}\n    </div>\n  );\n};\n\ntype AudioVisualziationProps = {\n  stream: MediaStream;\n};\n\nconst AudioVisualziation: React.FC<AudioVisualziationProps> = ({ stream }) => {\n  const isDark = useColorScheme().scheme === \"dark\";\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const ctx = canvas.getContext(\"2d\");\n      if (ctx == null) {\n        throw new Error(\"Could not get 2D context for canvas\");\n      }\n      ctx.lineWidth = 2;\n\n      // We use `--color-accent9` in light mode, but have to hard code it here.\n      // In dark mode, we use the tranditional yellow as it just looks better.\n      ctx.strokeStyle = isDark ? \"#f1c40f\" : \"#044a81\";\n\n      const audioContext = new window.AudioContext();\n      const source = audioContext.createMediaStreamSource(stream);\n      const scope = new Oscilloscope(source, { fftSize: 1024 });\n      scope.animate(ctx);\n\n      return () => scope.stop();\n    }\n    return () => {};\n  }, [stream, isDark]);\n\n  return (\n    <canvas\n      ref={canvasRef}\n      width=\"800px\"\n      height=\"200px\"\n      css={{\n        width: \"100%\",\n        height: \"min(200px, 20vh)\",\n        flex: \"1 0 70px\",\n      }}\n    />\n  );\n};\n","import { useTranslation } from \"react-i18next\";\nimport { match } from \"@opencast/appkit\";\n\nimport { useDispatch, useStudioState } from \"../../studio-state\";\nimport { startAudioCapture, stopAudioCapture } from \"../../capturer\";\nimport { StepContainer } from \"../elements\";\nimport { queryMediaDevices } from \"../../util\";\nimport { StepProps } from \"..\";\nimport { SourceSelection } from \"./source-select\";\nimport { MicrophonePreview } from \"./mic-preview\";\n\n\nexport const LAST_AUDIO_DEVICE_KEY = \"ocStudioLastAudioDevice\";\n\n\n// The audio setup page. This component manages the state (either 'none\n// selected' or 'microphone selected') and renders the correct component.\nexport const AudioSetup: React.FC<StepProps> = ({ goToNextStep, goToPrevStep }) => {\n  const { t } = useTranslation();\n  const dispatch = useDispatch();\n  const { audioStream, audioChoice } = useStudioState();\n\n\n  return match(audioChoice, {\n    \"none\": () => {\n      const selectMicrophone = async () => {\n        dispatch({ type: \"CHOOSE_AUDIO\", choice: \"microphone\" });\n        const deviceId = window.localStorage.getItem(LAST_AUDIO_DEVICE_KEY);\n        await startAudioCapture(dispatch, deviceId ? { ideal: deviceId } : undefined);\n        await queryMediaDevices(dispatch);\n      };\n\n      return (\n        <StepContainer\n          title={t(\"steps.audio.question\")}\n          prevButton={{ onClick: goToPrevStep }}\n          nextButton={{ disabled: true }}\n        >\n          <SourceSelection\n            selectNoAudio={goToNextStep}\n            selectMicrophone={selectMicrophone}\n          />\n        </StepContainer>\n      );\n    },\n\n    \"microphone\": () => {\n      const reselectSource = () => {\n        if (audioStream) {\n          stopAudioCapture(audioStream, dispatch);\n        }\n        dispatch({ type: \"CHOOSE_AUDIO\", choice: \"none\" });\n      };\n\n      return (\n        <StepContainer\n          title={t(\"steps.audio.microphone-selected\")}\n          prevButton={{\n            label: t(\"steps.audio.reselect-audio\"),\n            onClick: reselectSource,\n          }}\n          nextButton={{ disabled: !audioStream, onClick: goToNextStep }}\n        >\n          <MicrophonePreview />\n        </StepContainer>\n      );\n    },\n  });\n};\n","import { useEffect, useRef, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { WithTooltip, match, useColorScheme } from \"@opencast/appkit\";\nimport { FiPause, FiPlay } from \"react-icons/fi\";\n\nimport { RecordingState } from \".\";\nimport { SHORTCUTS, ShortcutKeys, useShortcut, useShowAvailableShortcuts } from \"../../shortcuts\";\nimport { COLORS } from \"../../util\";\n\n\n\n\ntype Props = {\n  recordingState: RecordingState;\n  startRecording: () => void;\n  pauseRecording: () => void;\n  resumeRecording: () => void;\n};\n\nexport const RecordingControls: React.FC<Props> = ({\n  recordingState,\n  startRecording,\n  pauseRecording,\n  resumeRecording,\n}) => {\n  const { t } = useTranslation();\n  const isLight = useColorScheme().scheme === \"light\";\n  const { isHighContrast } = useColorScheme();\n  const fgColor = isLight ? COLORS.neutral05 : COLORS.neutral90;\n\n  const showAvailableShortcuts = useShowAvailableShortcuts();\n  useShortcut(SHORTCUTS.recording.startPauseResume, () => {\n    match(recordingState, {\n      \"inactive\": () => startRecording(),\n      \"paused\": () => resumeRecording(),\n      \"recording\": () => pauseRecording(),\n    });\n  }, {\n    ignoreEventWhen: e => e.code === \"Space\" && e.target instanceof HTMLButtonElement,\n  }, [recordingState]);\n  const label = match(recordingState, {\n    \"inactive\": () => t(\"steps.record.record-button-title\"),\n    \"paused\": () => t(\"steps.record.resume-button-title\"),\n    \"recording\": () => t(\"steps.record.pause-button-title\"),\n  });\n\n  return (\n    <div css={{\n      margin: \"0 auto\",\n      width: 180,\n      height: 85,\n      display: \"flex\",\n      gap: 32,\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      backgroundColor: isLight ? COLORS.neutral70 : COLORS.neutral05,\n      border: `1px solid ${isLight ? COLORS.neutral50 : COLORS.neutral25}`,\n      boxShadow: isHighContrast ? \"none\" : \"0 4px 16px rgba(0, 0, 0, 0.2)\",\n      borderRadius: 12,\n      color: fgColor,\n      ...isHighContrast && {\n        backgroundColor: COLORS.neutral05,\n        border: `2px solid ${COLORS.neutral25}`,\n      },\n    }}>\n      <WithTooltip tooltip={label}>\n        <button\n          onClick={match(recordingState, {\n            \"inactive\": () => startRecording,\n            \"paused\": () => resumeRecording,\n            \"recording\": () => pauseRecording,\n          })}\n          aria-label={label}\n          aria-live=\"polite\"\n          css={{\n            position: \"relative\",\n            width: 50,\n            height: 50,\n            display: \"flex\",\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            fontSize: 28,\n            padding: 0,\n\n            boxShadow: isHighContrast ? \"none\" : \"0 4px 4px rgba(0, 0, 0, 0.12)\",\n            cursor: \"pointer\",\n            color: (isHighContrast || isLight) ? \"white\" : \"#D6D6D6\",\n            borderRadius: \"50%\",\n            backgroundColor: isLight ? \"#E42D43\" : \"#b8012d\",\n            border: `${isHighContrast ? \"2px\" : \"1px\"} solid ${fgColor}`,\n            \":hover, :focus-visible\": {\n              backgroundColor: isLight ? \"#c40a31\" : \"#8f0121\",\n            },\n            \":focus-visible\": {\n              outline: `4px solid ${fgColor}`,\n            },\n          }}\n        >\n          {match(recordingState, {\n            \"inactive\": () => null,\n            \"paused\": () => <FiPlay css={{ marginLeft: 4 }} />,\n            \"recording\": () => <FiPause />,\n          })}\n          {showAvailableShortcuts && (\n            <div css={{ position: \"absolute\", right: -4, bottom: -4 }}>\n              <ShortcutKeys shortcut={SHORTCUTS.recording.startPauseResume.split(\";\")[0]} />\n            </div>\n          )}\n        </button>\n      </WithTooltip>\n      <Timer isRecording={recordingState === \"recording\"} />\n    </div>\n  );\n};\n\n\ntype TimerProps = {\n  isRecording: boolean;\n};\n\nconst Timer: React.FC<TimerProps> = ({ isRecording }) => {\n  const [formatted, setFormatted] = useState(\"00:00\");\n  const millisPassed = useRef(0);\n\n  useEffect(() => {\n    let lastTick = new Date();\n    const tick = () => {\n      const newInstant = new Date();\n      if (isRecording) {\n        millisPassed.current += newInstant.valueOf() - lastTick.valueOf();\n\n        const ms = millisPassed.current;\n        let segments = [\n          Math.floor(ms / (60 * 60 * 1000)),\n          Math.floor(ms / (60 * 1000)) % 60,\n          Math.floor(ms / 1000) % 60,\n        ];\n        if (segments[0] === 0) {\n          segments = segments.slice(1);\n        }\n        setFormatted(segments.map(unit => (unit < 10 ? \"0\" : \"\") + unit).join(\":\"));\n      }\n      lastTick = newInstant;\n    };\n    const counterId = setInterval(tick, 100);\n    return () => clearInterval(counterId);\n  }, [isRecording]);\n\n\n\n\n  return <div>{formatted}</div>;\n};\n","import fixWebmDuration from \"webm-duration-fix\";\nimport { Settings } from \"../../settings\";\nimport { dimensionsOf } from \"../../util\";\n\n\nexport type OnStopCallback = (args: {\n  url: string;\n  media: Blob;\n  mimeType: string;\n  dimensions: [number, number] | null;\n}) => void;\n\nexport default class Recorder {\n  #recorder: MediaRecorder;\n  #data: Blob[] = [];\n  #dimensions: [number, number] | null;\n\n  onStop: OnStopCallback;\n\n  constructor(\n    stream: MediaStream,\n    settings: Settings[\"recording\"],\n    onStop: OnStopCallback,\n  ) {\n    // Figure out MIME type.\n    let mimeType: string | undefined;\n    if (\"isTypeSupported\" in MediaRecorder) {\n      mimeType = (settings?.mimes || [])\n        .find(mime => MediaRecorder.isTypeSupported(mime));\n      if (mimeType) {\n        console.debug(\"using first supported MIME type from settings: \", mimeType);\n      } else if (settings?.mimes) {\n        console.debug(\"None of the MIME types specified in settings are supported by \"\n          + \"this `MediaRecorder`\");\n      }\n    } else if (settings?.mimes) {\n      console.debug(\"MIME types were specified, but `MediaRecorder.isTypeSupported` is not \"\n        + \"supported by your browser\");\n    }\n\n\n    this.#reset();\n\n    this.#dimensions = dimensionsOf(stream);\n    this.onStop = onStop;\n\n    const videoBitsPerSecond = settings?.videoBitrate;\n    this.#recorder = new MediaRecorder(stream, { mimeType, videoBitsPerSecond });\n    this.#recorder.ondataavailable = this.#onDataAvailable;\n    this.#recorder.onstop = this.#onStop;\n  }\n\n  #reset = () => {\n    this.#data = [];\n  };\n\n  #onDataAvailable = (event: BlobEvent) => {\n    if (event.data.size > 0) {\n      this.#data.push(event.data);\n    } else {\n      console.log(\"Recording data has size 0!\", event);\n    }\n  };\n\n  #onStop = async (_event: Event) => {\n    const mimeType = this.#data[0]?.type || this.#recorder.mimeType;\n    const mainMimeType = mimeType.split(\";\")[0].trim();\n    let media;\n\n    const fixMimeTypes = [\"video/webm\", \"video/x-matroska\"];\n\n    if (fixMimeTypes.includes(mainMimeType)) {\n      media = await fixWebmDuration(new Blob(this.#data, { type: mimeType }));\n    } else {\n      media = new Blob(this.#data, { type: mimeType });\n    }\n\n    const url = URL.createObjectURL(media);\n\n    this.#reset();\n\n    this.onStop?.({ url, media, mimeType, dimensions: this.#dimensions });\n  };\n\n  start() {\n    this.#recorder.start();\n  }\n\n  pause() {\n    this.#recorder.pause();\n  }\n\n  resume() {\n    this.#recorder.resume();\n  }\n\n  stop() {\n    this.#recorder.stop();\n  }\n}\n","import { useTranslation } from \"react-i18next\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { useBeforeunload } from \"react-beforeunload\";\nimport { keyframes } from \"@emotion/react\";\nimport { FiPauseCircle } from \"react-icons/fi\";\n\nimport {\n  useStudioState, useDispatch, Dispatcher, Recording as StudioRecording,\n} from \"../../studio-state\";\nimport { useOpencast } from \"../../opencast\";\n\nimport { stopCapture } from \"../../capturer\";\nimport { StepProps } from \"..\";\nimport { ErrorBox } from \"../../ui/ErrorBox\";\nimport { StepContainer } from \"../elements\";\nimport { VideoBox, VideoBoxProps, useVideoBoxResize } from \"../../ui/VideoBox\";\nimport { dimensionsOf } from \"../../util\";\nimport { RecordingControls } from \"./controls\";\nimport Recorder, { OnStopCallback } from \"./recorder\";\nimport { useSettings } from \"../../settings\";\nimport { useColorScheme } from \"@opencast/appkit\";\n\n\nexport type RecordingState = \"inactive\" | \"paused\" | \"recording\";\n\n\nconst addRecordOnStop = (\n  dispatch: Dispatcher,\n  deviceType: StudioRecording[\"deviceType\"],\n): OnStopCallback => {\n  return ({ media, url, mimeType, dimensions }) => {\n    dispatch({\n      type: \"ADD_RECORDING\",\n      recording: { deviceType, media, url, mimeType, dimensions },\n    });\n  };\n};\n\nconst mixAudioIntoVideo = (audioStreams: (MediaStream | null)[], videoStream: MediaStream) => (\n  audioStreams.reduce<MediaStream>(\n    (stream, audioStream) => audioStream?.getAudioTracks().length\n      ? new MediaStream([\n        ...stream.getVideoTracks(),\n        ...(\n          stream.getAudioTracks().length\n            ? (() => {\n              const audioContext = new AudioContext();\n              const accumulatedAudio = audioContext.createMediaStreamSource(stream);\n              const currentAudio = audioContext.createMediaStreamSource(audioStream);\n              const resultAudio = audioContext.createMediaStreamDestination();\n              accumulatedAudio.connect(resultAudio);\n              currentAudio.connect(resultAudio);\n              return resultAudio.stream;\n            })()\n            : audioStream\n        ).getAudioTracks(),\n      ])\n      : stream,\n    videoStream,\n  )\n);\n\n\nexport const Recording: React.FC<StepProps> = ({ goToNextStep, goToPrevStep }) => {\n  const { t } = useTranslation();\n  const recordingDispatch = useDispatch();\n  const opencast = useOpencast();\n  const dispatch = useDispatch();\n  const settings = useSettings();\n  const state = useStudioState();\n  const {\n    displayStream, userStream, displayUnexpectedEnd, userUnexpectedEnd, audioUnexpectedEnd,\n  } = state;\n\n  const [recordingState, setRecordingState] = useState<RecordingState>(\"inactive\");\n\n  const desktopRecorder = useRef<Recorder>();\n  const videoRecorder = useRef<Recorder>();\n\n  const canRecord = (displayStream || userStream)\n    && !userUnexpectedEnd && !displayUnexpectedEnd && !audioUnexpectedEnd;\n\n  const startRecording = () => {\n    // In theory, we should never have recordings at this point. But just to be\n    // sure, in case of a bug elsewhere, we clear the recordings here.\n    dispatch({ type: \"CLEAR_RECORDINGS\" });\n\n    if (displayStream) {\n      const onStop = addRecordOnStop(dispatch, \"desktop\");\n      const stream = mixAudioIntoVideo([state.audioStream], displayStream);\n      desktopRecorder.current = new Recorder(stream, settings.recording, onStop);\n      desktopRecorder.current.start();\n    }\n    if (userStream) {\n      const onStop = addRecordOnStop(dispatch, \"video\");\n      const stream = mixAudioIntoVideo([state.audioStream, displayStream], userStream);\n      videoRecorder.current = new Recorder(stream, settings.recording, onStop);\n      videoRecorder.current.start();\n    }\n\n    setRecordingState(\"recording\");\n    dispatch({ type: \"START_RECORDING\" });\n  };\n\n  const stopRecording = (premature: boolean) => {\n    desktopRecorder.current?.stop();\n    videoRecorder.current?.stop();\n    dispatch({ type: premature ? \"STOP_RECORDING_PREMATURELY\" : \"STOP_RECORDING\" });\n    opencast.refreshConnection();\n    stopCapture(state, recordingDispatch);\n    goToNextStep();\n  };\n\n  const pauseRecording = () => {\n    setRecordingState(\"paused\");\n    desktopRecorder.current?.pause();\n    videoRecorder.current?.pause();\n  };\n\n  const resumeRecording = () => {\n    setRecordingState(\"recording\");\n    desktopRecorder.current?.resume();\n    videoRecorder.current?.resume();\n  };\n\n  // Detect if a stream ended unexpectedly. In that case we want to stop the\n  // recording completely.\n  useEffect(() => {\n    const unexpectedEnd = userUnexpectedEnd || displayUnexpectedEnd || audioUnexpectedEnd;\n    if (unexpectedEnd && (recordingState === \"recording\" || recordingState === \"paused\")) {\n      stopRecording(true);\n    }\n  });\n\n  const paused = recordingState === \"paused\";\n  const previews: VideoBoxProps[\"children\"] = [];\n  if (displayStream || displayUnexpectedEnd) {\n    previews.push({\n      body: <StreamPreview stream={displayStream} paused={paused} />,\n      dimensions: () => dimensionsOf(displayStream),\n      autoSize: !displayStream,\n    });\n  }\n  if (userStream || userUnexpectedEnd) {\n    previews.push({\n      body: <StreamPreview stream={userStream} paused={paused} />,\n      dimensions: () => dimensionsOf(userStream),\n      autoSize: !userStream,\n    });\n  }\n\n  useBeforeunload(event => {\n    if (recordingState !== \"inactive\") {\n      event.preventDefault();\n    }\n  });\n\n  return (\n    <StepContainer\n      title={t(\"steps.record.label\")}\n      prevButton={{\n        onClick: goToPrevStep,\n        disabled: recordingState !== \"inactive\",\n      }}\n      nextButton={{\n        onClick: () => stopRecording(false),\n        disabled: recordingState !== \"paused\",\n        label: t(\"steps.record.stop-button-title\"),\n      }}\n    >\n      {audioUnexpectedEnd && (\n        <ErrorBox body={t(\"error-lost-audio-stream\")} />\n      )}\n\n      <VideoBox gap={20}>{previews}</VideoBox>\n      <div css={{ position: \"absolute\", bottom: 32, width: \"100%\" }}>\n        {canRecord && (\n          <RecordingControls {...{\n            startRecording,\n            pauseRecording,\n            resumeRecording,\n            recordingState,\n          }} />\n        )}\n      </div>\n    </StepContainer>\n  );\n};\n\n\ntype StreamPreviewProps = {\n  stream: MediaStream | null;\n  paused: boolean;\n};\n\nconst StreamPreview: React.FC<StreamPreviewProps> = ({ stream, paused }) => {\n  const { t } = useTranslation();\n  const resizeVideoBox = useVideoBoxResize();\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const { isHighContrast } = useColorScheme();\n\n  useEffect(() => {\n    const v = videoRef.current;\n    if (v && stream) {\n      if (!v.srcObject) {\n        v.srcObject = stream;\n      }\n      v.addEventListener(\"resize\", resizeVideoBox);\n\n      if (paused) {\n        v.pause();\n      } else {\n        v.play();\n      }\n\n      return () => v.removeEventListener(\"resize\", resizeVideoBox);\n    }\n  });\n\n  if (!stream) {\n    return <ErrorBox css={{ margin: 0 }} body={t(\"error-lost-video-stream\")} />;\n  }\n\n  return (\n    <div\n      css={{\n        position: \"relative\",\n        boxShadow: isHighContrast ? \"none\" : \"0 2px 12px rgba(0, 0, 0, 0.35)\",\n        overflow: \"hidden\",\n        height: \"100%\",\n      }}\n    >\n      {paused && <PauseOverlay />}\n      <video\n        ref={videoRef}\n        autoPlay\n        muted\n        playsInline\n        tabIndex={-1}\n        css={{\n          outline: \"none\",\n          width: \"100%\",\n          height: \"100%\",\n          background: \"transparent\",\n        }}\n      ></video>\n    </div>\n  );\n};\n\nconst PauseOverlay: React.FC = () => {\n  const { t } = useTranslation();\n\n  return (\n    <div\n      css={{\n        position: \"absolute\",\n        width: \"100%\",\n        height: \"100%\",\n        backgroundColor: \"rgba(50, 50, 50, 0.7)\",\n      }}\n    >\n      <div css={{\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        color: \"white\",\n        gap: 8,\n        fontSize: 20,\n        marginTop: 32,\n        textShadow: \"0 0 12px rgba(0, 0, 0, 0.6)\",\n        animation: `2s ease-in-out infinite none ${keyframes({\n          \"0%\": { opacity: 1 },\n          \"50%\": { opacity: 0.7 },\n          \"100%\": { opacity: 1 },\n        })}`,\n      }}>\n        <FiPauseCircle css={{ fontSize: 26 }} />\n        {t(\"steps.record.is-paused\")}\n      </div>\n    </div>\n  );\n};\n","var _g;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nconst SvgCutHereIcon = props => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  xmlns: \"http://www.w3.org/2000/svg\",\n  \"aria-hidden\": \"true\",\n  viewBox: \"0 0 100 90\",\n  width: \"1em\",\n  height: \"1em\"\n}, props), _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n  fill: \"currentColor\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M49.7.002c-2.91.059-5.75 1.49-7.44 4.08a8.84 8.84 0 0 0-1.42 5.29c-.08.122-.986 1.51-1.13 1.72-.13-.2-.997-1.54-1.08-1.66a8.84 8.84 0 0 0-1.4-5.29c-1.68-2.59-4.51-4.04-7.42-4.11a9.03 9.03 0 0 0-5.09 1.41c-4.18 2.66-5.4 8.27-2.72 12.4 2.56 3.96 7.83 5.24 11.9 3.02l.992 1.53c-2.84 4.35-4.9 7.5-6.74 10.3-3.09 4.73-1.94 8.93 2.01 11.5l9.47-14.5 9.45 14.6c3.96-2.55 5.13-6.75 2.06-11.5-1.84-2.84-3.9-6.03-6.74-10.4l1.04-1.59c4.1 2.23 9.37.974 12-2.97 2.03-3.1 1.85-7.03-.114-9.93a8.9 8.9 0 0 0-2.55-2.49 8.94 8.94 0 0 0-5.08-1.43zm.09 5.96a3.04 3.04 0 0 1 1.7.499c.357.23.65.514.872.835.668.962.712 2.24.018 3.31-.926 1.42-2.74 1.8-4.17.882-1.43-.92-1.82-2.73-.89-4.14.58-.886 1.51-1.37 2.47-1.38zm-20.1.023c.963.017 1.89.504 2.46 1.39.92 1.42.525 3.22-.906 4.14s-3.25.521-4.17-.9c-.92-1.42-.525-3.22.906-4.14a3.07 3.07 0 0 1 1.71-.492zm10 24.1a1.83 1.81 0 0 0-1.83 1.81v3.62a1.83 1.81 0 0 0 1.83 1.81 1.83 1.81 0 0 0 1.83-1.81v-3.62a1.83 1.81 0 0 0-1.83-1.81m0 10.9a1.83 1.81 0 0 0-1.83 1.81v3.62a1.83 1.81 0 0 0 1.83 1.81 1.83 1.81 0 0 0 1.83-1.81v-3.62a1.83 1.81 0 0 0-1.83-1.81m-1.5 8.8a2.43 2.42 0 0 0-2.43 2.42v35.4a2.43 2.42 0 0 0 2.43 2.42h8.94v-4.83h-6.51v-30.6h6.1v-4.83zm6.51 8.86v22.5h55.2v-4.83h-3.22a1.71 1.71 0 0 1-1.72-1.71v-9.47c0-.946.767-1.71 1.72-1.71h3.22v-4.83zm6.59 4.83h14.4c.954 0 1.72.762 1.72 1.71v9.47c0 .946-.767 1.71-1.72 1.71h-14.4a1.71 1.71 0 0 1-1.72-1.71v-9.47c0-.946.767-1.71 1.72-1.71m22.7 0h14.4c.954 0 1.72.762 1.72 1.71v9.47c0 .946-.767 1.71-1.72 1.71h-14.4a1.71 1.71 0 0 1-1.72-1.71v-9.47c0-.946.77-1.71 1.72-1.71\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M0 58.6v4.83h2.44c.954 0 1.72.762 1.72 1.71v9.47c0 .946-.768 1.71-1.72 1.71H0v4.83h31.8v-22.5zm10.8 4.83h14.4c.954 0 1.72.762 1.72 1.71v9.47c0 .946-.768 1.71-1.72 1.71H10.8a1.71 1.71 0 0 1-1.72-1.71v-9.47c0-.946.768-1.71 1.72-1.71\",\n  opacity: 0.2\n}))));\nexport default SvgCutHereIcon;","var _path;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nconst SvgCutMarker = props => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: \"1em\",\n  height: \"1em\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\",\n  strokeWidth: 2,\n  viewBox: \"0 0 24 24\"\n}, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M14 21h-4V3h4\"\n})));\nexport default SvgCutMarker;","import React, { RefObject, useEffect, useRef } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { ProtoButton, WithTooltip, notNullish, useColorScheme } from \"@opencast/appkit\";\nimport { FiPause, FiPlay } from \"react-icons/fi\";\n\nimport { useStudioState, useDispatch, Dispatcher } from \"../../studio-state\";\nimport { useSettings } from \"../../settings\";\nimport CutHereIcon from \"./cut-here-icon.svg\";\nimport CutMarkerIcon from \"./cut-marker.svg\";\nimport { COLORS, focusStyle } from \"../../util\";\nimport { ALMOST_ZERO } from \".\";\nimport { PreviewHandle } from \"./preview\";\nimport { SHORTCUTS, ShortcutKeys, useShortcut, useShowAvailableShortcuts } from \"../../shortcuts\";\n\n\ntype SharedProps = {\n  previewController: React.RefObject<PreviewHandle>;\n  currentTime: number;\n};\n\nexport const ControlBox: React.FC<SharedProps> = ({ previewController, currentTime }) => {\n  const { i18n } = useTranslation();\n  const duration = previewController.current?.duration;\n  const { isHighContrast } = useColorScheme();\n\n  return (\n    <div css={{\n      backgroundColor: COLORS.neutral05,\n      borderRadius: 8,\n      padding: 16,\n      boxShadow: isHighContrast ? \"none\" : \"0 4px 4px var(--shadow-color)\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      gap: 12,\n    }}>\n      <Controls {...{ previewController, currentTime }} />\n      <div css={{ textAlign: \"center\", color: COLORS.neutral70 }}>\n        {formatTime(currentTime, duration, i18n.language)}\n        /\n        {formatTime(duration, duration, i18n.language)}\n      </div>\n      <Scrubber {...{ previewController, currentTime }} />\n    </div>\n  );\n};\n\nconst formatTime = (\n  seconds: number | undefined,\n  totalDuration: number | undefined,\n  lang: string,\n): string => {\n  const MINUTE = 60;\n  const HOUR = 60 * MINUTE;\n\n  if (seconds === undefined) {\n    return \"--:--\";\n  }\n\n  const secondsPart = seconds % 60;\n  const minutesPart = Math.floor(seconds / MINUTE) % 60;\n  const hoursPart = Math.floor(seconds / HOUR);\n\n  const secondsFormatted = secondsPart.toLocaleString(lang, {\n    minimumFractionDigits: 1,\n    maximumFractionDigits: 1,\n  });\n\n  const lowerPart = `${minutesPart <= 9 ? \"0\" : \"\"}${minutesPart}`\n    + `:${secondsPart <= 9 ? \"0\" : \"\"}${secondsFormatted}`;\n\n  return (totalDuration && totalDuration >= HOUR)\n    ? `${hoursPart}:${lowerPart}`\n    : lowerPart;\n};\n\nconst Scrubber: React.FC<SharedProps> = ({ previewController, currentTime }) => {\n  const duration = previewController.current?.duration || Infinity;\n  const settings = useSettings();\n  const dispatch = useDispatch();\n  const { start, end } = useStudioState();\n  const ref = useRef<HTMLDivElement>(null);\n  const { isHighContrast } = useColorScheme();\n\n  const setTime = (mouseEvent: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    const rect = mouseEvent.currentTarget.getBoundingClientRect();\n    const x = mouseEvent.clientX - rect.x;\n    let progress = x / rect.width;\n    if (progress < 0) {\n      progress = 0;\n    } else if (progress > 1) {\n      progress = 1;\n    }\n\n    if (previewController.current) {\n      previewController.current.currentTime = progress * duration;\n    }\n  };\n\n  const cutStyle = {\n    position: \"absolute\",\n    backgroundColor: COLORS.danger1,\n    height: \"var(--scrubber-height)\",\n    borderRadius: \"var(--scrubber-border-radius)\",\n    boxSizing: \"content-box\",\n    background: \"repeating-linear-gradient(45deg,\"\n      + `${COLORS.danger2}, ${COLORS.danger2} 4px,`\n      + `${COLORS.danger1} 4px, ${COLORS.danger1} 8px)`,\n  } as const;\n\n  return (\n    <div css={{ padding: 4 }}>\n      <div ref={ref} css={{\n        \"--scrubber-border-radius\": \"3px\",\n        \"--scrubber-height\": \"6px\",\n        \"@media not (any-pointer: fine)\": {\n          \"--scrubber-border-radius\": \"6px\",\n          \"--scrubber-height\": \"12px\",\n        },\n\n        position: \"relative\",\n        backgroundColor: COLORS.accent4,\n        width: \"100%\",\n        height: \"var(--scrubber-height)\",\n        borderRadius: \"var(--scrubber-border-radius)\",\n      }}>\n        {/* An overlay that extends further above and below the parent for easier clicking. */}\n        <div\n          onClick={e => setTime(e)}\n          css={{\n            position: \"absolute\",\n            width: \"100%\",\n            cursor: \"pointer\",\n            zIndex: 5,\n            top: -6,\n            bottom: -6,\n          }}\n        >\n          {/* The playhead */}\n          <Draggable\n            scrubberRef={ref}\n            previewController={previewController}\n            initialTime={currentTime}\n            onDrag={time => notNullish(previewController.current).currentTime = time}\n          >\n            <div css={{\n              width: 16,\n              height: 16,\n              \"@media not (any-pointer: fine)\": {\n                width: 24,\n                height: 24,\n              },\n              borderRadius: \"50%\",\n              backgroundColor: COLORS.neutral05,\n              border: `1px solid ${COLORS.neutral40}`,\n            }}/>\n          </Draggable>\n        </div>\n\n        {/* The two \"deleted\" areas */}\n        {(start != null && start > 0) && <div css={{\n          left: 0,\n          borderRight: \"2px solid black\",\n          width: `${(start / duration) * 100}%`,\n          ...cutStyle,\n        }} />}\n        {(end != null && end < duration) && <div css={{\n          right: 0,\n          borderLeft: \"2px solid black\",\n          width: `${((duration - end) / duration) * 100}%`,\n          ...cutStyle,\n          backgroundPosition: \"right\",\n          backgroundSize: \"100vw\",\n        }} />}\n\n        {/* The two trim markers */}\n        {settings.review?.disableCutting || <>\n          <Draggable\n            scrubberRef={ref}\n            previewController={previewController}\n            initialTime={start ?? 0}\n            clamp={time => Math.min(time, end ?? duration)}\n            onDrag={time => dispatch({ type: \"UPDATE_START\", time })}\n          ><CutMarker side=\"left\" isHighContrast={isHighContrast} /></Draggable>\n          <Draggable\n            scrubberRef={ref}\n            previewController={previewController}\n            initialTime={end ?? duration}\n            clamp={time => Math.max(time, start ?? 0)}\n            onDrag={time => dispatch({ type: \"UPDATE_END\", time })}\n          ><CutMarker side=\"right\" isHighContrast={isHighContrast} /></Draggable>\n        </>}\n\n        {/* The play progress bar, overlaying darkening everything behind. */}\n        <div css={{\n          position: \"absolute\",\n          left: 0,\n          width: `${(currentTime / duration) * 100}%`,\n          backdropFilter: \"brightness(0.75)\",\n          height: \"var(--scrubber-height)\",\n          borderRadius: \"var(--scrubber-border-radius)\",\n        }} />\n      </div>\n    </div>\n  );\n};\n\ntype CutMarkerProps = {\n  side: \"left\" | \"right\";\n  isHighContrast: boolean;\n};\n\nconst CutMarker: React.FC<CutMarkerProps> = ({ side, isHighContrast }) => (\n  <div css={{\n    width: 14,\n    height: 20,\n    \"@media not (any-pointer: fine)\": {\n      height: 24,\n    },\n    backgroundColor: COLORS.neutral05,\n    color: COLORS.neutral70,\n    border: `1px solid ${COLORS.neutral40}`,\n    borderRadius: 4,\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    boxShadow: isHighContrast ? \"none\" : \"0 1px 2px var(--shadow-color)\",\n  }}>\n    <CutMarkerIcon css={{\n      transform: `scale(1.2) ${side == \"right\" ? \"scaleX(-1)\" : \"\"}`,\n    }} />\n  </div>\n);\n\ntype DraggableProps = React.PropsWithChildren<{\n  previewController: RefObject<PreviewHandle>;\n  scrubberRef: RefObject<HTMLDivElement>;\n  initialTime: number;\n\n  /** Called on every mouse move with the updated value */\n  onDrag?: (time: number) => void;\n\n  /**\n   * Called on every mouse move. The calculate time is passed as argument and\n   * the function can modify it somehow, i.e. clamp it to a range. Called\n   * before `onDrag`.\n   */\n  clamp?: (time: number) => number;\n}>;\n\n/**\n * Makes the given `children` draggable, letting the user adjust its x position\n * inside the scrubber.\n */\nconst Draggable: React.FC<DraggableProps> = ({\n  previewController,\n  scrubberRef,\n  initialTime,\n  onDrag,\n  clamp = t => t,\n  children,\n}) => {\n  const duration = previewController.current?.duration || Infinity;\n\n  const initialPos = initialTime / duration;\n  const pos = useRef<number>(initialPos);\n  const scrubberRect = useRef<DOMRect>();\n  const ref = useRef<HTMLDivElement>(null);\n  const isDragging = useRef(false);\n\n  useEffect(() => {\n    const onMouseUp = () => {\n      if (isDragging.current) {\n        isDragging.current = false;\n        onDrag?.(pos.current * duration);\n\n        // Reset the element style so that the `left` value from the class CSS\n        // can take over again.\n        notNullish(ref.current).style.left = \"\";\n      }\n    };\n    const onMouseMove = (e: MouseEvent) => {\n      onMove(e.pageX);\n    };\n    const onMove = (pageX: number) => {\n      if (isDragging.current) {\n        const rect = notNullish(scrubberRect.current);\n        const percentage = Math.min(1.0, Math.max(0.0, (pageX - rect.left) / rect.width));\n        pos.current = clamp(duration * percentage) / duration;\n        onDrag?.(pos.current * duration);\n\n        // We set the left value here directly instead of waiting for the React\n        // state change to trickle through. This actually leads to less input\n        // delay and a smoother dragging.\n        notNullish(ref.current).style.left = `${pos.current * 100}%`;\n      }\n    };\n    const onTouchMove = (e: TouchEvent) => {\n      if (e.touches.length > 0) {\n        onMove(e.touches[0].pageX);\n      }\n    };\n\n    document.addEventListener(\"mouseup\", onMouseUp);\n    document.addEventListener(\"touchend\", onMouseUp);\n    document.addEventListener(\"mousemove\", onMouseMove);\n    document.addEventListener(\"touchmove\", onTouchMove);\n\n    return () => {\n      document.removeEventListener(\"mouseup\", onMouseUp);\n      document.removeEventListener(\"touchend\", onMouseUp);\n      document.removeEventListener(\"mousemove\", onMouseMove);\n      document.removeEventListener(\"touchmove\", onTouchMove);\n    };\n  });\n\n  return (\n    <div\n      ref={ref}\n      onMouseDown={() => {\n        isDragging.current = true;\n        scrubberRect.current = notNullish(scrubberRef.current).getBoundingClientRect();\n      }}\n      onTouchStart={() => {\n        console.log(\"TOUCH START\");\n        isDragging.current = true;\n        scrubberRect.current = notNullish(scrubberRef.current).getBoundingClientRect();\n      }}\n      css={{\n        position: \"absolute\",\n        zIndex: 10,\n        left: `${initialPos * 100}%`,\n        cursor: \"grab\",\n        userSelect: \"none\",\n        top: \"50%\",\n        transform: \"translateY(-50%) translateX(-50%)\",\n        padding: \"8px 4px\", // To make grabbing it easier\n      }}\n    >\n      {children}\n    </div>\n  );\n};\n\nconst Controls: React.FC<SharedProps> = ({ currentTime, previewController }) => {\n  const { start, end } = useStudioState();\n  const recordingDispatch = useDispatch();\n  const settings = useSettings();\n  const { t } = useTranslation();\n\n  const togglePlayPause = () => {\n    const controller = previewController.current;\n    if (controller) {\n      if (controller.isPlaying) {\n        controller.pause();\n      } else if (controller.isReadyToPlay) {\n        controller.play();\n      }\n    }\n  };\n\n  useShortcut(SHORTCUTS.review.playPause, togglePlayPause, {\n    ignoreEventWhen: e => e.code === \"Space\" && e.target instanceof HTMLButtonElement,\n  });\n  const showShortcuts = useShowAvailableShortcuts();\n  const { isHighContrast } = useColorScheme();\n\n  const isPlaying = previewController.current?.isPlaying;\n  const label = t(`steps.review.${isPlaying ? \"pause\" : \"play\"}` as const);\n  return (\n    <div css={{\n      display: \"flex\",\n      gap: 16,\n      justifyContent: \"center\",\n      alignItems: \"flex-end\",\n    }}>\n      {/* Cut start */}\n      {settings.review?.disableCutting || <CutControls\n        marker=\"start\"\n        value={start}\n        control={end}\n        invariant={(start, end) => start < end}\n        {...{ recordingDispatch, previewController, currentTime }}\n      />}\n\n      {/* Play/pause button */}\n      <WithTooltip tooltip={label}>\n        <ProtoButton\n          aria-label={label}\n          css={{\n            backgroundColor: COLORS.accent5,\n            color: isHighContrast ? COLORS.neutral05 : \"white\",\n            border: \"none\",\n            borderRadius: \"50%\",\n            width: 48,\n            height: 48,\n            display: \"flex\",\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            fontSize: 24,\n            ...focusStyle({ offset: 1 }),\n            \"&:hover, :focus-visible\": {\n              backgroundColor: COLORS.accent6,\n              ...isHighContrast && {\n                backgroundColor: COLORS.neutral05,\n                outline: `2px solid ${COLORS.accent4}`,\n                color: COLORS.accent4,\n              },\n            },\n          }}\n          onClick={togglePlayPause}\n          onMouseDown={e => e.preventDefault()}\n        >\n          {showShortcuts && (\n            <div css={{\n              position: \"absolute\",\n              bottom: -20,\n              padding: 2,\n              borderRadius: 4,\n              backgroundColor: COLORS.neutral05,\n            }}><ShortcutKeys shortcut={SHORTCUTS.review.playPause.split(\";\")[0]} /></div>\n          )}\n          {isPlaying ? <FiPause /> : <FiPlay css={{ marginLeft: 3 }} />}\n        </ProtoButton>\n      </WithTooltip>\n\n      {/* Cut end */}\n      {settings.review?.disableCutting || <CutControls\n        marker=\"end\"\n        value={end}\n        control={start}\n        invariant={(end, start) => start < end}\n        {...{ recordingDispatch, previewController, currentTime }}\n      />}\n    </div>\n  );\n};\n\ntype CutControlsProps = SharedProps & {\n  marker: \"start\" | \"end\";\n  value: number | null;\n  control: number | null;\n  invariant: (self: number, control: number) => boolean;\n  recordingDispatch: Dispatcher;\n};\n\nconst CutControls: React.FC<CutControlsProps> = (\n  { marker, value, control, invariant, currentTime, previewController, recordingDispatch },\n) => {\n  const { t, i18n } = useTranslation();\n  const { isHighContrast } = useColorScheme();\n\n  const disabled = currentTime <= ALMOST_ZERO\n    || (previewController.current && currentTime >= previewController.current.duration)\n    || (control != null && !invariant(currentTime, control));\n\n  const cut = () => {\n    if (!previewController.current) {\n      return;\n    }\n\n    let value = previewController.current.currentTime;\n    // We disable the buttons when the generated values would be invalid,\n    // but we rely on `timeupdate` events for that, which are not guaranteed\n    // to be timely, so we still have to check the invariant when actually\n    // updating the state. Here we decided to just clamp the value appropriately.\n    if (control != null && !invariant(value, control)) {\n      value = control;\n    }\n    recordingDispatch({\n      type: marker === \"start\" ? \"UPDATE_START\" : \"UPDATE_END\",\n      time: value,\n    });\n  };\n\n  const shortcut = SHORTCUTS.review[marker === \"start\" ? \"cutLeft\" : \"cutRight\"];\n  useShortcut(shortcut, cut, { enabled: !disabled });\n  useShortcut(\n    SHORTCUTS.review[marker === \"start\" ? \"removeCutLeft\" : \"removeCutRight\"],\n    () => recordingDispatch({\n      type: marker === \"start\" ? \"UPDATE_START\" : \"UPDATE_END\",\n      time: null,\n    }),\n  );\n  const showShortcuts = useShowAvailableShortcuts();\n\n  const timestamp = (\n    <div css={{ minWidth: 68, textAlign: marker == \"start\" ? \"right\" : \"left\" }}>\n      { value !== null && (\n        <WithTooltip tooltip={t(\"steps.review.jump-to-cut-point\")}>\n          <ProtoButton\n            css={{\n              padding: \"4px 0\",\n              color: COLORS.accent6,\n            }}\n            onClick={event => {\n              event.preventDefault();\n              if (previewController.current) {\n                previewController.current.currentTime = value;\n              }\n            }}\n            onMouseDown={e => e.preventDefault()}\n          >\n            {formatTime(value, value, i18n.language)}\n          </ProtoButton>\n        </WithTooltip>\n      )}\n    </div>\n  );\n\n  const cutButton = (\n    <WithTooltip tooltip={t(`steps.review.set-${marker}`)}>\n      <ProtoButton\n        {...{ disabled }}\n        aria-label={t(`steps.review.set-${marker}`)}\n        onClick={cut}\n        onMouseDown={e => e.preventDefault()}\n        css={{\n          lineHeight: 0,\n          padding: \"4px 8px\",\n          paddingTop: 4,\n          borderRadius: 4,\n          ...focusStyle(),\n          \"&:disabled\": {\n            opacity: 0.3,\n          },\n          \"&:not(:disabled):hover\": {\n            backgroundColor: COLORS.neutral10,\n            color: isHighContrast ? COLORS.accent4 : \"inherit\",\n          },\n        }}\n      >\n        <CutHereIcon css={{\n          height: 36,\n          width: 36,\n          transform: marker === \"end\" ? \"scaleX(-1)\" : \"\",\n        }} />\n        {showShortcuts && !disabled && (\n          <div css={{\n            position: \"absolute\",\n            bottom: -20,\n            padding: 2,\n            borderRadius: 4,\n            backgroundColor: COLORS.neutral05,\n          }}><ShortcutKeys shortcut={shortcut} /></div>\n        )}\n      </ProtoButton>\n    </WithTooltip>\n  );\n\n  return marker === \"start\"\n    ? <>{timestamp}{cutButton}</>\n    : <>{cutButton}{timestamp}</>;\n};\n","var _path;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nconst SvgCutOutIcon = props => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  xmlns: \"http://www.w3.org/2000/svg\",\n  \"aria-hidden\": \"true\",\n  viewBox: \"0 0 100 65\",\n  width: \"1em\",\n  height: \"1em\"\n}, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"currentColor\",\n  d: \"M24.6 0c-.447 0-.894.171-1.24.511l-3.07 3.05a1.73 1.73 0 0 0 0 2.46l58.8 58.5c.685.681 1.79.681 2.47 0l3.07-3.05a1.73 1.73 0 0 0 0-2.46l-6.68-6.64h22v-7.32h-15.6c-1.44 0-2.6-1.15-2.6-2.59v-14.3c0-1.43 1.16-2.59 2.6-2.59h15.6v-7.32h-56.4L25.75.551A1.75 1.75 0 0 0 24.51.04zM0 18.2v7.32h3.7c1.44 0 2.6 1.15 2.6 2.59v14.3C6.3 43.84 5.14 45 3.7 45H0v7.32h55.8l-15.4-15.3v5.36c0 1.43-1.16 2.59-2.6 2.59H16c-1.44 0-2.6-1.15-2.6-2.59v-14.3c0-1.43 1.16-2.59 2.6-2.59h12.8l-7.36-7.32zm51 7.32h21c1.44 0 2.6 1.15 2.6 2.59v14.3c0 1.43-1.16 2.59-2.6 2.59h-1.4z\"\n})));\nexport default SvgCutOutIcon;","import {\n  forwardRef, useState, useRef, useImperativeHandle, SyntheticEvent,\n} from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { notNullish, useColorScheme } from \"@opencast/appkit\";\n\nimport { useStudioState } from \"../../studio-state\";\nimport CutOutIcon from \"./cut-out-icon.svg\";\nimport { VideoBox } from \"../../ui/VideoBox\";\nimport { SHORTCUTS, useShortcut } from \"../../shortcuts\";\n\n\ntype PreviewProps = {\n  onTimeUpdate: (event: SyntheticEvent<HTMLVideoElement, Event>) => void;\n  onPausePlay: (paused: boolean) => void;\n  onReady: () => void;\n};\n\nexport type PreviewHandle = {\n  currentTime: number;\n  readonly duration: number;\n  readonly isPlaying: boolean;\n  readonly isReadyToPlay: boolean;\n  play(): void;\n  pause(): void;\n};\n\nexport const Preview = forwardRef<PreviewHandle, PreviewProps>((\n  { onTimeUpdate, onReady, onPausePlay },\n  ref,\n) => {\n  const { recordings, start, end } = useStudioState();\n  const { t } = useTranslation();\n  const { isHighContrast } = useColorScheme();\n\n  const videoRefs = [useRef<HTMLVideoElement>(null), useRef<HTMLVideoElement>(null)];\n  const allVideos = videoRefs.slice(0, recordings.length);\n\n\n  // When updating the currenTime, i.e. the play position, we want to throttle\n  // this somehow. Just always setting `currentTime` is not ideal: consider\n  // `onMouseMove`, which would set a new value very frequently. Chrome and\n  // Firefox don't seem to handle that very well: every new time set will\n  // cancel the in-progress seeking, leading to quite large delays.\n  //\n  // What we do instead is: if we are not currently seeking, just set the time\n  // as normal. But if a seek operation is in progress, we just queue the time.\n  // Further below, the `onSeeked` event handler is the second part of the\n  // solution: when a seek operation has ended and a new time is queued, we\n  // seek to that time again. Put simply: we just wait for seek operations to\n  // finish before changing `currenTime` again.\n  const queuedSeek = useRef<number | null>(null);\n  const setTime = (newTime: number) => {\n    const isSeeking = allVideos.some(v => v.current?.seeking);\n    if (isSeeking) {\n      queuedSeek.current = newTime;\n    } else {\n      allVideos.forEach(r => {\n        if (r.current) {\n          r.current.currentTime = Math.max(0, Math.min(newTime, r.current.duration));\n        }\n      });\n    }\n  };\n\n  useImperativeHandle(ref, () => ({\n    get currentTime() {\n      return notNullish(videoRefs[0].current?.currentTime);\n    },\n    set currentTime(newTime) {\n      setTime(newTime);\n    },\n    get duration() {\n      return notNullish(videoRefs[0].current?.duration);\n    },\n    get isPlaying() {\n      const v = videoRefs[0].current;\n      return v != null && v.currentTime > 0 && !v.paused && !v.ended;\n    },\n    get isReadyToPlay() {\n      // State 2 means \"at least enough data to play one frame\"\n      return allVideos.every(r => (r.current?.readyState ?? 0) >= 2);\n    },\n    play() {\n      allVideos.forEach(r => r.current?.play());\n      onPausePlay(false);\n    },\n    pause() {\n      allVideos.forEach(r => r.current?.pause());\n      onPausePlay(true);\n    },\n  }));\n\n  // Some logic to decide whether we currently are in a part of the video that\n  // will be removed. The state will be updated in `onTimeUpdate` below and is\n  // only here to trigger a rerender: the condition for rendering the overlay is\n  // below.\n  const isInCutRegion = (time: number) =>\n    (start !== null && time < start) || (end !== null && time > end);\n  const currentTime = videoRefs[0].current?.currentTime || 0;\n  const overlayVisible = isInCutRegion(currentTime);\n  const [, setOverlayVisible] = useState(overlayVisible);\n\n\n  const jumpInTime = (diff: number) =>\n    setTime(notNullish(videoRefs[0].current?.currentTime) + diff);\n\n  // TODO: This is obviously not always correct. Finding out the FPS of the\n  // recording is surprisingly tricky. And actually, browsers seem to record\n  // with 30fps almost all of the time right now anway.\n  const fps = 30;\n  useShortcut(SHORTCUTS.review.forwards5secs, () => jumpInTime(5));\n  useShortcut(SHORTCUTS.review.backwards5secs, () => jumpInTime(-5));\n  useShortcut(SHORTCUTS.review.forwardsFrame, () => jumpInTime(1 / fps), { useKey: true });\n  useShortcut(SHORTCUTS.review.backwardsFrame, () => jumpInTime(-1 / fps), { useKey: true });\n\n\n  const children = recordings.map((recording, index) => ({\n    dimensions: () => recording.dimensions,\n    body: (\n      <div css={{ position: \"relative\", width: \"100%\", height: \"100%\" }}>\n        {overlayVisible && (\n          <div css={{\n            position: \"absolute\",\n            left: 0,\n            right: 0,\n            top: 0,\n            bottom: 0,\n            backgroundColor: \"rgba(0, 0, 0, 0.65)\",\n            color: \"white\",\n            display: \"flex\",\n            flexDirection: \"column\",\n            alignItems: \"center\",\n            justifyContent: \"start\",\n            paddingTop: 16,\n            pointerEvents: \"none\",\n          }}>\n            <CutOutIcon css={{ fontSize: \"3em\" }}/>\n            <p css={{ margin: \"8px 0\" }}>{t(\"steps.review.part-will-be-removed\")}</p>\n          </div>\n        )}\n        <video\n          ref={videoRefs[index]}\n          key={index}\n          src={recording.url}\n          onLoadedData={() => onReady()}\n          onSeeked={() => {\n            const isOtherSeeking = videoRefs[index == 0 ? 1 : 0].current?.seeking;\n            const queued = queuedSeek.current;\n            if (!isOtherSeeking && queued != null) {\n              allVideos.forEach(r => {\n                if (r.current) {\n                  r.current.currentTime = queued;\n                }\n              });\n              queuedSeek.current = null;\n            }\n          }}\n          onTimeUpdate={event => {\n            setOverlayVisible(isInCutRegion(event.currentTarget.currentTime));\n            onTimeUpdate(event);\n          }}\n\n          // For iOS: without the autoplay attribute, the `loadeddata` event is\n          // never fired for some reason. Adding this does not seem to actually\n          // cause Safari to autoplay.\n          autoPlay={/iPad|iPhone|iPod/.test(navigator.userAgent)}\n\n          // Also for iOS: without this, the video maximizes automatically.\n          playsInline\n\n          preload=\"auto\"\n          tabIndex={-1}\n          css={{\n            width: \"100%\",\n            height: \"100%\",\n            outline: \"none\",\n            boxShadow: isHighContrast ? \"none\" : \"0 4px 16px var(--shadow-color)\",\n            borderRadius: 16,\n          }}\n        />\n      </div>\n    ),\n  }));\n\n  return <VideoBox gap={20}>{children}</VideoBox>;\n});\n","import React, { useState, useRef } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Spinner, match } from \"@opencast/appkit\";\n\nimport { StepContainer } from \"../elements\";\nimport { useStudioState, useDispatch } from \"../../studio-state\";\nimport { StepProps } from \"..\";\nimport { ErrorBox } from \"../../ui/ErrorBox\";\nimport { ControlBox } from \"./control-box\";\nimport { Preview, PreviewHandle } from \"./preview\";\nimport { FiTrash } from \"react-icons/fi\";\n\n\n// In some situation we would like to set the current time to 0 or check for it.\n// Thanks to a browser bug, setting the current time to 0 fails. Using a number\n// slightly higher works though. So we use this 1ms time for now. Sigh.\nexport const ALMOST_ZERO = 0.001;\n\nexport const Review: React.FC<StepProps> = ({ goToFirstStep, goToNextStep }) => {\n  const { t } = useTranslation();\n  const recordingDispatch = useDispatch();\n  const { recordings, prematureRecordingEnd, videoChoice } = useStudioState();\n  const emptyRecording = recordings.some(rec => rec.media.size === 0);\n  const previewController = useRef<PreviewHandle>(null);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [previewReady, setPreviewReady] = useState(false);\n  const [_isPaused, setIsPaused] = useState(true);\n\n  const expectedRecordings = match(videoChoice, {\n    \"both\": () => 2,\n    \"display\": () => 1,\n    \"user\": () => 1,\n    \"none\": () => 0,\n  });\n\n  return (\n    <StepContainer\n      title={t(\"steps.review.label\")}\n      note={t(\"steps.review.only-on-upload-note\")}\n      prevButton={{\n        danger: true,\n        icon: <FiTrash />,\n        label: t(\"steps.review.button-discard-and-record\"),\n        onClick: () => {\n          const doIt = window.confirm(t(\"confirm-discard-recordings\"));\n          if (doIt) {\n            recordingDispatch({ type: \"RESET\" });\n            goToFirstStep();\n          }\n        },\n      }}\n      nextButton={{ onClick: goToNextStep }}\n    >\n      {prematureRecordingEnd && (\n        <ErrorBox body={t(\"error-lost-stream-end-recording\")} />\n      )}\n\n      {emptyRecording && (\n        <ErrorBox body={t(\"steps.review.error-empty-recording\")} />\n      )}\n\n      {(!previewReady || recordings.length !== expectedRecordings) && (\n        <div css={{\n          flex: 1,\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          fontSize: 42,\n        }}>\n          <Spinner />\n        </div>\n      )}\n      {recordings.length === expectedRecordings && (\n        <div css={{\n          display: previewReady ? \"flex\" : \"none\",\n          flex: \"1 1 auto\",\n          gap: 16,\n          flexDirection: \"column\",\n        }}>\n          <Preview\n            ref={previewController}\n            onTimeUpdate={event => {\n              setCurrentTime(event.currentTarget.currentTime);\n            }}\n            onPausePlay={paused => setIsPaused(paused)}\n            onReady={() => setPreviewReady(true)}\n          />\n\n          <ControlBox {...{ previewController, currentTime }} />\n        </div>\n      )}\n    </StepContainer>\n  );\n};\n","import React, { useRef } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { FiDownload } from \"react-icons/fi\";\nimport { LuCircleCheckBig } from \"react-icons/lu\";\n\nimport { useDispatch, useStudioState, Recording } from \"../../studio-state\";\nimport { recordingFileName } from \"../../util\";\nimport { SHORTCUTS, ShortcutKeys, useShortcut, useShowAvailableShortcuts } from \"../../shortcuts\";\nimport { prettyFileSize, sharedButtonStyle } from \".\";\nimport { useColorScheme } from \"@opencast/appkit\";\n\n\n\nexport const SaveLocally: React.FC = () => {\n  const { recordings } = useStudioState();\n  return recordings.map((r, i) => <SaveLocallySingle key={i} idx={i} recording={r} />);\n};\n\ntype SaveLocallySingleProps = {\n  recording: Recording;\n  idx: number;\n};\n\nconst SaveLocallySingle: React.FC<SaveLocallySingleProps> = ({ recording, idx }) => {\n  const { t, i18n } = useTranslation();\n  const { title, presenter } = useStudioState();\n  const { isHighContrast } = useColorScheme();\n  const dispatch = useDispatch();\n  const showShortcuts = useShowAvailableShortcuts();\n\n  const button = useRef<HTMLAnchorElement>(null);\n  useShortcut(SHORTCUTS.finish.download, () => {\n    button.current?.click();\n  });\n\n  const { deviceType, mimeType, url, downloaded, media: blob } = recording;\n  const flavor = deviceType === \"desktop\" ? t(\"sources-display\") : t(\"sources-user\");\n  const downloadName = recordingFileName({ mime: mimeType, flavor, title, presenter });\n\n  if (!url) {\n    return null;\n  }\n\n  return (\n    <div css={{\n      display: \"flex\",\n      flexDirection: \"column\",\n      alignItems: \"center\",\n      \":not(:first-of-type)\": {\n        marginTop: 32,\n      },\n    }}>\n      <div css={{\n        position: \"relative\",\n      }}>\n        <video\n          tabIndex={-1}\n          muted\n          src={url}\n          // Without this, some browsers show a black video element instead of the first frame.\n          onLoadedData={e => e.currentTarget.currentTime = 0}\n          preload=\"auto\"\n          css={{\n            borderRadius: 4,\n            display: \"block\",\n            maxHeight: 190,\n            maxWidth: \"100%\",\n            margin: \"0 auto\",\n          }}\n        />\n        {downloaded && (\n          <div css={{\n            position: \"absolute\",\n            bottom: 0,\n            right: 0,\n            left: 0,\n            color: \"white\",\n            backgroundColor: \"rgba(30, 30, 30, 0.85)\",\n            display: \"flex\",\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            gap: 8,\n            padding: 12,\n            borderRadius: \"0 0 4px 4px\",\n          }}>\n            <LuCircleCheckBig css={{ fontSize: 22 }} />\n            {t(\"steps.finish.save-locally.recording-saved\")}\n          </div>\n        )}\n      </div>\n      <a\n        ref={button}\n        aria-label={t(`steps.finish.save-locally.save-${deviceType}-locally`)}\n        target=\"_blank\"\n        download={downloadName}\n        href={url}\n        rel=\"noopener noreferrer\"\n        role=\"button\"\n        onClick={() => dispatch({ type: \"MARK_DOWNLOADED\", index: idx })}\n        onKeyDown={e => {\n          if (e.key === \" \") {\n            e.preventDefault();\n            button.current?.click();\n          }\n        }}\n        css={{\n          ...sharedButtonStyle(isHighContrast),\n          justifyContent: \"center\",\n          maxWidth: 260,\n          margin: \"auto\",\n          marginTop: 8,\n        }}\n      >\n        <FiDownload css={{ fontSize: 20 }} />\n        {t(\"steps.finish.save-locally.label\") + \" (\" + prettyFileSize(blob.size, i18n) + \")\"}\n        {showShortcuts && (\n          <div css={{ position: \"absolute\", right: -4, bottom: -4 }}>\n            <ShortcutKeys shortcut={SHORTCUTS.finish.download} />\n          </div>\n        )}\n      </a>\n    </div>\n  );\n};\n","import { HTMLInputTypeAttribute, useEffect, useId, useRef, useState } from \"react\";\nimport { Trans, useTranslation } from \"react-i18next\";\nimport Select, { CSSObjectWithLabel, SelectInstance } from \"react-select\";\nimport {\n  ControllerRenderProps, FieldError, FieldValues, Path, SubmitHandler, Validate,\n  useController, useForm,\n} from \"react-hook-form\";\nimport { FiUpload } from \"react-icons/fi\";\nimport { LuCircleCheckBig } from \"react-icons/lu\";\nimport { ProtoButton, Spinner, match, notNullish, unreachable, useColorScheme } from \"@opencast/appkit\";\n\nimport { useDispatch, useStudioState } from \"../../studio-state\";\nimport { Opencast, useOpencast } from \"../../opencast\";\nimport { useSettings, useSettingsManager } from \"../../settings\";\nimport { COLORS, focusStyle } from \"../../util\";\nimport { ErrorBox } from \"../../ui/ErrorBox\";\nimport { prettyFileSize, sharedButtonStyle } from \".\";\n\n\nconst LAST_PRESENTER_KEY = \"ocStudioLastPresenter\";\n\nlet progressHistory: { timestamp: number; progress: number }[] = [];\n\n\nexport const UploadBox: React.FC = () => {\n  const settings = useSettings();\n  const { t } = useTranslation();\n  const opencast = useOpencast();\n  const { recordings, upload: uploadState, title, presenter, ...state } = useStudioState();\n  const dispatch = useDispatch();\n\n  function onProgress(progress: number) {\n    // ----- Time estimation -----\n    // We use a simple sliding average over the last few data points and assume\n    // that speed for the rest of the upload.\n    const now = Date.now();\n\n    // Add progress data point to history.\n    progressHistory.push({\n      timestamp: now,\n      progress,\n    });\n\n    // The size of the sliding window in milliseconds.\n    const WINDOW_SIZE_MS = 5000;\n    // The size of the sliding window in number of data points.\n    const WINDOW_SIZE_DATA_POINTS = 6;\n    // The number of datapoints below which we won't show a time estimate.\n    const MINIMUM_DATA_POINT_COUNT = 4;\n\n    // Find the first element within the window. We use the larger window of the\n    // two windows created by the two constraints (time and number of\n    // datapoints).\n    const windowStart = Math.min(\n      progressHistory.findIndex(p => (now - p.timestamp) < WINDOW_SIZE_MS),\n      Math.max(0, progressHistory.length - WINDOW_SIZE_DATA_POINTS),\n    );\n\n    // Remove all elements outside the window.\n    progressHistory.splice(0, windowStart);\n\n    let secondsLeft: null | number = null;\n    if (progressHistory.length >= MINIMUM_DATA_POINT_COUNT) {\n      // Calculate the remaining time based on the average speed within the window.\n      const windowLength = now - progressHistory[0].timestamp;\n      const progressInWindow = progress - progressHistory[0].progress;\n      const progressPerSecond = (progressInWindow / windowLength) * 1000;\n      const progressLeft = 1 - progress;\n      secondsLeft = Math.max(0, Math.round(progressLeft / progressPerSecond));\n    }\n\n    // Update state if anything changed. We actually check for equality here to\n    // avoid useless redraws.\n    if (uploadState.secondsLeft !== secondsLeft || uploadState.currentProgress !== progress) {\n      dispatch({\n        type: \"UPLOAD_PROGRESS_UPDATE\",\n        secondsLeft,\n        currentProgress: progress,\n      });\n    }\n  }\n\n  useEffect(() => {\n    // To still update the time estimation, we make sure to call `onProgress` at\n    // least every so often.\n    const interval = setInterval(() => {\n      if (uploadState.state !== \"uploading\") {\n        return;\n      }\n\n      if (!progressHistory.length) {\n        onProgress(0);\n      } else {\n        const lastProgress = progressHistory[progressHistory.length - 1];\n        const timeSinceLastUpdate = Date.now() - lastProgress.timestamp;\n        if (timeSinceLastUpdate > 3000) {\n          onProgress(lastProgress.progress);\n        }\n      }\n    }, 1000);\n\n    return () => clearInterval(interval);\n  });\n\n  const handleUpload: SubmitHandler<Inputs> = async data => {\n    dispatch({ type: \"UPLOAD_REQUEST\" });\n    progressHistory.push({\n      timestamp: Date.now(),\n      progress: 0,\n    });\n    const result = await opencast.upload({\n      recordings: recordings.filter(Boolean),\n      title: data.title,\n      presenter: data.presenter,\n      series: data.series,\n      uploadSettings: settings.upload,\n      onProgress,\n      start: state.start,\n      end: state.end,\n      startTime: state.recordingStartTime ?? unreachable(\"no start time set\"),\n      endTime: state.recordingEndTime ?? unreachable(\"no end time set\"),\n    });\n    progressHistory = [];\n\n    const dispatchError = (msg: string) => dispatch({ type: \"UPLOAD_ERROR\", msg });\n    console.log({ result });\n    const _ = match(result, {\n      \"success\": () => dispatch({ type: \"UPLOAD_SUCCESS\" }),\n      \"network_error\": () => dispatchError(t(\"steps.finish.upload.upload-network-error\")),\n      \"not_authorized\": () => dispatchError(t(\"steps.finish.upload.upload-not-authorized\")),\n      \"unexpected_response\": () => dispatchError(t(\"steps.finish.upload.upload-invalid-response\")),\n      \"unknown_error\": () => dispatchError(t(\"steps.finish.upload.upload-unknown-error\")),\n    });\n  };\n\n  switch (uploadState.state) {\n    case \"uploading\":\n      return <UploadProgress\n        currentProgress={uploadState.currentProgress}\n        secondsLeft={uploadState.secondsLeft}\n      />;\n    case \"uploaded\":\n      return <UploadSuccess />;\n    default: // \"not_uploaded\" or \"error\"\n      return <UploadForm {...{ uploadState, handleUpload }} />;\n  }\n};\n\n\ntype Inputs = {\n  title: string;\n  presenter: string;\n  series: string;\n  serverUrl: string;\n  loginName: string;\n  loginPassword: string;\n};\n\ntype UploadFormProps = {\n  handleUpload: SubmitHandler<Inputs>;\n};\n\nconst UploadForm: React.FC<UploadFormProps> = ({ handleUpload }) => {\n  const {\n    titleField = \"required\",\n    presenterField = \"required\",\n    seriesField = \"optional\",\n    autofillPresenter = [],\n  } = useSettings().upload ?? {};\n\n  const { t, i18n } = useTranslation();\n  const opencast = useOpencast();\n  const dispatch = useDispatch();\n  const settingsManager = useSettingsManager();\n  const { title, presenter, upload: uploadState, recordings } = useStudioState();\n  const presenterValue = presenter\n    || window.localStorage.getItem(LAST_PRESENTER_KEY)\n    || autofillPresenter\n      .map(source => match(source, {\n        \"opencast\": () => opencast.getUsername(),\n      }))\n      .find(Boolean)\n    || \"\";\n\n  type FormState = \"idle\" | \"testing\";\n  const [state, setState] = useState<FormState>(\"idle\");\n\n  const { formState: { errors }, handleSubmit, register, control, getValues } = useForm<Inputs>({\n    defaultValues: settingsManager.formValues().opencast,\n  });\n  const { field: seriesSelect } = useController({\n    name: \"series\",\n    control,\n    rules: {\n      required: seriesField === \"required\"\n        ? t(\"steps.finish.upload.validation-error-required\")\n        : false,\n    },\n  });\n\n  // This is a bit ugly, but works. We want to make sure that the `title` and\n  // `presenter` values in the studio state always equal the current value in\n  // the input.\n  function handleInputChange(event: React.ChangeEvent<HTMLInputElement>) {\n    const target = event.target;\n    dispatch({\n      type: notNullish(\n        ({ title: \"UPDATE_TITLE\", presenter: \"UPDATE_PRESENTER\" } as const)[target.name],\n      ),\n      value: target.value,\n    });\n\n    if (target.name === \"presenter\") {\n      window.localStorage.setItem(LAST_PRESENTER_KEY, target.value);\n    }\n  }\n\n  // If the user has not yet changed the value of the field, but it has been prefilled\n  // from local storage or one of the `autofillPresenter` sources, update the state\n  // using that value.\n  useEffect(() => {\n    if (presenterValue !== presenter) {\n      dispatch({ type: \"UPDATE_PRESENTER\", value: presenterValue });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const configurableServerUrl = settingsManager.isConfigurable(\"opencast.serverUrl\");\n  const configurableUsername = settingsManager.isUsernameConfigurable();\n  const configurablePassword = settingsManager.isPasswordConfigurable();\n  const showOpencastSection = configurableServerUrl || configurableUsername || configurablePassword;\n\n  const ocDataFromInputs = (data: Inputs) => ({\n    serverUrl: data.serverUrl,\n    loginName: data.loginName,\n    loginPassword: data.loginPassword,\n  });\n\n  const onSubmit: SubmitHandler<Inputs> = async data => {\n    if (!showOpencastSection) {\n      await handleUpload(data);\n      return;\n    }\n\n    console.log(data);\n    setState(\"testing\");\n\n    // Update Opencast connection data. This is a bit roundabout right now as\n    // the Opencast logic is still from pre-redesign, where the connection data\n    // was given on a separate settings page.\n    const ocData = ocDataFromInputs(data);\n    const oc = await Opencast.init({\n      ...settingsManager.settings().opencast,\n      ...ocData,\n    });\n\n    const ocState = oc.getState();\n    if (ocState === \"logged_in\") {\n      opencast.setGlobalInstance(oc);\n      settingsManager.saveSettings({ opencast: ocData });\n      // The connection to Opencast works -> now actually start the upload.\n      await handleUpload(data);\n    } else {\n      const error = match(ocState, {\n        \"incorrect_login\": () => opencast.isLoginProvided()\n          ? t(\"steps.finish.upload.settings-invalid-provided-login\")\n          : t(\"steps.finish.upload.settings-invalid-login-data\"),\n        \"network_error\": () => t(\"steps.finish.upload.upload-network-error\"),\n        \"invalid_response\": () => t(\"steps.finish.upload.upload-invalid-response\"),\n        \"response_not_ok\": () => t(\"steps.finish.upload.upload-invalid-response\"),\n      }) ?? unreachable();\n\n      dispatch({ type: \"UPLOAD_ERROR\", msg: error });\n      setState(\"idle\");\n    }\n  };\n\n  const totalBytes = recordings.reduce((acc, rec) => acc + rec.media.size, 0);\n  const uploadSize = prettyFileSize(totalBytes, i18n);\n  const { isHighContrast } = useColorScheme();\n\n  // Testing the new connection settings to establish a connection ASAP to make\n  // the series selector work.\n  const onConnectionSettingChange = async () => {\n    const data = getValues();\n\n    // If nothing changed, do nothing.\n    const ocSettings = settingsManager.settings().opencast;\n    const anyChange = (data.serverUrl && data.serverUrl !== ocSettings?.serverUrl)\n      || (data.loginName && data.loginName !== ocSettings?.loginName)\n      || (data.loginPassword && data.loginPassword !== ocSettings?.loginPassword);\n    if (!anyChange) {\n      return;\n    }\n\n    const ocData = ocDataFromInputs(data);\n    const oc = await Opencast.init({\n      ...settingsManager.settings().opencast,\n      ...ocData,\n    });\n\n    if (oc.getState() === \"logged_in\") {\n      opencast.setGlobalInstance(oc);\n      settingsManager.saveSettings({ opencast: ocData });\n    }\n  };\n\n  return (\n    <>\n      <form onSubmit={handleSubmit(onSubmit)}>\n        {titleField !== \"hidden\" && <Input\n          name=\"title\"\n          label={t(\"steps.finish.upload.label-title\")}\n          required={titleField === \"required\"}\n          onChange={handleInputChange}\n          autoComplete=\"off\"\n          defaultValue={title}\n          autoFocus\n          {...{ errors, register }}\n        />}\n        {presenterField !== \"hidden\" && <Input\n          name=\"presenter\"\n          label={t(\"steps.finish.upload.label-presenter\")}\n          required={presenterField === \"required\"}\n          onChange={handleInputChange}\n          autoComplete=\"off\"\n          defaultValue={presenterValue}\n          {...{ errors, register }}\n        />}\n        {seriesField !== \"hidden\" && <SeriesSelect\n          formProps={seriesSelect}\n          showOpencastSection={showOpencastSection}\n          errors={errors}\n        />}\n\n        {showOpencastSection && <>\n          <h3 css={{\n            fontSize: 16,\n            fontWeight: 700,\n            marginTop: 20,\n          }}>{t(\"steps.finish.upload.settings-header\")}</h3>\n\n          {configurableServerUrl && <Input\n            errors={errors}\n            label={t(\"steps.finish.upload.settings-label-server-url\")}\n            name=\"serverUrl\"\n            register={register}\n            onBlur={onConnectionSettingChange}\n            required\n            validate={(value: string) => {\n              try {\n                const url = new URL(value);\n                return (url.protocol === \"https:\" || url.protocol === \"http:\")\n                  || t(\"steps.finish.upload.settings-invalid-url-http-start\");\n              } catch {\n                let err = t(\"steps.finish.upload.settings-invalid-url\");\n                if (!value.startsWith(\"https://\") && !value.startsWith(\"http://\")) {\n                  err += \" \" + t(\"steps.finish.upload.settings-invalid-url-http-start\");\n                }\n                return err;\n              }\n            }}\n          />}\n\n          {configurableUsername && <Input\n            errors={errors}\n            label={t(\"steps.finish.upload.settings-label-username\")}\n            name=\"loginName\"\n            register={register}\n            onBlur={onConnectionSettingChange}\n            required\n          />}\n\n          {configurablePassword && <Input\n            errors={errors}\n            label={t(\"steps.finish.upload.settings-label-password\")}\n            name=\"loginPassword\"\n            register={register}\n            onBlur={onConnectionSettingChange}\n            required\n            type=\"password\"\n          />}\n        </>}\n\n        {/* Upload button */}\n        <ProtoButton\n          type=\"submit\"\n          css={{\n            ...sharedButtonStyle(isHighContrast),\n            margin: \"0 auto\",\n            marginTop: 24,\n          }}\n        >\n          {match(state, {\n            \"idle\": () => <FiUpload css={{ fontSize: 20 }} />,\n            \"testing\": () => <Spinner size={20} />,\n          })}\n          <span>{t(\"steps.finish.upload.label\") + \" (\" + uploadSize + \")\"}</span>\n        </ProtoButton>\n      </form>\n\n      {/* Upload error box */}\n      <div css={{ marginTop: 8 }}>\n        {uploadState.state === \"error\" && (\n          <ErrorBox\n            css={{ margin: 0 }}\n            body={notNullish(uploadState.error)}\n            extraBody={t(\"steps.finish.upload.warn-download-hint\")}\n          />\n        )}\n      </div>\n    </>\n  );\n};\n\ntype InputProps<I extends FieldValues, F> =\n  Pick<\n    JSX.IntrinsicElements[\"input\"],\n    \"onChange\" | \"autoComplete\" | \"defaultValue\" | \"onBlur\"\n  > &\n  Pick<ReturnType<typeof useForm<I>>, \"register\"> & {\n    /** Human readable string describing the field. */\n    label: string;\n    name: Path<I>;\n    /** Whether this field is required or may be empty. */\n    required: boolean;\n    /** Function validating the value and returning a string in the case of error. */\n    validate?: Validate<F, I>;\n    errors: Partial<Record<keyof I, FieldError>>;\n    /** Passed to the `<input>`. */\n    type?: HTMLInputTypeAttribute;\n    autoFocus?: boolean;\n  };\n\n/**\n * A styled `<input>` element with a label. Displays errors and integrated with\n * `react-hook-form`.\n */\nexport const Input = <I extends FieldValues, F>({\n  errors,\n  register,\n  label,\n  name,\n  required,\n  validate,\n  type = \"text\",\n  ...rest\n}: InputProps<I, F>) => {\n  const { t } = useTranslation();\n  const error = errors[name];\n  const id = useId();\n\n  return (\n    <div css={{ marginBottom: 12 }}>\n      <label htmlFor={id} css={{\n        display: \"block\",\n        fontWeight: 700,\n        color: COLORS.neutral70,\n        margin: \"4px 0\",\n        fontSize: 14,\n      }}>\n        {label}\n      </label>\n      <div css={{\n        display: \"block\",\n        boxSizing: \"border-box\",\n        position: \"relative\",\n        textAlign: \"left\",\n      }}>\n        <input\n          id={id}\n          aria-invalid={error ? \"true\" : \"false\"}\n          aria-describedby={error ? `${name}Error` : id}\n          autoComplete=\"off\"\n          type={type}\n          {...rest}\n          {...register(name, {\n            validate,\n            onChange: rest.onChange,\n            onBlur: rest.onBlur,\n            ...required && { required: t(\"steps.finish.upload.validation-error-required\") },\n          })}\n          css={{\n            display: \"block\",\n            width: \"100%\",\n            borderRadius: 4,\n            border: `1px solid ${error ? COLORS.danger4 : COLORS.neutral30}`,\n            backgroundColor: COLORS.neutral00,\n            color: COLORS.neutral70,\n            padding: \"8px 16px\",\n            ...focusStyle({ offset: -1 }),\n          }}\n        />\n        {error && <ErrorContainer id={`${name}Error`}>\n          {error.message}\n        </ErrorContainer>}\n      </div>\n    </div>\n  );\n};\n\ntype ErrorContainerProps = React.PropsWithChildren<{\n  id: string;\n}>;\n\nconst ErrorContainer: React.FC<ErrorContainerProps> = ({ id, children }) => (\n  <div\n    id={id}\n    css={{\n      backgroundColor: COLORS.danger1,\n      color: COLORS.danger5,\n      marginTop: 4,\n      borderRadius: 4,\n      padding: \"6px 12px\",\n      lineHeight: 1.2,\n    }}\n  >\n    {children}\n  </div>\n);\n\n\ntype SeriesSelectProps = {\n  formProps: ControllerRenderProps<Inputs, \"series\">;\n  showOpencastSection: boolean;\n  errors: Partial<Record<keyof Inputs, FieldError>>;\n};\n\nconst SeriesSelect: React.FC<SeriesSelectProps> = ({ formProps, showOpencastSection, errors }) => {\n  const { t, i18n } = useTranslation();\n  const opencast = useOpencast();\n  const { scheme } = useColorScheme();\n  const seriesId = useSettings().upload?.seriesId;\n\n  type Option = { value: string; label: string };\n  const [options, setOptions] = useState<Option[] | \"error\" | null>(null);\n  const ref = useRef<SelectInstance<Option>>(null);\n  useEffect(() => {\n    setOptions(null);\n    opencast.getSeries().then(\n      result => {\n        const options = [...result.entries()].map(([value, label]) => ({ value, label }));\n        options.sort(\n          (a, b) => a.label.localeCompare(b.label, i18n.language, { sensitivity: \"base\" }),\n        );\n\n        // If a seriesID is given, make the select use that as default value.\n        if (seriesId) {\n          const title = result.get(seriesId);\n          const defaultOption = {\n            label: title ?? t(\"steps.finish.upload.series-unknown\"),\n            value: seriesId,\n          };\n          if (title == null) {\n            options.push(defaultOption);\n          }\n          ref.current?.setValue(defaultOption, \"select-option\");\n        }\n\n        setOptions(options);\n      },\n      e => {\n        console.log(\"Error fetching series: \", e);\n        setOptions(\"error\");\n      },\n    );\n  }, [opencast, t, i18n.language, seriesId]);\n\n  const inputId = useId();\n  const errorId = useId();\n  const error = options === \"error\";\n  return (\n    <div css={{ marginBottom: 12 }}>\n      <label htmlFor={inputId} css={{\n        display: \"block\",\n        fontWeight: 700,\n        color: COLORS.neutral70,\n        margin: \"4px 0\",\n        fontSize: 14,\n      }}>\n        {t(\"steps.finish.upload.label-series\")}\n      </label>\n\n      <Select\n        id={inputId}\n        ref={ref}\n        options={options && options !== \"error\" ? options : []}\n        isLoading={options === null}\n        isDisabled={options === \"error\"}\n        isClearable\n        isSearchable\n        onChange={data => formProps.onChange(data?.value)}\n        onBlur={formProps.onBlur}\n        aria-invalid={error ? \"true\" : \"false\"}\n        aria-describedby={error ? errorId : inputId}\n\n        // Styling\n        placeholder={t(\"steps.finish.upload.series-placeholder\")}\n        loadingMessage={() => t(\"steps.finish.upload.series-loading\")}\n        noOptionsMessage={() => t(\"steps.finish.upload.series-none\")}\n        styles={selectStyles(scheme.startsWith(\"dark\"), scheme.endsWith(\"high-contrast\"))}\n        theme={theme => ({\n          ...theme,\n          colors: {\n            ...theme.colors,\n            danger: COLORS.danger0,\n            primary: COLORS.focus,\n            neutral0: COLORS.neutral00,\n            neutral5: COLORS.neutral15,\n            neutral10: COLORS.neutral20,\n            neutral20: COLORS.neutral30,\n            neutral30: COLORS.neutral40,\n            neutral40: COLORS.neutral50,\n            neutral50: COLORS.neutral50,\n            neutral60: COLORS.neutral60,\n            neutral70: COLORS.neutral70,\n            neutral80: COLORS.neutral80,\n            neutral90: COLORS.neutral90,\n          },\n        })}\n      />\n      {error && (\n        <ErrorContainer id={errorId}>\n          {t(\"steps.finish.upload.series-fetch-error\")}\n          {showOpencastSection && (\n            \" \" + t(\"steps.finish.upload.series-connection-settings-hint\")\n          )}\n        </ErrorContainer>\n      )}\n      {errors[\"series\"] && (\n        <ErrorContainer id={errorId}>{errors[\"series\"].message}</ErrorContainer>\n      )}\n    </div>\n  );\n};\n\nexport const selectStyles = (isDark: boolean, isHighContrast: boolean) => ({\n  control: (baseStyles: CSSObjectWithLabel, state: { isFocused: boolean }) => ({\n    ...baseStyles,\n    backgroundColor: COLORS.neutral00,\n    paddingLeft: 8,\n    ...!state.isFocused && { borderColor: COLORS.neutral30 },\n    ...state.isFocused && {\n      // react-select uses box-shadow as outline. But it's not quite large\n      // enough, so we override it here.\n      boxShadow: `0 0 0 1.5px ${COLORS.focus}`,\n    },\n  }),\n  input: (baseStyles: CSSObjectWithLabel) => ({\n    ...baseStyles,\n    color: COLORS.neutral80,\n    padding: \"4px 0\",\n  }),\n  placeholder: (baseStyles: CSSObjectWithLabel) => ({\n    ...baseStyles,\n    color: COLORS.neutral60,\n  }),\n  singleValue: (baseStyles: CSSObjectWithLabel) => ({\n    ...baseStyles,\n    color: COLORS.neutral90,\n  }),\n  menuList: (baseStyles: CSSObjectWithLabel) => ({\n    ...baseStyles,\n    padding: 0,\n  }),\n  menu: (baseStyles: CSSObjectWithLabel) => ({\n    ...baseStyles,\n    ...isDark && { outline: `1px solid ${COLORS.neutral20}` },\n    ...isHighContrast && { outline: `1px solid ${COLORS.neutral90}` },\n    backgroundColor: isDark ? COLORS.neutral10 : COLORS.neutral05,\n    overflow: \"hidden\",\n  }),\n  option: (_baseStyles: CSSObjectWithLabel, state: {\n    isSelected: boolean;\n    isFocused: boolean;\n  }) => ({\n    cursor: \"default\",\n    padding: \"6px 10px\",\n    borderLeft: `4px solid ${state.isSelected ? COLORS.focus : \"transparent\"}`,\n    ...isHighContrast && state.isFocused && {\n      outline: `2px solid ${COLORS.neutral90}`,\n      outlineOffset: -3,\n    },\n    ...(state.isFocused || state.isSelected) && !isHighContrast && {\n      backgroundColor: isDark ? COLORS.neutral25 : COLORS.neutral10,\n    },\n  }),\n});\n\n\ntype UploadProgressProps = {\n  currentProgress: number;\n  secondsLeft: number | null;\n};\n\n/**\n * Shown during upload. Shows a progressbar, the percentage of data already\n * uploaded and `secondsLeft` nicely formatted as human readable time.\n */\nconst UploadProgress: React.FC<UploadProgressProps> = ({ currentProgress, secondsLeft }) => {\n  const { t, i18n } = useTranslation();\n\n  // Progress as percent with one fractional digit, e.g. 27.3%.\n  const roundedPercent = Math.min(100, currentProgress * 100).toLocaleString(i18n.language, {\n    minimumFractionDigits: 1,\n    maximumFractionDigits: 1,\n  });\n\n  // Nicely format the remaining time.\n  let prettyTime: string | null;\n  if (secondsLeft === null) {\n    prettyTime = null;\n  } else if (secondsLeft < 4) {\n    prettyTime = t(\"steps.finish.upload.time.a-few-seconds\");\n  } else if (secondsLeft < 45) {\n    prettyTime = `${secondsLeft} ${t(\"steps.finish.upload.time.seconds\")}`;\n  } else if (secondsLeft < 90) {\n    prettyTime = t(\"steps.finish.upload.time.a-minute\");\n  } else if (secondsLeft < 45 * 60) {\n    prettyTime = `${Math.round(secondsLeft / 60)} ${t(\"steps.finish.upload.time.minutes\")}`;\n  } else if (secondsLeft < 90 * 60) {\n    prettyTime = t(\"steps.finish.upload.time.an-hour\");\n  } else if (secondsLeft < 24 * 60 * 60) {\n    prettyTime = `${Math.round(secondsLeft / (60 * 60))} ${t(\"steps.finish.upload.time.hours\")}`;\n  } else {\n    prettyTime = null;\n  }\n\n  return (\n    <GreyInnerBox>\n      {/* Heading */}\n      <div css={{ fontWeight: 700 }}>{t(\"steps.finish.upload.currently-uploading\")}</div>\n\n      {/* Progress bar */}\n      <div css={{\n        marginTop: 16,\n        marginBottom: 8,\n        height: 6,\n        borderRadius: 3,\n        backgroundColor: COLORS.neutral05,\n        overflow: \"hidden\",\n      }}>\n        <div css={{\n          width: `${currentProgress * 100}%`,\n          height: \"100%\",\n          backgroundColor: COLORS.accent5,\n        }}/>\n      </div>\n\n      {/* Percent and time estimation */}\n      <div css={{ display: \"flex\" }}>\n        <div>{roundedPercent}%</div>\n        <div css={{ flex: 1 }} />\n        <div>\n          {prettyTime && <Trans i18nKey=\"steps.finish.upload.time.left\">\n            {{ time: prettyTime }} left\n          </Trans>}\n        </div>\n      </div>\n    </GreyInnerBox>\n  );\n};\n\n/** Shown if the upload was successful. A big checkmark and a text. */\nconst UploadSuccess = () => {\n  const { t } = useTranslation();\n\n  return (\n    <GreyInnerBox>\n      <div css={{ fontWeight: 700 }}>{t(\"steps.finish.upload.complete\")}</div>\n      <div css={{\n        fontSize: 50,\n        margin: 24,\n        lineHeight: 0,\n        color: COLORS.accent5,\n      }}>\n        <LuCircleCheckBig />\n      </div>\n      <div>{t(\"steps.finish.upload.complete-explanation\")}</div>\n    </GreyInnerBox>\n  );\n};\n\nconst GreyInnerBox: React.FC<React.PropsWithChildren> = ({ children }) => (\n  <div css={{\n    backgroundColor: COLORS.neutral10,\n    fontSize: 14,\n    marginTop: 24,\n    padding: 24,\n    borderRadius: 6,\n    textAlign: \"center\",\n  }}>\n    {children}\n  </div>\n);\n","import { useTranslation } from \"react-i18next\";\nimport { LuRotateCw } from \"react-icons/lu\";\nimport { screenWidthAtMost, useColorScheme } from \"@opencast/appkit\";\n\nimport { useDispatch, useStudioState } from \"../../studio-state\";\nimport { StepProps } from \"..\";\nimport { StepContainer } from \"../elements\";\nimport { COLORS, focusStyle } from \"../../util\";\nimport { SaveLocally } from \"./save-locally\";\nimport { UploadBox } from \"./upload\";\nimport { FiXCircle } from \"react-icons/fi\";\nimport { Settings, useSettings } from \"../../settings\";\nimport { SHORTCUTS, useShortcut } from \"../../shortcuts\";\nimport { i18n } from \"i18next\";\n\n\n\n\nexport const Finish: React.FC<StepProps> = ({ goToPrevStep, goToFirstStep }) => {\n  const { t } = useTranslation();\n  const { recordings, upload: uploadState } = useStudioState();\n  const dispatch = useDispatch();\n  const settings = useSettings();\n\n  const allDownloaded = recordings.every(rec => rec.downloaded);\n  const possiblyDone = (uploadState.state === \"uploaded\" || allDownloaded)\n    && uploadState.state !== \"uploading\";\n  const hideBack = uploadState.state !== \"not_uploaded\" || allDownloaded;\n\n  const startAgain = {\n    label: t(\"steps.finish.new-recording\"),\n    icon: <LuRotateCw />,\n    onClick: () => {\n      const doIt = window.confirm(t(\"steps.finish.new-recording-warning\"));\n      if (doIt) {\n        dispatch({ type: \"RESET\" });\n        goToFirstStep();\n      }\n    },\n  };\n  const returnTarget = getReturnTarget(settings);\n  const nextButton = returnTarget\n    ? {\n      label: t(\"steps.finish.finish-button\"),\n      disabled: !possiblyDone,\n      popoverEntries: [\n        startAgain,\n        {\n          label: settings.return?.label\n            ? t(\"steps.finish.return-to\", { label: settings.return.label })\n            : t(\"steps.finish.return-to-no-label\"),\n          href: returnTarget,\n          icon: <FiXCircle />,\n        },\n      ],\n    }\n    : {\n      disabled: !possiblyDone,\n      ...startAgain,\n    };\n\n  useShortcut(SHORTCUTS.finish.startNewRecording, startAgain.onClick, {\n    enabled: possiblyDone,\n  });\n\n  return (\n    <StepContainer\n      title={t(\"steps.finish.label\")}\n      prevButton={hideBack ? undefined : { onClick: goToPrevStep }}\n      nextButton={nextButton}\n    >\n      {/* A spacer to push the boxes a bit further up */}\n      <div css={{ height: \"calc(35%)\" }}/>\n\n      <div css={{\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"start\",\n        gap: 16,\n        [screenWidthAtMost(700)]: {\n          flexDirection: \"column\",\n          alignItems: \"center\",\n        },\n      }}>\n        <Box title={t(\"steps.finish.upload.label\")}>\n          <UploadBox />\n        </Box>\n        <Box title={t(\"steps.finish.save-locally.label\")}>\n          <SaveLocally />\n        </Box>\n      </div>\n\n      {/* A spacer to push the boxes a bit further up */}\n      <div css={{ height: \"calc(65%)\" }}/>\n    </StepContainer>\n  );\n};\n\ntype BoxProps = React.PropsWithChildren<{\n  title: string;\n}>;\n\nconst Box: React.FC<BoxProps> = ({ title, children }) => {\n  const { isHighContrast } = useColorScheme();\n  return (\n    <div css={{\n      maxWidth: 420,\n      width: \"100%\",\n      backgroundColor: COLORS.neutral05,\n      boxShadow: isHighContrast ? \"none\" : \"0 4px 16px var(--shadow-color)\",\n      border: `1px solid ${COLORS.neutral15}`,\n      padding: \"24px 32px\",\n      borderRadius: 6,\n      minHeight: 330, // Make both boxes same height in common use cases\n    }}>\n      <h2 css={{\n        textAlign: \"center\",\n        fontSize: 20,\n        fontWeight: 700,\n        marginBottom: 12,\n      }}>{title}</h2>\n      {children}\n    </div>\n  );\n};\n\n\nconst getReturnTarget = (settings: Settings) => {\n  if (!settings.return?.target) {\n    return null;\n  }\n\n  let targetUrl: URL;\n  try {\n    targetUrl = new URL(settings.return.target, window.location.href);\n  } catch {\n    return null;\n  }\n\n  const allowedDomains = [window.location.hostname, ...(settings.return?.allowedDomains || [])];\n  const allowed = allowedDomains.some(domain => targetUrl.hostname === domain)\n    && (targetUrl.protocol === \"https:\" || targetUrl.protocol === \"http:\");\n\n  if (!allowed) {\n    return null;\n  }\n\n  return settings.return.target;\n};\n\nexport const sharedButtonStyle = (isHighContrast: boolean) => ({\n  display: \"flex\",\n  alignItems: \"center\",\n  padding: \"8px 12px\",\n  gap: 12,\n  borderRadius: 8,\n  textDecoration: \"none\",\n  position: \"relative\",\n  \":not([disabled])\": {\n    color: COLORS.neutral05,\n    cursor: \"pointer\",\n    backgroundColor: COLORS.accent7,\n    \":hover\": {\n      backgroundColor: COLORS.accent8,\n      ...isHighContrast && {\n        backgroundColor: COLORS.neutral15,\n        outline: `2px solid ${COLORS.accent8}`,\n        color: COLORS.neutral20,\n      },\n    },\n  },\n  \"&[disabled]\": {\n    backgroundColor: COLORS.neutral15,\n    color: COLORS.neutral70,\n  },\n  ...focusStyle({ offset: 1 }),\n}) as const;\n\n/**\n * Get file size in human readable format. We use base-1000 XB instead of\n * base-1024 XiB, as the latter would probably confuse some users and many\n * file managers use base-1000 anyway. Notably, the windows file manager\n * calculates with base-1024 but shows \"XB\". So it is lying.\n*/\nexport const prettyFileSize = (numBytes: number, i18n: i18n) => {\n  const round = (n: number) => {\n    const digits = n < 10 ? 1 : 0;\n    return n.toLocaleString(i18n.language, {\n      minimumFractionDigits: digits,\n      maximumFractionDigits: digits,\n    });\n  };\n\n  if (numBytes < 1000) {\n    return `${numBytes} B`;\n  } else if (numBytes < 999_500) {\n    return `${round(numBytes / 1000)} KB`;\n  } else if (numBytes < 999_500_000) {\n    return `${round(numBytes / (1_000_000))} MB`;\n  } else {\n    return `${round(numBytes / (1_000_000_000))} GB`;\n  }\n};\n","import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { match, notNullish, screenWidthAbove, screenWidthAtMost, useColorScheme } from \"@opencast/appkit\";\nimport { FiCircle } from \"react-icons/fi\";\n\nimport StepCurrent from \"../icons/step-current.svg\";\nimport StepDone from \"../icons/step-done.svg\";\nimport { BREAKPOINTS, COLORS } from \"../util\";\nimport { VideoSetup } from \"./video-setup\";\nimport { AudioSetup } from \"./audio-setup\";\nimport { Recording } from \"./recording\";\nimport { Review } from \"./review\";\nimport { Finish } from \"./finish\";\n\n\n\nexport type StepProps = {\n  goToNextStep: () => void;\n  goToPrevStep: () => void;\n  goToFirstStep: () => void;\n};\n\nconst STEPS = [\"video-select\", \"audio-select\", \"recording\", \"review\", \"finish\"] as const;\nexport type Step = typeof STEPS[number];\nconst stepIndex = (step: Step): number => STEPS.indexOf(step);\n\n\ntype Props = {\n  inert: boolean;\n};\n\nexport const Main: React.FC<Props> = ({ inert }) => {\n  const [currentStep, setCurrentStep] = useState<Step>(\"video-select\");\n  const stepProps = {\n    goToNextStep: () => setCurrentStep(notNullish(STEPS[stepIndex(currentStep) + 1])),\n    goToPrevStep: () => setCurrentStep(notNullish(STEPS[stepIndex(currentStep) - 1])),\n    goToFirstStep: () => setCurrentStep(\"video-select\"),\n  };\n\n  return (\n    <main {...{ inert: inert ? \"\" : null }} css={{\n      display: \"flex\",\n      flex: 1,\n      backgroundColor: COLORS.neutral10,\n      [screenWidthAtMost(BREAKPOINTS.large)]: {\n        flexDirection: \"column-reverse\",\n      },\n    }}>\n      <ProgressSidebar currentStep={currentStep} />\n      {match(currentStep, {\n        \"video-select\": () => <VideoSetup {...stepProps} />,\n        \"audio-select\": () => <AudioSetup {...stepProps} />,\n        \"recording\": () => <Recording {...stepProps} />,\n        \"review\": () => <Review {...stepProps} />,\n        \"finish\": () => <Finish {...stepProps} />,\n      })}\n    </main>\n  );\n};\n\n\ntype ProgressSidebarProps = {\n  currentStep: Step;\n};\n\n/**\n * The element that shows the progress through the five steps. Shown left on\n * desktop, at the bottom on mobile.\n */\nconst ProgressSidebar: React.FC<ProgressSidebarProps> = ({ currentStep }) => {\n  const { t } = useTranslation();\n  const { isHighContrast } = useColorScheme();\n\n  const currentIndex = stepIndex(currentStep);\n  const labels = [\n    t(\"steps.video.label\"),\n    t(\"steps.audio.label\"),\n    t(\"steps.record.label\"),\n    t(\"steps.review.label\"),\n    t(\"steps.finish.label\"),\n  ];\n\n  const VERTICAL_MARGIN = \"calc(8px + max(0px, 20% - 44px))\";\n  const CIRCLE_RADIUS = 13;\n  return (\n    <div css={{\n      position: \"relative\",\n      flexShrink: \"0\",\n      backgroundColor: COLORS.neutral05,\n      ...isHighContrast && {\n        borderRight: `1px solid ${COLORS.neutral90}`,\n      },\n      [screenWidthAbove(BREAKPOINTS.large)]: {\n        width: 160,\n        minWidth: 160,\n      },\n      [screenWidthAtMost(BREAKPOINTS.large)]: {\n        height: 42,\n      },\n    }}>\n      <div css={{\n        position: \"absolute\",\n        display: \"flex\",\n        justifyContent: \"space-between\",\n        [screenWidthAbove(BREAKPOINTS.large)]: {\n          flexDirection: \"column\",\n          left: 8,\n          top: VERTICAL_MARGIN,\n          bottom: VERTICAL_MARGIN,\n        },\n        [screenWidthAtMost(BREAKPOINTS.large)]: {\n          flexDirection: \"row\",\n          top: 8,\n          left: VERTICAL_MARGIN,\n          right: VERTICAL_MARGIN,\n        },\n      }}>\n        {labels.map((label, i) => {\n          let icon: JSX.Element;\n          if (i < currentIndex) {\n            icon = <StepDone />;\n          } else if (i === currentIndex) {\n            icon = <StepCurrent />;\n          } else {\n            icon = <FiCircle />;\n          }\n\n          return (\n            <div key={i} css={{\n              display: \"flex\",\n              gap: 12,\n              alignItems: \"center\",\n              zIndex: 100,\n              backgroundColor: COLORS.neutral05,\n              svg: {\n                color: i === currentIndex ? COLORS.accent6 : COLORS.neutral40,\n                fontSize: 2 * CIRCLE_RADIUS,\n                flexShrink: 0,\n                // We want an effective stroke width of 2. If we scale the icon\n                // via `size`, the internal stroke width (of 2) gets scaled as\n                // well. So we override it by applying the inverse scaling. The\n                // intrinsic size of the SVG is 24.\n                strokeWidth: 2 * 24 / (2 * CIRCLE_RADIUS),\n                [screenWidthAbove(BREAKPOINTS.large)]: {\n                  margin: \"4px 0\",\n                },\n                [screenWidthAtMost(BREAKPOINTS.large)]: {\n                  margin: \"0 4px\",\n                },\n              },\n            }}>\n              {icon}\n              <div css={{\n                fontSize: 14,\n                lineHeight: 1.2,\n                color: i == currentIndex ? COLORS.accent8 : COLORS.neutral70,\n                [screenWidthAtMost(BREAKPOINTS.large)]: {\n                  display: \"none\",\n                },\n              }}>{label}</div>\n            </div>\n          );\n        })}\n\n        {/* Line connecting all steps */}\n        <div css={{\n          position: \"absolute\",\n          border: `1px solid ${COLORS.neutral40}`,\n          [screenWidthAbove(BREAKPOINTS.large)]: {\n            top: CIRCLE_RADIUS,\n            bottom: CIRCLE_RADIUS,\n            left: CIRCLE_RADIUS - 1, // Border is 2px wide and we want to center that\n          },\n          [screenWidthAtMost(BREAKPOINTS.large)]: {\n            left: CIRCLE_RADIUS,\n            right: CIRCLE_RADIUS,\n            top: CIRCLE_RADIUS - 1, // Border is 2px wide and we want to center that\n          },\n        }} />\n      </div>\n    </div>\n  );\n};\n","var _rect, _path;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nconst SvgKeyboard = props => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: \"1em\",\n  height: \"1em\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\",\n  strokeWidth: 2,\n  viewBox: \"0 0 24 24\"\n}, props), _rect || (_rect = /*#__PURE__*/React.createElement(\"rect\", {\n  width: 22,\n  height: 14,\n  x: 1,\n  y: 5,\n  rx: 1,\n  ry: 1\n})), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M6 9h.001M10 9zM14 9zM18 9h.001M8 12zM12 12zM16 12h.001M6 15h12\"\n})));\nexport default SvgKeyboard;","const languages = [\n  { short: \"en\", long: \"English\", rtl: false },\n  { short: \"de\", long: \"Deutsch\", rtl: false },\n  { short: \"nl\", long: \"Nederlands\", rtl: false },\n  { short: \"es\", long: \"Español\", rtl: false },\n  { short: \"fa\", long: \"فارسی\", rtl: true },\n  { short: \"fr\", long: \"Français\", rtl: false },\n  { short: \"sl\", long: \"Slovenščina\", rtl: false },\n  { short: \"zh\", long: \"简体中文\", rtl: false },\n  { short: \"ca\", long: \"Català\", rtl: false },\n  { short: \"it\", long: \"Italiano\", rtl: false },\n];\n\nexport default languages;\n","import { HiOutlineTranslate } from \"react-icons/hi\";\nimport { FiInfo, FiMoon } from \"react-icons/fi\";\nimport {\n  HeaderMenuItemProps, useColorScheme, WithHeaderMenu, checkboxMenuItem, ProtoButton,\n  screenWidthAtMost, match,\n} from \"@opencast/appkit\";\nimport { useTranslation } from \"react-i18next\";\nimport React, { forwardRef } from \"react\";\n\nimport { DEFINES } from \"../defines\";\nimport KeyboardIcon from \"../icons/keyboard.svg\";\nimport languages from \"../i18n/languages\";\nimport { BREAKPOINTS, COLORS, focusStyle } from \"../util\";\nimport { OverlayBoxState } from \".\";\nimport { SHORTCUTS, ShortcutKeys, useShortcut, useShowAvailableShortcuts } from \"../shortcuts\";\n\n\ntype Props = {\n  setOverlayBoxState: (state: OverlayBoxState) => void;\n  inert: boolean;\n};\n\nexport const Header: React.FC<Props> = ({ setOverlayBoxState, inert }) => {\n  const { scheme, isHighContrast } = useColorScheme();\n\n  return (\n    <header {...{ inert: inert ? \"\" : null }} css={{\n      backgroundColor: match(scheme, {\n        \"light\": () => COLORS.neutral60,\n        \"dark\": () => COLORS.neutral20,\n        \"dark-high-contrast\": () => \"black\",\n        \"light-high-contrast\": () => \"black\",\n      }),\n      color: isHighContrast ? \"white\" : \"inherit\",\n      height: \"var(--header-height)\",\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      ...scheme === \"dark-high-contrast\"\n        ? { borderBottom: \"1px solid white\" }\n        : { paddingBottom: 1 },\n    }}>\n      <Logo />\n      <Buttons {...{ setOverlayBoxState }}/>\n    </header>\n  );\n};\n\nconst Logo: React.FC = () => {\n  const path = (filename: string) => DEFINES.publicPath + filename;\n\n  return (\n    <picture css={{\n      height: \"100%\",\n      display: \"flex\",\n      opacity: useColorScheme().scheme === \"dark\" ? 0.8 : 1.0,\n      paddingLeft: 8,\n      alignItems: \"center\",\n      \"> *\": {\n        height: \"calc(100% - 12px)\",\n      },\n      [screenWidthAtMost(410)]: {\n        paddingLeft: 0,\n      },\n    }}>\n      <source media=\"(min-width: 920px)\" srcSet={path(\"logo-wide.svg\")} />\n      <img src={path(\"logo-narrow.svg\")} alt=\"Opencast Studio Logo\" />\n    </picture>\n  );\n};\n\nconst Buttons: React.FC<Pick<Props, \"setOverlayBoxState\">> = ({ setOverlayBoxState }) => {\n  return (\n    <div css={{\n      display: \"flex\",\n      gap: 16,\n      height: \"100%\",\n      alignItems: \"center\",\n      paddingRight: 24,\n      [screenWidthAtMost(410)]: {\n        gap: 2,\n        paddingRight: 8,\n      },\n    }}>\n      <LanguageButton />\n      <ThemeButton />\n      <ShortCutsButton open={() => setOverlayBoxState(\"shortcuts\")} />\n      <InfoButton open={() => setOverlayBoxState(\"info\")} />\n    </div>\n  );\n};\n\nconst LanguageButton: React.FC = () => {\n  const { t, i18n } = useTranslation();\n  const isCurrentLanguage = (language: string) => language === i18n.resolvedLanguage;\n\n  const menuItems = Object.values(languages).map(lng => checkboxMenuItem({\n    checked: isCurrentLanguage(lng.short),\n    children: <>{lng.long}</>,\n    onClick: () => {\n      if (!isCurrentLanguage(lng.short)) {\n        i18n.changeLanguage(lng.short);\n      }\n    },\n  }));\n\n  const label = t(\"header.language.label\");\n  return (\n    <WithHeaderMenu\n      menu={{\n        label,\n        items: menuItems,\n        breakpoint: BREAKPOINTS.small,\n      }}\n    >\n      <HeaderButton icon={<HiOutlineTranslate />} label={label} />\n    </WithHeaderMenu>\n  );\n};\n\nconst ThemeButton: React.FC = () => {\n  const { t } = useTranslation();\n  const { scheme, isAuto, update } = useColorScheme();\n\n  const currentPref = isAuto ? \"auto\" : scheme;\n  const choices = [\"auto\", \"light\", \"dark\", \"light-high-contrast\", \"dark-high-contrast\"] as const;\n  const menuItems: HeaderMenuItemProps[] = choices.map(choice => checkboxMenuItem({\n    checked: currentPref === choice,\n    children: <>{t(`header.theme.${choice}`)}</>,\n    onClick: () => update(choice),\n  }));\n\n  return (\n    <WithHeaderMenu\n      menu={{\n        label: t(\"header.theme.label\"),\n        items: menuItems,\n        breakpoint: BREAKPOINTS.small,\n      }}\n    >\n      <HeaderButton icon={<FiMoon />} label={t(\"header.theme.label\")} />\n    </WithHeaderMenu>\n  );\n};\n\ntype BoxOpenButtonProps = {\n  open: () => void;\n};\n\nconst InfoButton: React.FC<BoxOpenButtonProps> = ({ open }) => {\n  const { t } = useTranslation();\n  return (\n    <HeaderButton onClick={open} icon={<FiInfo />} label={t(\"header.info.label\")} />\n  );\n};\n\nconst ShortCutsButton: React.FC<BoxOpenButtonProps> = ({ open }) => {\n  const { t } = useTranslation();\n  useShortcut(SHORTCUTS.general.showOverview, open, { useKey: true });\n  const showShortcut = useShowAvailableShortcuts();\n  return (\n    <HeaderButton onClick={open} icon={<KeyboardIcon />} label={t(\"shortcuts.label\")}>\n      {showShortcut && (\n        <div css={{\n          position: \"absolute\",\n          bottom: -20,\n          left: 20,\n          padding: 2,\n          borderRadius: 4,\n          backgroundColor: COLORS.neutral05,\n        }}><ShortcutKeys shortcut={SHORTCUTS.general.showOverview} /></div>\n      )}\n    </HeaderButton>\n  );\n};\n\ntype HeaderButtonProps = JSX.IntrinsicElements[\"button\"] & {\n  icon: JSX.Element;\n  label: string;\n};\n\nconst BUTTON_LABEL_BREAKPOINT = 770;\n\nconst HeaderButton = forwardRef<HTMLButtonElement, HeaderButtonProps>(\n  ({ icon, label, children, ...rest }, ref) => {\n    const { scheme, isHighContrast } = useColorScheme();\n\n    return (\n      <ProtoButton {...rest} ref={ref} css={{\n        position: \"relative\",\n        display: \"flex\",\n        gap: 8,\n        alignItems: \"center\",\n\n        fontSize: 16,\n        fontFamily: \"inherit\",\n        fontWeight: 500,\n        color: match(scheme, {\n          \"light\": () => COLORS.neutral05,\n          \"dark\": () => COLORS.neutral90,\n          \"dark-high-contrast\": () => \"white\",\n          \"light-high-contrast\": () => \"white\",\n        }),\n        borderRadius: 6,\n        padding: \"6px 8px\",\n\n        \":hover, :active\": {\n          outline: `2px solid ${isHighContrast ? \"#aaa\" : COLORS.neutral50}`,\n          backgroundColor: match(scheme, {\n            \"light\": () => COLORS.neutral70,\n            \"dark\": () => COLORS.neutral10,\n            \"dark-high-contrast\": () => \"none\",\n            \"light-high-contrast\": () => \"none\",\n          }),\n        },\n        ...focusStyle({}, match(scheme, {\n          \"light\": () => COLORS.neutral10,\n          \"dark\": () => COLORS.accent8,\n          \"dark-high-contrast\": () => \"#aaa\",\n          \"light-high-contrast\": () => \"#aaa\",\n        })),\n\n        \"> svg\": {\n          fontSize: 22,\n          [`@media (max-width: ${BUTTON_LABEL_BREAKPOINT}px)`]: {\n            fontSize: 26,\n          },\n        },\n      }}>\n        {icon}\n        <span css={{\n          [`@media (max-width: ${BUTTON_LABEL_BREAKPOINT}px)`]: {\n            display: \"none\",\n          },\n        }}>{label}</span>\n        {children}\n      </ProtoButton>\n    );\n  },\n);\n","import React from \"react\";\n\nimport { DEFINES } from \"./defines\";\nimport { COLORS } from \"./util\";\nimport { OverlayBox } from \"./layout\";\n\n\ntype Props = {\n  close: () => void;\n};\n\nexport const About: React.FC<Props> = ({ close }) => (\n  <OverlayBox maxWidth={800} close={close} title=\"Opencast Studio\">\n    <article css={{\n      p: {\n        margin: \"8px 0\",\n      },\n      h2: {\n        marginTop: 24,\n        marginBottom: 4,\n        fontSize: 21,\n      },\n      a: {\n        color: COLORS.accent7,\n        \"&:hover\": {\n          textDecoration: \"none\",\n          color: COLORS.accent8,\n        },\n      },\n    }}>\n      <p>\n        A web-based recording studio for <a href=\"https://opencast.org\">Opencast</a>.\n      </p>\n      <p>\n        Opencast Studio allows you to record your camera, your display and your microphoneʼs audio.\n        You can then either download your recordings or upload them directly to an Opencast\n        instance (usually the one of your university).\n      </p>\n      <p>\n        This is free software under the terms of the{\" \"}\n        <a href=\"https://github.com/opencast/studio/blob/main/LICENSE\">\n          MIT License\n        </a>{\" \"}\n        developed by <a href=\"https://elan-ev.de\">elan e.V.</a> in cooperation\n        with the <a href=\"https://ethz.ch\">ETH Zürich</a>.\n      </p>\n\n      <h2>How it works</h2>\n      <p>\n        Opencast Studio uses the recording capabilities built into modern browsers to record\n        audio and video streams. The recording happens in the userʼs browser and no server is\n        involved in the recording.\n      </p>\n\n      <h2>Support</h2>\n      <p>\n        If you are experiencing any difficulties or found any bugs,\n        please take a look at the{\" \"}\n        <a href=\"https://github.com/opencast/studio/issues\">\n          issue tracker on GitHub\n        </a>.\n        Before filing a new issue, please check if one about your topic already exists.\n        We regularly check incoming issues and do our best to address bugs in a timely manner.\n      </p>\n\n      <h2>Credits</h2>\n      <p>\n        Thanks to the following people and institutions for contributing to this project:\n      </p>\n      <ul>\n        <li>\n          <a href=\"https://github.com/slampunk\">Duncan Smith</a> for starting this\n          project\n        </li>\n        <li>\n          <a href=\"https://github.com/cilt-uct\">University of Cape Town (CILT)</a>\n          {\" \"}for letting Duncan start the project\n        </li>\n        <li>\n          <a href=\"https://ethz.ch\">ETH Zürich</a> for financial support and\n          testing\n        </li>\n        <li>\n          <a href=\"https://github.com/elan-ev\">elan e.V.</a> for the re-implementation\n          and the ongoing development\n        </li>\n        <li>\n          And many members from the Opencast community who helped along the way.\n        </li>\n      </ul>\n\n      <h2>Version</h2>\n      <p>\n        Build date {DEFINES.buildDate ?? \"?\"},\n        commit{\" \"}\n        <a\n          aria-label=\"Git commit on GitHub\"\n          href={\"https://github.com/opencast/studio/commit/\" + DEFINES.commitSha}\n        >\n          {DEFINES.commitSha ?? \"?\"}\n        </a>.\n      </p>\n    </article>\n  </OverlayBox>\n);\n","import React, { useRef, useState } from \"react\";\nimport { match, screenWidthAtMost, useColorScheme, useOnOutsideClick } from \"@opencast/appkit\";\nimport { FiX } from \"react-icons/fi\";\n\nimport { Main } from \"../steps\";\nimport { Header } from \"./header\";\nimport { COLORS } from \"../util\";\nimport { About } from \"../about\";\nimport { SHORTCUTS, ShortcutOverview, useShortcut } from \"../shortcuts\";\n\n\nexport type OverlayBoxState = \"none\" | \"info\" | \"shortcuts\";\n\nexport const Root: React.FC = () => {\n  const [overlayBoxState, setOverlayBoxState] = useState<OverlayBoxState>(\"none\");\n  const close = () => setOverlayBoxState(\"none\");\n  useShortcut(SHORTCUTS.general.closeOverlay, close);\n  const inert = overlayBoxState !== \"none\";\n\n  return (\n    <div css={{\n      \"--header-height\": \"64px\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      height: \"100%\",\n      ...overlayBoxState !== \"none\" && { overflowY: \"hidden\" },\n    }}>\n      <Header inert={inert} {...{ setOverlayBoxState }} />\n      {match(overlayBoxState, {\n        \"none\": () => null,\n        \"info\": () => <About close={close} />,\n        \"shortcuts\": () => <ShortcutOverview close={close} />,\n      })}\n      <Main inert={inert} />\n    </div>\n  );\n};\n\n\ntype OverlayBoxProps = React.PropsWithChildren<{\n  close: () => void;\n  title: string;\n  maxWidth: number;\n}>;\n\nexport const OverlayBox: React.FC<OverlayBoxProps> = ({ close, title, children, maxWidth }) => {\n  const isLight = useColorScheme().scheme === \"light\";\n  const { isHighContrast } = useColorScheme();\n  const ref = useRef<HTMLDivElement>(null);\n  useOnOutsideClick(ref, close);\n  const bg = (isLight || isHighContrast) ? COLORS.neutral05 : COLORS.neutral15;\n\n  return (\n    <div role=\"dialog\" aria-modal=\"true\" css={{\n      position: \"absolute\",\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      padding: \"32px 8px\",\n      zIndex: 800,\n      backgroundColor: \"rgba(0, 0, 0, 0.3)\",\n      backdropFilter: \"blur(8px)\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      alignItems: \"center\",\n      \"@media (min-height: 400px)\": {\n        paddingTop: \"calc(var(--header-height) + 32px)\",\n      },\n    }}>\n      <div ref={ref} css={{\n        position: \"relative\",\n        backgroundColor: bg,\n        borderRadius: 8,\n        padding: \"24px 24px 32px 48px\",\n        width: \"82%\",\n        flex: \"0 1 auto\",\n        minHeight: 0,\n        maxWidth,\n        display: \"flex\",\n        flexDirection: \"column\",\n        boxShadow: isHighContrast ? \"none\" : \"0 4px 16px var(--shadow-color))\",\n        outline: isHighContrast ? \"2px solid var(--color-neutral90)\" : \"none\",\n        [screenWidthAtMost(850)]: {\n          padding: 24,\n          paddingLeft: 32,\n        },\n        [screenWidthAtMost(480)]: {\n          width: \"95%\",\n          padding: \"12px 20px\",\n        },\n      }}>\n        <FiX\n          onClick={close}\n          css={{\n            position: \"absolute\",\n            top: 8,\n            right: 8,\n            backgroundColor: bg,\n            borderRadius: \"50%\",\n            fontSize: 40,\n            padding: 4,\n            cursor: \"pointer\",\n          }}\n        />\n        <h1 css={{\n          marginBottom: 8,\n          fontSize: 26,\n        }}>{title}</h1>\n        <div css={{ paddingRight: 16, overflowY: \"auto\" }}>\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n};\n","import { Global, css } from \"@emotion/react\";\n\n// There are also very few global styles in `index.html` as those are needed for\n// the loading indicator already.\nexport const GlobalStyle: React.FC = () => <>\n  <Global styles={CSS_RESETS} />\n  <Global styles={GLOBAL_STYLE} />\n</>;\n\n\n/** This is just styling for Tobira that we want to apply globally. */\nconst GLOBAL_STYLE = css({\n  \":root\": {\n    \"--min-page-width\": \"320px\",\n  },\n  body: {\n    // // Accent color for generated UI control `<input>` elements\n    // // where type=\"checkbox\", \"radio\" or \"range\",\n    // // as well as `<progress>` elements.\n    // accentColor: COLORS.primary0,\n\n    fontFamily: \"'Roboto Flex Variable', 'Vazirmatn Variable', sans-serif\",\n    fontWeight: 400,\n\n    // A reset to a sensible value.\n    lineHeight: 1.5,\n\n    // 16px is a good default body text size according to the internet (TM).\n    fontSize: 16,\n\n    // From a set of popular phones, the iPhone 5 has the smallest viewport\n    // width: 320px. It does make sense to set a minimum width early on in\n    // order to know where we can stop caring.\n    minWidth: \"var(--min-page-width)\",\n  },\n  // a: {\n  //     color: COLORS.primary0,\n  //     \"&:hover, &:focus\": {\n  //         textDecoration: \"none\",\n  //         color: COLORS.primary1,\n  //     },\n  //     \":focus-visible\": { outline: `2.5px solid ${COLORS.focus}` },\n  // },\n});\n\n/**\n * The following is a minimal set of CSS reset rules in order to get rid of\n * browser dependent, inconsistent or unexpected behavior. Parts of this\n * are taken from here: https://github.com/hankchizljaw/modern-css-reset\n * Licensed as MIT, Andy Bell and other contributors\n */\nconst CSS_RESETS = css({\n  // Everything should have box-sizing border-box by default as it's more\n  // intuitive and expected.\n  \"*, *::before, *::after\": {\n    boxSizing: \"border-box\",\n  },\n\n  // Remove default margins of the most important elements.\n  \"body, h1, h2, h3, h4, p, li, figure, figcaption, blockquote, dl, dd, pre\": {\n    margin: 0,\n  },\n\n  \"html, body, body > #root\": {\n    height: \"100%\",\n  },\n\n  // This improves the readability of underlines in links.\n  a: {\n    textDecorationSkipInk: \"auto\",\n  },\n\n  // Some elements not inhereting fonts is a really confusing browser default.\n  \"input, button, textarea, select\": {\n    font: \"inherit\",\n    margin: 0,\n  },\n});\n","import { ColorSchemeProvider } from \"@opencast/appkit\";\nimport { useBeforeunload } from \"react-beforeunload\";\n\nimport { Root } from \"./layout\";\nimport { GlobalStyle } from \"./ui/global-style\";\nimport { useStudioState } from \"./studio-state\";\n\n\n\nexport const App: React.FC = () => {\n  return <>\n    <GlobalStyle />\n    <PreventClose />\n    <ColorSchemeProvider>\n      <Root />\n    </ColorSchemeProvider>\n  </>;\n};\n\n/** Prevent closing the tab if recordings exists and they have not been saved. */\nconst PreventClose = () => {\n  const { recordings, upload } = useStudioState();\n  const downloaded = recordings.every(rec => rec.downloaded);\n  const uploaded = upload.state === \"uploaded\";\n  const uploading = upload.state === \"uploading\";\n\n  useBeforeunload(event => {\n    if ((recordings?.length > 0 && !uploaded && !downloaded) || uploading) {\n      event.preventDefault();\n    }\n  });\n\n  return null;\n};\n"],"names":["_circle","_circle2","_extends","Object","assign","bind","n","e","arguments","length","t","r","hasOwnProperty","call","apply","_path","props","xmlns","width","height","fill","stroke","strokeLinecap","strokeLinejoin","strokeWidth","className","viewBox","cx","cy","d","mergeHeightConstraint","maxHeight","videoConstraints","fallbackIdeal","maxField","max","ideal","Math","min","async","startAudioCapture","dispatch","deviceId","stream","navigator","mediaDevices","getUserMedia","audio","video","getTracks","forEach","track","onended","type","err","console","error","startDisplayCapture","settings","maxFps","display","frameRate","constraints","cursor","getDisplayMedia","startUserCapture","camera","facingMode","stopAudioCapture","stop","stopDisplayCapture","stopUserCapture","VideoBoxResizeContext","React","useVideoBoxResize","usePresentContext","VideoBox","gap","minWidth","minHeight","children","ref","useResizeObserver","setForceCounter","useState","lastDimensions","useRef","map","updateLastDimensions","newDimensions","dimension","i","current","dimensions","c","resizeVideoBox","equal","v","ar","child","aspectRatio","childWidth","childHeight","_jsx","Provider","value","css","_css","flex","autoSize","margin","body","aspectRatios","rowWidths","rowHeights","availableWidth","combinedAspectRatio","Array","baseHeight","colWidths","colHeights","availableHeight","_c","widths","heights","flexDirection","_jsxs","justifyContent","bug","_ref","name","styles","_ref2","_ref3","ErrorBox","title","extraBody","rest","padding","borderRadius","backgroundColor","COLORS","danger1","color","danger5","Select","position","paddingRight","border","neutral25","appearance","background","useColorScheme","scheme","backgroundSize","backgroundPosition","option","neutral05","neutral90","focusStyle","offset","prefsToConstraints","prefs","exactDevice","parseAspectRatio","undefined","quality","parseQuality","ASPECT_RATIOS","label","test","parseInt","LAST_VIDEO_DEVICE_KEY","CAMERA_ASPECT_RATIO_KEY","CAMERA_QUALITY_KEY","DISPLAY_QUALITY_KEY","loadCameraPrefs","window","localStorage","getItem","loadDisplayPrefs","StreamSettings","isDesktop","useDispatch","useSettings","floatRef","useTranslation","isLight","isHighContrast","updatePrefs","newPrefs","merged","setOpt","key","setItem","useEffect","cameraDeviceId","deviceIdOf","isExpanded","setIsExpanded","_Fragment","top","left","right","textAlign","neutral70","boxShadow","streamInfo","FloatingContainer","placement","ariaRole","open","onClose","viewPortMargin","FloatingTrigger","WithTooltip","tooltip","ProtoButton","onClick","old","OVERLAY_STYLE","fontSize","transition","transform","FiX","FiSettings","Floating","borderWidth","shadowBlur","gridTemplateColumns","gridGap","paddingLeft","screenWidthAtMost","columnGap","rowGap","UserSettings","UniveralSettings","neutral15","marginTop","lineHeight","Trans","i18nKey","s","getVideoTracks","getSettings","sizeInfo","fpsInfo","join","PrefKey","PrefValue","changeQuality","qualities","out","filter","q","push","qualityOptions","kind","RadioButton","id","onChange","checked","every","_ref4","state","useStudioState","currentDeviceId","userStream","devices","getUniqueDevices","changeAspectRatio","ratio","htmlFor","changeDevice","target","x","fontWeight","neutral10","borderColor","neutral40","outline","accent4","accent6","tabIndex","onKeyDown","SourcePreview","inputs","match","StreamPreview","input","dimensionsOf","inputHasError","unreachable","allowed","unexpectedEnd","PreviewVideo","DisplayAudioInfo","_ref5","_ref6","videoRef","srcObject","addEventListener","removeEventListener","inner","Spinner","size","neutral60","autoPlay","muted","playsInline","_ref7","hasAudio","getAudioTracks","LuInfo","LuVolume2","LuVolumeX","backdropFilter","outlineOffset","onMac","userAgent","includes","SHORTCUTS","general","showAvailableShortcuts","showOverview","closeOverlay","tab","prev","next","videoSetup","selectScreen","selectBoth","selectUser","audioSetup","withAudio","withoutAudio","recording","startPauseResume","review","playPause","forwards5secs","backwards5secs","forwardsFrame","backwardsFrame","cutLeft","cutRight","removeCutLeft","removeCutRight","finish","startNewRecording","download","SHORTCUT_TRANSLATIONS","KEY_TRANSLATIONS","useShortcut","keys","callback","options","deps","useHotkeys","delimiter","useShowAvailableShortcuts","active","setActive","enable","event","split","some","trim","toLowerCase","disable","document","ShortcutKeys","shortcut","large","alignItems","FiArrowLeft","FiArrowRight","Mod","FiCommand","Alt","LuOption","Shift","LuArrowBigUp","SingleKey","monofont","bg","light","dark","light-high-contrast","dark-high-contrast","neutral50","neutral80","fontFamily","ShortcutOverview","close","OverlayBox","maxWidth","entries","groupId","group","ShortcutGroupOverview","GROUP_ID_TRANSLATIONS","combination","StepButton","icon","disabled","danger","popoverEntries","showShortcut","isDark","setOpen","click","enabled","button","danger4","danger0","flexShrink","FiChevronLeft","FiChevronRight","arrowSize","distance","entry","style","textDecoration","inset","borderTop","neutral30","role","href","preventDefault","location","StepContainer","note","nextButton","prevButton","SourceOptionButton","disabledText","ariaLabel","accent7","neutral20","accent8","marginBottom","SourceSelection","setActiveSource","userConstraints","displayConstraints","displaySupported","userSupported","clickUser","queryMediaDevices","clickDisplay","clickBoth","onSafari","Promise","all","showShortcuts","BREAKPOINTS","medium","onMobileDevice","FiMonitor","svg","FiUser","hasWebcam","VideoSetup","goToNextStep","displayStream","videoChoice","activeSource","hasStreams","choice","userInput","userAllowed","userUnexpectedEnd","displayInput","displayAllowed","displayUnexpectedEnd","buttons","reselectSource","someProblem","none","Warnings","user","showButtons","both","warnings","protocol","hostname","isRecordingSupported","msg","selectNoAudio","selectMicrophone","FiMic","FiMicOff","MicrophonePreview","audioStream","audioAllowed","audioUnexpectedEnd","LAST_AUDIO_DEVICE_KEY","selectId","useId","AudioVisualziation","marginRight","exact","canvasRef","canvas","ctx","getContext","Error","lineWidth","strokeStyle","source","AudioContext","createMediaStreamSource","scope","Oscilloscope","fftSize","animate","AudioSetup","goToPrevStep","audioChoice","microphone","RecordingControls","recordingState","startRecording","pauseRecording","resumeRecording","fgColor","inactive","paused","ignoreEventWhen","code","HTMLButtonElement","FiPlay","FiPause","bottom","Timer","isRecording","formatted","setFormatted","millisPassed","lastTick","Date","counterId","setInterval","tick","newInstant","valueOf","ms","segments","floor","slice","unit","clearInterval","Recorder","onStop","constructor","mimeType","MediaRecorder","mimes","find","mime","isTypeSupported","debug","this","videoBitsPerSecond","videoBitrate","ondataavailable","onstop","#reset","data","log","mainMimeType","media","fixWebmDuration","Blob","url","URL","createObjectURL","start","pause","resume","addRecordOnStop","deviceType","mixAudioIntoVideo","audioStreams","videoStream","reduce","MediaStream","audioContext","accumulatedAudio","currentAudio","resultAudio","createMediaStreamDestination","connect","Recording","recordingDispatch","opencast","useOpencast","setRecordingState","desktopRecorder","videoRecorder","canRecord","stopRecording","premature","refreshConnection","stopCapture","previews","useBeforeunload","play","overflow","PauseOverlay","textShadow","animation","keyframes","opacity","FiPauseCircle","_g","ControlBox","previewController","currentTime","i18n","duration","Controls","formatTime","language","Scrubber","seconds","totalDuration","lang","secondsPart","minutesPart","hoursPart","secondsFormatted","toLocaleString","minimumFractionDigits","maximumFractionDigits","lowerPart","Infinity","end","cutStyle","boxSizing","danger2","mouseEvent","rect","currentTarget","getBoundingClientRect","progress","clientX","setTime","zIndex","Draggable","scrubberRef","initialTime","onDrag","time","notNullish","borderRight","borderLeft","disableCutting","clamp","CutMarker","side","CutMarkerIcon","initialPos","pos","scrubberRect","isDragging","onMouseUp","onMouseMove","onMove","pageX","percentage","onTouchMove","touches","onMouseDown","onTouchStart","userSelect","togglePlayPause","controller","isPlaying","isReadyToPlay","CutControls","marker","control","invariant","accent5","ALMOST_ZERO","cut","timestamp","cutButton","paddingTop","CutHereIcon","Preview","forwardRef","onTimeUpdate","onReady","onPausePlay","recordings","videoRefs","allVideos","queuedSeek","newTime","seeking","useImperativeHandle","ended","readyState","isInCutRegion","overlayVisible","setOverlayVisible","jumpInTime","diff","useKey","index","CutOutIcon","src","onLoadedData","onSeeked","isOtherSeeking","queued","preload","Review","goToFirstStep","prematureRecordingEnd","emptyRecording","rec","setCurrentTime","previewReady","setPreviewReady","_isPaused","setIsPaused","expectedRecordings","FiTrash","confirm","SaveLocally","SaveLocallySingle","idx","presenter","downloaded","blob","flavor","downloadName","recordingFileName","LuCircleCheckBig","rel","sharedButtonStyle","FiDownload","prettyFileSize","LAST_PRESENTER_KEY","progressHistory","UploadBox","upload","uploadState","onProgress","now","windowStart","findIndex","p","splice","secondsLeft","windowLength","progressPerSecond","progressLeft","round","currentProgress","interval","lastProgress","handleUpload","result","Boolean","series","uploadSettings","startTime","recordingStartTime","endTime","recordingEndTime","dispatchError","success","network_error","not_authorized","unexpected_response","unknown_error","UploadProgress","UploadSuccess","UploadForm","titleField","presenterField","seriesField","autofillPresenter","settingsManager","useSettingsManager","presenterValue","getUsername","setState","formState","errors","handleSubmit","register","getValues","useForm","defaultValues","formValues","field","seriesSelect","useController","rules","required","handleInputChange","configurableServerUrl","isConfigurable","configurableUsername","isUsernameConfigurable","configurablePassword","isPasswordConfigurable","showOpencastSection","ocDataFromInputs","serverUrl","loginName","loginPassword","totalBytes","acc","uploadSize","onConnectionSettingChange","ocSettings","ocData","oc","Opencast","init","getState","setGlobalInstance","saveSettings","onSubmit","ocState","incorrect_login","isLoginProvided","invalid_response","response_not_ok","Input","autoComplete","defaultValue","autoFocus","SeriesSelect","formProps","onBlur","validate","startsWith","idle","FiUpload","testing","neutral00","ErrorContainer","message","seriesId","setOptions","getSeries","then","sort","a","b","localeCompare","sensitivity","get","defaultOption","setValue","inputId","errorId","isLoading","isDisabled","isClearable","isSearchable","placeholder","loadingMessage","noOptionsMessage","selectStyles","endsWith","theme","colors","primary","focus","neutral0","neutral5","baseStyles","isFocused","singleValue","menuList","menu","_baseStyles","isSelected","_ref8","_ref9","_ref0","roundedPercent","prettyTime","GreyInnerBox","_ref1","Finish","allDownloaded","possiblyDone","hideBack","startAgain","LuRotateCw","returnTarget","getReturnTarget","return","FiXCircle","Box","targetUrl","allowedDomains","domain","numBytes","digits","STEPS","stepIndex","step","indexOf","Main","inert","currentStep","setCurrentStep","stepProps","ProgressSidebar","video-select","audio-select","currentIndex","labels","VERTICAL_MARGIN","screenWidthAbove","StepDone","StepCurrent","FiCircle","CIRCLE_RADIUS","_rect","y","rx","ry","short","long","rtl","Header","setOverlayBoxState","borderBottom","paddingBottom","Logo","Buttons","path","filename","DEFINES","publicPath","srcSet","alt","LanguageButton","ThemeButton","ShortCutsButton","InfoButton","isCurrentLanguage","resolvedLanguage","menuItems","values","languages","lng","checkboxMenuItem","changeLanguage","WithHeaderMenu","items","breakpoint","small","HeaderButton","HiOutlineTranslate","isAuto","update","currentPref","FiMoon","FiInfo","KeyboardIcon","About","h2","buildDate","commitSha","Root","overlayBoxState","overflowY","info","shortcuts","useOnOutsideClick","GlobalStyle","Global","CSS_RESETS","GLOBAL_STYLE","App","PreventClose","ColorSchemeProvider","uploaded","uploading"],"sourceRoot":""}